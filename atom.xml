<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HelloDog</title>
  
  <subtitle>Keep Calm and Carry On</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wsgzao.github.io/"/>
  <updated>2018-11-27T10:41:58.405Z</updated>
  <id>https://wsgzao.github.io/</id>
  
  <author>
    <name>wsgzao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用 Ansible 管理 Windows</title>
    <link href="https://wsgzao.github.io/post/ansible-windows/"/>
    <id>https://wsgzao.github.io/post/ansible-windows/</id>
    <published>2018-11-27T02:59:49.000Z</published>
    <updated>2018-11-27T10:41:58.405Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文主要介绍在如何使用 Ansible 管理 Windows 客户端，Ansible 官方提供了一个很方便的安装脚本，对于外网用户来说安装真的很轻松，可惜我遇到的问题是如何在内网部署，有相同烦恼的小伙伴不妨参考下</p><blockquote><p>轻轻松松使用 Ansible 管理 Windows 客户端</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 27 日 - 更新 macOS 使用 ansible 管理 windows<br>2018 年 05 月 21 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/ansible-windows/">https://wsgzao.github.io/post/ansible-windows/</a></p><p><strong> 扩展阅读 </strong></p><p>Ansible Windows Guides - <a href="http://docs.ansible.com/ansible/latest/user_guide/windows.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows.html</a></p><hr><h2 id="Ansible-Windows-Support"><a href="#Ansible-Windows-Support" class="headerlink" title="Ansible Windows Support"></a>Ansible Windows Support</h2><blockquote><p>Ansible 在 2.3 版本之前对于 Windows 支持的并不算很友好，从 2.4 版本开始已经可以使用原生模块实现很多需求</p></blockquote><p>Because Windows is a non-POSIX-compliant operating system, there are differences between how Ansible interacts with them and the way Windows works. These guides will highlight some of the differences between Linux/Unix hosts and hosts running Windows.</p><ul><li>Ansible’s supported Windows versions generally match those under current and extended support from Microsoft. Supported desktop OSs include Windows 7, 8.1, and 10, and supported server OSs are Windows Server 2008, 2008 R2, 2012, 2012 R2, and - 2016.</li><li>Ansible requires PowerShell 3.0 or newer and at least .NET 4.0 to be installed on the Windows host.</li><li>A WinRM listener should be created and activated. More details for this can be found below.</li></ul><p><img src="http://ws1.sinaimg.cn/large/7207510dgy1frixssianuj20w30ecwfi.jpg" alt="image"></p><blockquote><p>Ansible does not support managing Windows XP or Server 2003 hosts. The supported operating system versions are:</p></blockquote><p>Windows Server 2008<br>Windows Server 2008 R2<br>Windows Server 2012<br>Windows Server 2012 R2<br>Windows Server 2016<br>Windows 7<br>Windows 8.1<br>Windows 10</p><ol><li>在官方文档中已经提到了在 Windows 中使用 Ansible 的最要前提，WinRM</li><li>WinRM 依赖 Powershell 3.0 以上版本的支持，牵扯出 PowerShell 2.0 to PowerShell 3.0/5.0 的问题</li><li>而 Powershell 升级则带来. Net Framework 是否跟随升级至 4.6.2/4.7.2 的选择</li><li>关于 WinRM 的参数配置可以参考下面的链接 Setting up a Windows Host</li></ol><p><a href="https://github.com/ansible/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1" target="_blank" rel="noopener">https://github.com/ansible/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1</a><br><a href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1" target="_blank" rel="noopener">https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a></p><p>Setting up a Windows Host<br><a href="http://docs.ansible.com/ansible/latest/user_guide/windows_setup.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows_setup.html</a></p><p>.NET Framework 4.7.2/4.6.2<br><a href="https://www.microsoft.com/net/download/dotnet-framework-runtime" target="_blank" rel="noopener">https://www.microsoft.com/net/download/dotnet-framework-runtime</a></p><p>Powershell 3.0<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=34595</a></p><p>Powershell 5.1<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=54616</a></p><blockquote><p>我个人目前的建议是 Win7/2008 升级至 Powershell 3.0，.Net Framework 升级至 4.6.2，其他情况需要可以参考官方文档后做决定</p></blockquote><p>Ansible Windows Guides - <a href="http://docs.ansible.com/ansible/latest/user_guide/windows.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows.html</a></p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><ol><li>客户端配置 windows 主机, 以管理员身份打开 powershell, 并查看当前 ps 版本<br>get-host</li><li>系统自带的 powershell 版本是 2.0，需要更新至 powershell 3 以上版本<br><a href="https://www.microsoft.com/net/download/dotnet-framework-runtime" target="_blank" rel="noopener">https://www.microsoft.com/net/download/dotnet-framework-runtime</a><br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=34595</a></li><li>安装完重启服务器查看 powershell 版本</li></ol><p>.NET Framework 4.6 以上版本无法建立到信任根颁发机构的证书链<br>原因：系统缺少信任 Microsoft Root Certificate Authority 2011 根证书<br>下载：MicrosoftRootCertificateAuthority2011.cer<br><a href="http://go.microsoft.com/fwlink/?LinkID=747875&amp;clcid=0x409" target="_blank" rel="noopener">http://go.microsoft.com/fwlink/?LinkID=747875&amp;clcid=0x409</a><br>运行 certmgr.msc<br>导入证书到 “受信任的根证书颁发机构”</p><p><img src="http://ws4.sinaimg.cn/large/7207510dgy1frizys458dj20b109k3yq.jpg" alt="image"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置 winrm</span></span><br><span class="line">mkdir C:\temp</span><br><span class="line"><span class="built_in">cd</span> C:\temp</span><br><span class="line"><span class="comment"># 下载 ConfigureRemotingForAnsible.ps1</span></span><br><span class="line">https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</span><br><span class="line"><span class="comment"># 开启 WinRM 服务 </span></span><br><span class="line">powershell -ExecutionPolicy RemoteSigned .\ConfigureRemotingForAnsible.ps1 -SkipNetworkProfileCheck</span><br></pre></td></tr></table></figure><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端使用 pip 安装 pywinrm</span></span><br><span class="line">pip install pywinrm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 功能测试，配置 ansible 控制机 </span></span><br><span class="line">vi /etc/ansible/hosts</span><br><span class="line"></span><br><span class="line">[windows]</span><br><span class="line">192.168.67.139</span><br><span class="line">[windows:vars]</span><br><span class="line">ansible_user=Administrator</span><br><span class="line">ansible_password=Admin123</span><br><span class="line">ansible_port=5986</span><br><span class="line">ansible_connection=winrm</span><br><span class="line">ansible_winrm_server_cert_validation=ignore  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 要注意的是端口方面 ssl 即 https 方式的使用 5986，http 使用 5985</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 ping 通信 </span></span><br><span class="line">ansible windows -m win_ping </span><br><span class="line"><span class="comment"># 查看 ip 地址 </span></span><br><span class="line">ansible windows -m win_command -a <span class="string">"ipconfig"</span></span><br></pre></td></tr></table></figure><h2 id="网盘下载"><a href="#网盘下载" class="headerlink" title="网盘下载"></a>网盘下载</h2><blockquote><p>Windows 作为客户端所需的软件包我上传到百度网盘，.Net Framework 安装失败提示证书错误记得手动导入 MicrosoftRootCertificateAuthority2011.cer</p></blockquote><p><a href="https://pan.baidu.com/s/1JNV2pXjwUn14ojAtdEH_Sg" target="_blank" rel="noopener">https://pan.baidu.com/s/1JNV2pXjwUn14ojAtdEH_Sg</a></p><ol><li>安装 .Net Framework 4.6.2（NDP462-KB3151800-x86-x64-AllOS-ENU.exe）</li><li>升级 Windows 7 SP1 和 Windows 2008 R2 SP1 的 PowerShell 版本从 2.0 至 3.0（Windows6.1-KB2506143-x64.msu）</li><li><p>执行.\ConfigureRemotingForAnsible.ps1 脚本开启 WinRM 远程管理服务</p><p> powershell -ExecutionPolicy RemoteSigned .\ConfigureRemotingForAnsible.ps1 -SkipNetworkProfileCheck</p></li></ol><h2 id="macOS-配置"><a href="#macOS-配置" class="headerlink" title="macOS 配置"></a>macOS 配置</h2><blockquote><p>macOS 使用 ansible 管理 windows 里有一个小坑</p></blockquote><p>Ansible Error – “NSPlaceholderDate initialize may have been in progress in another thread when fork() was called”</p><p>If you have came across the same error as I did  (error below) then solving this might be easier than you think</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">objc[6763]: +[__NSPlaceholderDate initialize] may have been <span class="keyword">in</span> progress <span class="keyword">in</span> another thread when fork() was called.</span><br><span class="line">objc[6763]: +[__NSPlaceholderDate initialize] may have been <span class="keyword">in</span> progress <span class="keyword">in</span> another thread when fork() was called. We cannot safely call it or ignore it <span class="keyword">in</span> the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.</span><br><span class="line"></span><br><span class="line"><span class="comment"># run this export</span></span><br><span class="line"><span class="built_in">export</span> OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES</span><br></pre></td></tr></table></figure><p>You just need to run the following ( <a href="https://github.com/ansible/ansible/issues/31869" target="_blank" rel="noopener">https://github.com/ansible/ansible/issues/31869</a> )</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download the script</span></span><br><span class="line">(New-Object System.Net.WebClient).DownloadFile(<span class="string">'https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1'</span>, <span class="string">'./ConfigureRemotingForAnsible.ps1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># execute the script</span></span><br><span class="line">./ConfigureRemotingForAnsible.ps1</span><br><span class="line"></span><br><span class="line"><span class="comment"># macOS ansible</span></span><br><span class="line">python3 -m venv ansible</span><br><span class="line">pip install ansible pywinrm</span><br><span class="line"></span><br><span class="line"><span class="comment"># config win_hosts file</span></span><br><span class="line">vi win_hosts</span><br><span class="line"></span><br><span class="line">[windows:vars]</span><br><span class="line">ansible_user=ox</span><br><span class="line">ansible_password=ox</span><br><span class="line">ansible_port=5986</span><br><span class="line">ansible_connection=winrm</span><br><span class="line">ansible_winrm_server_cert_validation=ignore</span><br><span class="line"></span><br><span class="line">[windows]</span><br><span class="line">192.168.56.101</span><br><span class="line"></span><br><span class="line"><span class="comment"># run test</span></span><br><span class="line">ansible -i win_hosts windows -m win_ping -vvv</span><br><span class="line"></span><br><span class="line">ansible 2.7.0</span><br><span class="line">  config file = /Users/wangao/Documents/git/wangao/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [u<span class="string">'/Users/wangao/.ansible/plugins/modules'</span>, u<span class="string">'/usr/share/ansible/plugins/modules'</span>]</span><br><span class="line">  ansible python module location = /usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible</span><br><span class="line">  executable location = /usr/<span class="built_in">local</span>/bin/ansible</span><br><span class="line">  python version = 2.7.15 (default, Jul 23 2018, 21:27:06) [GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.2)]</span><br><span class="line">Using /Users/wangao/Documents/git/wangao/ansible/ansible.cfg as config file</span><br><span class="line">Parsed /Users/wangao/Documents/git/wangao/ansible/win_hosts inventory <span class="built_in">source</span> with ini plugin</span><br><span class="line">META: ran handlers</span><br><span class="line">Using module file /usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible/modules/windows/win_ping.ps1</span><br><span class="line">&lt;192.168.56.101&gt; ESTABLISH WINRM CONNECTION FOR USER: ox on PORT 5986 TO 192.168.56.101</span><br><span class="line">objc[63337]: +[__NSPlaceholderDate initialize] may have been <span class="keyword">in</span> progress <span class="keyword">in</span> another thread when fork() was called.</span><br><span class="line">objc[63337]: +[__NSPlaceholderDate initialize] may have been <span class="keyword">in</span> progress <span class="keyword">in</span> another thread when fork() was called. We cannot safely call it or ignore it <span class="keyword">in</span> the fork() child process. Crashing instead. Set a breakpoint on objc_initializeAfterForkError to debug.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fixed this on High Sierra and Mojave.</span></span><br><span class="line"><span class="built_in">export</span> OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES</span><br><span class="line"></span><br><span class="line">ansible -i win_hosts windows -m win_ping -vvv</span><br><span class="line"></span><br><span class="line">ansible 2.7.0</span><br><span class="line">  config file = /Users/wangao/Documents/git/wangao/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [u<span class="string">'/Users/wangao/.ansible/plugins/modules'</span>, u<span class="string">'/usr/share/ansible/plugins/modules'</span>]</span><br><span class="line">  ansible python module location = /usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible</span><br><span class="line">  executable location = /usr/<span class="built_in">local</span>/bin/ansible</span><br><span class="line">  python version = 2.7.15 (default, Jul 23 2018, 21:27:06) [GCC 4.2.1 Compatible Apple LLVM 9.1.0 (clang-902.0.39.2)]</span><br><span class="line">Using /Users/wangao/Documents/git/wangao/ansible/ansible.cfg as config file</span><br><span class="line">Parsed /Users/wangao/Documents/git/wangao/ansible/win_hosts inventory <span class="built_in">source</span> with ini plugin</span><br><span class="line">META: ran handlers</span><br><span class="line">Using module file /usr/<span class="built_in">local</span>/lib/python2.7/site-packages/ansible/modules/windows/win_ping.ps1</span><br><span class="line">&lt;192.168.56.101&gt; ESTABLISH WINRM CONNECTION FOR USER: ox on PORT 5986 TO 192.168.56.101</span><br><span class="line">EXEC (via pipeline wrapper)</span><br><span class="line">192.168.56.101 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      轻轻松松使用Ansible管理Windows客户端
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用 csshX 同步管理多个 SSH 会话</title>
    <link href="https://wsgzao.github.io/post/csshx/"/>
    <id>https://wsgzao.github.io/post/csshx/</id>
    <published>2018-11-26T06:59:49.000Z</published>
    <updated>2018-11-26T12:12:39.902Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>终端登录管理方案非常成熟除了耳熟能详的跨平台付费方案 SeureCRT，Windows 有 Xshell，macOS 有 iTerm2，不过在 macOS 下想用到类似 SecureCRT 和 Xshell 一样的 Send to all 功能可能就没有这么方便了，而 csshX 正好可以满足批量管理操作的需求</p><blockquote><p>使用 csshX 同步管理多个 SSH 会话</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 26 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/csshx/">https://wsgzao.github.io/post/csshx/</a></p><p><strong> 扩展阅读 </strong></p><p>csshx - <a href="https://github.com/brockgr/csshx" target="_blank" rel="noopener">https://github.com/brockgr/csshx</a></p><hr><h2 id="csshx-简介"><a href="#csshx-简介" class="headerlink" title="csshx 简介"></a>csshx 简介</h2><p>As csshX is a command line tool, no special installation is needed. It may<br>be copied into a directory in your path, (e.g. /usr/local/bin) for your<br>convenience.</p><p>The software has been tested on Mac OS X 10.5, 10.6 and 10.7 with the default<br>Perl installation - no additional Perl modules are required.</p><p>DOCUMENTATION:</p><p>The documentation for csshX is self contained. Please run:</p><pre><code>csshX --man</code></pre><h2 id="使用-brew-安装-csshx"><a href="#使用-brew-安装-csshx" class="headerlink" title="使用 brew 安装 csshx"></a>使用 brew 安装 csshx</h2><p>Name: csshx<br>Use: Cluster ssh tool for Terminal.app<br>URL: <a href="https://github.com/brockgr/csshx" target="_blank" rel="noopener">https://github.com/brockgr/csshx</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 homebrew</span></span><br><span class="line">ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span> &lt; /dev/null 2&gt; /dev/null</span><br><span class="line"><span class="comment"># 安装 csshx</span></span><br><span class="line">brew install csshx</span><br></pre></td></tr></table></figure><h2 id="csshx-使用"><a href="#csshx-使用" class="headerlink" title="csshx 使用"></a>csshx 使用</h2><p>当我们管理数十台或更多 Linux 服务器的时候，往往需要在每台服务器上执行同样的命令，比如我们想一次查看 10 台服务器（node）上系统负载情况，或者想知道哪台服务器有剩余内存可以分给新客户，又或者想执行 df 命令看看哪个服务器上还有多的硬盘空间等等，除了可以用脚本或工具统一收集这些信息外，我们还可以考虑使用一些同步管理多个 SSH 会话的小工具来帮助管理多台服务器，节省时间提高管理效率。在 Linux 上可以用 pdsh、ClusterSSH 和 mussh；在 Mac 上可以用 csshX.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 csshX 很简单，如果要同时 ssh 到 4 个服务器可以直接传递 IP</span></span><br><span class="line">csshX 192.168.0.1 192.168.0.2 192.168.0.3 192.168.0.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以把这些要 ssh 管理的 IP 写到一个文件里，然后加载这个文件 </span></span><br><span class="line">vi hosts</span><br><span class="line">192.168.0.1</span><br><span class="line">192.168.0.2</span><br><span class="line">192.168.0.3</span><br><span class="line">192.168.0.4</span><br><span class="line"></span><br><span class="line">csshX --hosts hosts</span><br></pre></td></tr></table></figure><h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>csshx is not working in New Mac OS Release MacOS Mojave</p><p><a href="https://github.com/brockgr/csshx/issues/94" target="_blank" rel="noopener">https://github.com/brockgr/csshx/issues/94</a></p><pre><code>brew install parera10/csshx/csshx</code></pre>]]></content>
    
    <summary type="html">
    
      使用csshX同步管理多个SSH会话
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Splunk 官方培训笔记</title>
    <link href="https://wsgzao.github.io/post/splunk/"/>
    <id>https://wsgzao.github.io/post/splunk/</id>
    <published>2018-11-21T08:22:32.000Z</published>
    <updated>2018-11-21T09:05:20.030Z</updated>
    
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/0kvIE02gl.jpeg" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Splunk 作为一款成熟的商业化日志处理分析产品无论在功能上还是用户体验上都是令人满意的，而开源方案 ELK(Elasticsearch+Logstash+Kibana) 相信也有很多朋友考虑或者正在使用，我在这里不想讨论孰优孰劣因为不同的业务场景出发点不同，共存也是不错的选择。文章通过 1 天的 Splunk 官方培训记录相关基础概念和动手实验，Splunk 上手速度灰常快不过也需要掌握正则表达式，欢迎大家一起学习哈。</p><blockquote><p>Splunk 智能运维，挖掘数据的价值</p></blockquote><h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018 年 11 月 21 日 - 增加与 Ansible 结合的用法<br>2016 年 03 月 22 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/splunk/">https://wsgzao.github.io/post/splunk/</a></p><p><strong> 扩展阅读 </strong></p><p>Splunk - <a href="http://www.splunk.com/" target="_blank" rel="noopener">http://www.splunk.com/</a><br>正则表达式 30 分钟入门教程 - <a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">http://deerchao.net/tutorials/regex/regex.htm</a></p><h2 id="机器数据"><a href="#机器数据" class="headerlink" title="机器数据"></a>机器数据</h2><p>机器数据中包含客户、用户、交易、应用程序、服务器、网络和手机设备所有活动和行为的明确记录。不仅仅包含日志。还包括配置、API 中的数据、消息队列、更改事件、诊断命令输出、工业系统呼叫详细信息记录和传感器数据等。</p><p>计算机数以未知格式的阵列存储，监测和分析工具的传统集并未为多样性、速率、数据量、可变性设计。一个专为此独特类型数据设计的全新方法，必须可以快速诊断服务问题、检测复杂信息安全威胁、远程设备的健康状况和性能，以及说明合规性。</p><h3 id="机器数据源"><a href="#机器数据源" class="headerlink" title="机器数据源"></a>机器数据源</h3><blockquote><p>每个环境都有独特的机器数据空间，以下是一些示例。</p></blockquote><table><thead><tr><th>数据类型</th><th>位置</th><th>它可以告诉您什么</th></tr></thead><tbody><tr><td>应用日志</td><td>本地日志文件、log4j、log4net、Weblogic、WebSphere、JBoss、.NET、PHP</td><td>用户活动、欺诈检测、应用性能</td></tr><tr><td>业务流程日志</td><td>业务流程管理日志</td><td>跨渠道客户活动、购买、帐户变更以及问题报表</td></tr><tr><td>呼叫详细信息记录</td><td>呼叫详细信息记录 (CDR)、计费数据记录、事件数据记录均由电信和网络交换机所记录。</td><td>计费、收入保证、客户保证、合作伙伴结算，营销智能</td></tr><tr><td>点击流数据</td><td>Web 服务器、路由器、代理服务器和广告服务器</td><td>可用性分析、数字市场营销和一般调查</td></tr><tr><td>配置文件</td><td>系统配置文件</td><td>如何设置基础设施、调试故障、后门攻击、”定时炸弹” 病毒</td></tr><tr><td>数据库审计日志</td><td>数据库日志文件、审计表</td><td>如何根据时间修改数据库数据以及如何确定修改人</td></tr><tr><td>文件系统审计日志</td><td>敏感数据存储在共享文件系统中</td><td>监测并审计敏感数据读取权限</td></tr><tr><td>管理并记录 API</td><td>通过 OPSEC Log Export API (OPSEC LEA) 和其他 VMware 和 Citrix 供应商特定 API 的 Checkpoint 防火墙</td><td>管理数据和日志事件</td></tr><tr><td>消息队列</td><td>JMS、RabbitMQ 和 AquaLogic</td><td>调试复杂应用中的问题，并作为记录应用架构基础</td></tr><tr><td>操作系统度量、状态和诊断命令</td><td>通过命令行实用程序（例如 Unix 和 Linux 上的 ps 与 iostat 以及 Windows 上的性能监视器）显示的 CPU、内存利用率和状态信息</td><td>故障排除、分析趋势以发现潜在问题并调查安全事件</td></tr><tr><td>数据包 / 流量数据</td><td>tcpdump 和 tcpflow 可生成 pcap 或流量数据以及其他有用的数据包级和会话级信息</td><td>性能降级、超时、瓶颈或可疑活动可表明网络被入侵或者受到远程攻击</td></tr><tr><td>SCADA 数据</td><td>监视控制与数据采集 (SCADA)</td><td>识别 SCADA 基础结构中的趋势、模式和异常情况，并用于实现客户价值</td></tr><tr><td>传感器数据</td><td>传感器设备可以根据监测环境条件生成数据，例如气温、声音、压力、功率以及水位</td><td>水位监测、机器健康状态监测和智能家居监测</td></tr><tr><td>Syslog</td><td>路由器、交换机和网络设备上的 Syslog</td><td>故障排除、分析、安全审计</td></tr><tr><td>Web 访问日志</td><td>Web 访问日志会报告 Web 服务器处理的每个请求</td><td>Web 市场营销分析报表</td></tr><tr><td>Web 代理日志</td><td>Web 代理记录用户通过代理发出的每个 Web 请求</td><td>监测并调查服务条款以及数据泄露事件</td></tr><tr><td>Windows 事件</td><td>Windows 应用、安全和系统事件日志</td><td>使用业务关键应用、安全信息和使用模式检测问题。</td></tr><tr><td>线上数据</td><td>DNS 查找和记录，协议级信息，包括标头、内容以及流记录</td><td>主动监测应用性能和可用性、最终客户体验、事件调查、网络、威胁检测、监控和合规性</td></tr></tbody></table><h2 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h2><blockquote><p>免费版每天最多可对 500 MB 数据建立索引</p></blockquote><p>Splunk Enterprise - <a href="http://www.splunk.com/zh-hans_cn/download/splunk-enterprise.html" target="_blank" rel="noopener">http://www.splunk.com/zh-hans_cn/download/splunk-enterprise.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">file://C:\Users\wsgzao\Desktop\splunk_workshop  (2 folders, 3 files, 26.20 MB, 48.25 MB <span class="keyword">in</span> total.)</span><br><span class="line">│  sampledata-selected.zip   323.36 KB</span><br><span class="line">│  splunk.pdf    24.02 MB</span><br><span class="line">│  tutorialdata.zip  1.86 MB</span><br><span class="line">├─sampledata-selected   (0 folders, 3 files, 4.07 MB, 4.07 MB <span class="keyword">in</span> total.)</span><br><span class="line">│      access.log  4.06 MB</span><br><span class="line">│      http_status.csv 1.34 KB</span><br><span class="line">│      prices.csv  630 bytes</span><br><span class="line">└─tutorialdata  (5 folders, 0 files, 0 bytes, 17.99 MB <span class="keyword">in</span> total.)</span><br><span class="line">    ├─mailsv  (0 folders, 1 files, 1.06 MB, 1.06 MB <span class="keyword">in</span> total.)</span><br><span class="line">    │      secure.log    1.06 MB</span><br><span class="line">    ├─vendor_sales    (0 folders, 1 files, 1.96 MB, 1.96 MB <span class="keyword">in</span> total.)</span><br><span class="line">    │      vendor_sales.log  1.96 MB</span><br><span class="line">    ├─www1    (0 folders, 2 files, 5.18 MB, 5.18 MB <span class="keyword">in</span> total.)</span><br><span class="line">    │      access.log    4.06 MB</span><br><span class="line">    │      secure.log    1.12 MB</span><br><span class="line">    ├─www2    (0 folders, 2 files, 4.87 MB, 4.87 MB <span class="keyword">in</span> total.)</span><br><span class="line">    │      access.log    3.85 MB</span><br><span class="line">    │      secure.log    1.02 MB</span><br><span class="line">    └─www3    (0 folders, 2 files, 4.91 MB, 4.91 MB <span class="keyword">in</span> total.)</span><br><span class="line">            access.log    3.86 MB</span><br><span class="line">            secure.log    1.05 MB</span><br></pre></td></tr></table></figure><iframe src="https://www.slideshare.net/slideshow/embed_code/key/dQlrUNPu3JNYjp" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <h2 id="动手实验"><a href="#动手实验" class="headerlink" title="动手实验"></a>动手实验</h2><blockquote><p>安装 Splunk 极其简单，这里以 Windows 为例</p></blockquote><p><a href="http://localhost:8000/zh-CN/" target="_blank" rel="noopener">http://localhost:8000/zh-CN/</a><br><a href="http://localhost:8000/en-US/" target="_blank" rel="noopener">http://localhost:8000/en-US/</a></p><p>Search App：数据导入，了解 splunk 搜索界面，执行基本搜索<br>Field：了解 Splunk 字段含义；字段提取；字段对照<br>SPL：使用 SPL（SplunkSearchProcessingLanguage）指令实现目标场景<br>Businessused cases：场景实现，自定义仪表盘制作</p><blockquote><p>Objectives of workshop</p></blockquote><ul><li>Learn how to start indexing machine data in Splunk.</li><li>Leverage these machine data for reporting and learn some of the common reporting commands.</li><li>Learn to use searches to pull out data of importance.</li><li>Get an idea on an unique Splunk feature called “schema-on-the-fly”, and understand how to apply such “Fields” to machine data to make IT and business sense.</li><li>Learn how to build and share dashboards during the class.</li><li>Get an idea how to create data model and create pivot reports*</li><li>You can re-run the whole workshop after this session anywhere</li><li>Q&amp;A</li></ul><blockquote><p>实验过程</p></blockquote><p>我觉得操作都很简单，大家可以多参考官方的 Splunk Documentation</p><p><a href="http://docs.splunk.com/Documentation" target="_blank" rel="noopener">http://docs.splunk.com/Documentation</a><br><a href="http://docs.splunk.com/Documentation/Splunk/latest/Translated/SimplifiedChinesemanuals" target="_blank" rel="noopener">http://docs.splunk.com/Documentation/Splunk/latest/Translated/SimplifiedChinesemanuals</a></p><p>正则表达式 30 分钟入门教程 - <a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">http://deerchao.net/tutorials/regex/regex.htm</a></p><h2 id="高级参数"><a href="#高级参数" class="headerlink" title="高级参数"></a>高级参数</h2><blockquote><p>举个栗子</p></blockquote><p>编辑来源类型： _json</p><ul><li>MAX_ EVENTS: 99999</li><li>TRUNCATE: 99999999</li></ul>]]></content>
    
    <summary type="html">
    
      Splunk智能运维，挖掘数据的价值
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>在命令行内获取公网 IP 的几种简单方法</title>
    <link href="https://wsgzao.github.io/post/myip/"/>
    <id>https://wsgzao.github.io/post/myip/</id>
    <published>2018-11-20T06:59:49.000Z</published>
    <updated>2018-11-21T03:58:02.213Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>不管是在家里还是办公室，或者是公司的主机，很多时候都是在内网中，也就是说很多都是通过 NAT 上网的，有时候需要查询下出口的公网 IP，如果有浏览器可以用百度或者 Google 搜索 ip 这个关键词得到公网 IP，那要是在命令行下呢？下面给大家分享下自己整理的几种方案</p><blockquote><p>Extract your external IP using command line tools</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 20 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/myip/">https://wsgzao.github.io/post/myip/</a></p><p><strong> 扩展阅读 </strong></p><p><a href="https://support.opendns.com/hc/en-us/search?utf8=%E2%9C%93&amp;query=myip.opendns.com" target="_blank" rel="noopener">https://support.opendns.com/hc/en-us/search?utf8=%E2%9C%93&amp;query=myip.opendns.com</a></p><hr><h2 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h2><blockquote><p>目前广受中外网友好评简单快速的查询公网 IP 方案，OpenDNS 支持 IPv4 和 IPv6</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># IPv4</span></span><br><span class="line">dig -4 +short myip.opendns.com. @resolver1.opendns.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># IPv6</span></span><br><span class="line">dig -6 +short myip.opendns.com. @resolver1.opendns.com</span><br></pre></td></tr></table></figure><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl whatismyip.akamai.com</span><br><span class="line">curl ifconfig.me</span><br><span class="line">curl ipecho.net/plain</span><br><span class="line">curl icanhazip.com</span><br></pre></td></tr></table></figure><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl ipinfo.io</span><br><span class="line">curl https://api.myip.com</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Extract your external IP using command line tools
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>CentOS7 平滑升级 MariaDB 5.5 到 10.x 新版本实践</title>
    <link href="https://wsgzao.github.io/post/mariadb-upgrade/"/>
    <id>https://wsgzao.github.io/post/mariadb-upgrade/</id>
    <published>2018-11-14T06:59:49.000Z</published>
    <updated>2018-11-15T03:43:45.054Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>自从 CentOS 7 开始，自带的数据库就变成 MariaDB 了，yum 安装之后的默认版本是 5.5，但是这个数据版本已经比较老了，无论是安装全新的 Percona 还是升级 MariaDB 第一步始终是不要忘记备份。</p><blockquote><p>CentOS7 平滑升级 MariaDB 5.5 到 10.x 新版本实践</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 14 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/mariadb-upgrade/">https://wsgzao.github.io/post/mariadb-upgrade/</a></p><p><strong> 扩展阅读 </strong></p><p>MariaDB - <a href="https://mariadb.org/" target="_blank" rel="noopener">https://mariadb.org/</a></p><hr><h2 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h2><blockquote><p>重要的事情说三遍，备份，备份，备份</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份数据库，如果升级顺利是不要实施备份还原的 </span></span><br><span class="line">mysqldump -u root -p --all-databases &gt; alldb.sql</span><br><span class="line"><span class="comment"># 如果想保留自己的 my.cof 配置，则备份一下这个文件 </span></span><br><span class="line">cp /etc/my.cnf /etc/my.cnf.bak</span><br><span class="line"><span class="comment"># 停止数据库运行 </span></span><br><span class="line">systemctl stop mariadb</span><br><span class="line"><span class="comment"># 卸载 MariaDB 老版本 </span></span><br><span class="line">yum remove mariadb mariadb-server</span><br></pre></td></tr></table></figure><h2 id="添加-MariaDB-Yum-库"><a href="#添加-MariaDB-Yum-库" class="headerlink" title="添加 MariaDB Yum 库"></a>添加 MariaDB Yum 库</h2><blockquote><p>建议使用 MariaDB 官方推荐的 stable 稳定版，</p></blockquote><p><a href="https://downloads.mariadb.org/mariadb/" target="_blank" rel="noopener">https://downloads.mariadb.org/mariadb/</a><br><a href="http://yum.mariadb.org/" target="_blank" rel="noopener">http://yum.mariadb.org/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 MariaDB 官方源 </span></span><br><span class="line">vi /etc/yum.repos.d/MariaDB.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># MariaDB 10.3 CentOS repository list</span></span><br><span class="line"><span class="comment"># http://downloads.mariadb.org/mariadb/repositories/</span></span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = http://yum.mariadb.org/10.3/centos7-amd64</span><br><span class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除 yum 缓存 </span></span><br><span class="line">yum clean all </span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h2 id="升级已有数据库"><a href="#升级已有数据库" class="headerlink" title="升级已有数据库"></a>升级已有数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 MariaDB 新版本 </span></span><br><span class="line">yum install mariadb mariadb-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动新版 MariaDB</span></span><br><span class="line">systemctl start mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级已有数据库 </span></span><br><span class="line">mysql_upgrade -uroot -p </span><br><span class="line"></span><br><span class="line">[root@sg-gop-10-71-12-89 tmp]<span class="comment"># mysql_upgrade -uroot -p</span></span><br><span class="line">Enter password:</span><br><span class="line">Phase 1/7: Checking and upgrading mysql database</span><br><span class="line">Processing databases</span><br><span class="line">mysql</span><br><span class="line">mysql.columns_priv                                 OK</span><br><span class="line">mysql.db                                           OK</span><br><span class="line">mysql.event                                        OK</span><br><span class="line">mysql.func                                         OK</span><br><span class="line">mysql.help_category                                OK</span><br><span class="line">mysql.help_keyword                                 OK</span><br><span class="line">mysql.help_relation                                OK</span><br><span class="line">mysql.help_topic                                   OK</span><br><span class="line">mysql.host                                         OK</span><br><span class="line">mysql.ndb_binlog_index                             OK</span><br><span class="line">mysql.plugin                                       OK</span><br><span class="line">mysql.proc                                         OK</span><br><span class="line">mysql.procs_priv                                   OK</span><br><span class="line">mysql.proxies_priv                                 OK</span><br><span class="line">mysql.servers                                      OK</span><br><span class="line">mysql.tables_priv                                  OK</span><br><span class="line">mysql.time_zone                                    OK</span><br><span class="line">mysql.time_zone_leap_second                        OK</span><br><span class="line">mysql.time_zone_name                               OK</span><br><span class="line">mysql.time_zone_transition                         OK</span><br><span class="line">mysql.time_zone_transition_type                    OK</span><br><span class="line">mysql.user                                         OK</span><br><span class="line">Upgrading from a version before MariaDB-10.1</span><br><span class="line">Phase 2/7: Installing used storage engines</span><br><span class="line">Checking <span class="keyword">for</span> tables with unknown storage engine</span><br><span class="line">Phase 3/7: Fixing views</span><br><span class="line">Phase 4/7: Running <span class="string">'mysql_fix_privilege_tables'</span></span><br><span class="line">Phase 5/7: Fixing table and database names</span><br><span class="line">Phase 6/7: Checking and upgrading tables</span><br><span class="line">Processing databases</span><br><span class="line">information_schema</span><br><span class="line">performance_schema</span><br><span class="line">zabbix</span><br><span class="line">zabbix.acknowledges                                OK</span><br><span class="line">zabbix.actions                                     OK</span><br><span class="line">zabbix.alerts                                      OK</span><br><span class="line">zabbix.application_discovery                       OK</span><br><span class="line">zabbix.application_prototype                       OK</span><br><span class="line">zabbix.application_template                        OK</span><br><span class="line">zabbix.applications                                OK</span><br><span class="line">zabbix.auditlog                                    OK</span><br><span class="line">zabbix.auditlog_details                            OK</span><br><span class="line">zabbix.autoreg_host                                OK</span><br><span class="line">zabbix.conditions                                  OK</span><br><span class="line">zabbix.config                                      OK</span><br><span class="line">zabbix.corr_condition                              OK</span><br><span class="line">zabbix.corr_condition_group                        OK</span><br><span class="line">zabbix.corr_condition_tag                          OK</span><br><span class="line">zabbix.corr_condition_tagpair                      OK</span><br><span class="line">zabbix.corr_condition_tagvalue                     OK</span><br><span class="line">zabbix.corr_operation                              OK</span><br><span class="line">zabbix.correlation                                 OK</span><br><span class="line">zabbix.dashboard                                   OK</span><br><span class="line">zabbix.dashboard_user                              OK</span><br><span class="line">zabbix.dashboard_usrgrp                            OK</span><br><span class="line">zabbix.dbversion                                   OK</span><br><span class="line">zabbix.dchecks                                     OK</span><br><span class="line">zabbix.dhosts                                      OK</span><br><span class="line">zabbix.drules                                      OK</span><br><span class="line">zabbix.dservices                                   OK</span><br><span class="line">zabbix.escalations                                 OK</span><br><span class="line">zabbix.event_recovery                              OK</span><br><span class="line">zabbix.event_suppress                              OK</span><br><span class="line">zabbix.event_tag                                   OK</span><br><span class="line">zabbix.events                                      OK</span><br><span class="line">zabbix.expressions                                 OK</span><br><span class="line">zabbix.functions                                   OK</span><br><span class="line">zabbix.globalmacro                                 OK</span><br><span class="line">zabbix.globalvars                                  OK</span><br><span class="line">zabbix.graph_discovery                             OK</span><br><span class="line">zabbix.graph_theme                                 OK</span><br><span class="line">zabbix.graphs                                      OK</span><br><span class="line">zabbix.graphs_items                                OK</span><br><span class="line">zabbix.group_discovery                             OK</span><br><span class="line">zabbix.group_prototype                             OK</span><br><span class="line">zabbix.history                                     OK</span><br><span class="line">zabbix.history_log                                 OK</span><br><span class="line">zabbix.history_str                                 OK</span><br><span class="line">zabbix.history_text                                OK</span><br><span class="line">zabbix.history_uint                                OK</span><br><span class="line">zabbix.host_discovery                              OK</span><br><span class="line">zabbix.host_inventory                              OK</span><br><span class="line">zabbix.hostmacro                                   OK</span><br><span class="line">zabbix.hosts                                       OK</span><br><span class="line">zabbix.hosts_groups                                OK</span><br><span class="line">zabbix.hosts_templates                             OK</span><br><span class="line">zabbix.housekeeper                                 OK</span><br><span class="line">zabbix.hstgrp                                      OK</span><br><span class="line">zabbix.httpstep                                    OK</span><br><span class="line">zabbix.httpstep_field                              OK</span><br><span class="line">zabbix.httpstepitem                                OK</span><br><span class="line">zabbix.httptest                                    OK</span><br><span class="line">zabbix.httptest_field                              OK</span><br><span class="line">zabbix.httptestitem                                OK</span><br><span class="line">zabbix.icon_map                                    OK</span><br><span class="line">zabbix.icon_mapping                                OK</span><br><span class="line">zabbix.ids                                         OK</span><br><span class="line">zabbix.images                                      OK</span><br><span class="line">zabbix.interface                                   OK</span><br><span class="line">zabbix.interface_discovery                         OK</span><br><span class="line">zabbix.item_application_prototype                  OK</span><br><span class="line">zabbix.item_condition                              OK</span><br><span class="line">zabbix.item_discovery                              OK</span><br><span class="line">zabbix.item_preproc                                OK</span><br><span class="line">zabbix.items                                       OK</span><br><span class="line">zabbix.items_applications                          OK</span><br><span class="line">zabbix.maintenance_tag                             OK</span><br><span class="line">zabbix.maintenances                                OK</span><br><span class="line">zabbix.maintenances_groups                         OK</span><br><span class="line">zabbix.maintenances_hosts                          OK</span><br><span class="line">zabbix.maintenances_windows                        OK</span><br><span class="line">zabbix.mappings                                    OK</span><br><span class="line">zabbix.media                                       OK</span><br><span class="line">zabbix.media_type                                  OK</span><br><span class="line">zabbix.opcommand                                   OK</span><br><span class="line">zabbix.opcommand_grp                               OK</span><br><span class="line">zabbix.opcommand_hst                               OK</span><br><span class="line">zabbix.opconditions                                OK</span><br><span class="line">zabbix.operations                                  OK</span><br><span class="line">zabbix.opgroup                                     OK</span><br><span class="line">zabbix.opinventory                                 OK</span><br><span class="line">zabbix.opmessage                                   OK</span><br><span class="line">zabbix.opmessage_grp                               OK</span><br><span class="line">zabbix.opmessage_usr                               OK</span><br><span class="line">zabbix.optemplate                                  OK</span><br><span class="line">zabbix.problem                                     OK</span><br><span class="line">zabbix.problem_tag                                 OK</span><br><span class="line">zabbix.profiles                                    OK</span><br><span class="line">zabbix.proxy_autoreg_host                          OK</span><br><span class="line">zabbix.proxy_dhistory                              OK</span><br><span class="line">zabbix.proxy_history                               OK</span><br><span class="line">zabbix.regexps                                     OK</span><br><span class="line">zabbix.rights                                      OK</span><br><span class="line">zabbix.screen_user                                 OK</span><br><span class="line">zabbix.screen_usrgrp                               OK</span><br><span class="line">zabbix.screens                                     OK</span><br><span class="line">zabbix.screens_items                               OK</span><br><span class="line">zabbix.scripts                                     OK</span><br><span class="line">zabbix.service_alarms                              OK</span><br><span class="line">zabbix.services                                    OK</span><br><span class="line">zabbix.services_links                              OK</span><br><span class="line">zabbix.services_times                              OK</span><br><span class="line">zabbix.sessions                                    OK</span><br><span class="line">zabbix.slides                                      OK</span><br><span class="line">zabbix.slideshow_user                              OK</span><br><span class="line">zabbix.slideshow_usrgrp                            OK</span><br><span class="line">zabbix.slideshows                                  OK</span><br><span class="line">zabbix.sysmap_element_trigger                      OK</span><br><span class="line">zabbix.sysmap_element_url                          OK</span><br><span class="line">zabbix.sysmap_shape                                OK</span><br><span class="line">zabbix.sysmap_url                                  OK</span><br><span class="line">zabbix.sysmap_user                                 OK</span><br><span class="line">zabbix.sysmap_usrgrp                               OK</span><br><span class="line">zabbix.sysmaps                                     OK</span><br><span class="line">zabbix.sysmaps_elements                            OK</span><br><span class="line">zabbix.sysmaps_link_triggers                       OK</span><br><span class="line">zabbix.sysmaps_links                               OK</span><br><span class="line">zabbix.tag_filter                                  OK</span><br><span class="line">zabbix.task                                        OK</span><br><span class="line">zabbix.task_acknowledge                            OK</span><br><span class="line">zabbix.task_check_now                              OK</span><br><span class="line">zabbix.task_close_problem                          OK</span><br><span class="line">zabbix.task_remote_command                         OK</span><br><span class="line">zabbix.task_remote_command_result                  OK</span><br><span class="line">zabbix.timeperiods                                 OK</span><br><span class="line">zabbix.trends                                      OK</span><br><span class="line">zabbix.trends_uint                                 OK</span><br><span class="line">zabbix.trigger_depends                             OK</span><br><span class="line">zabbix.trigger_discovery                           OK</span><br><span class="line">zabbix.trigger_tag                                 OK</span><br><span class="line">zabbix.triggers                                    OK</span><br><span class="line">zabbix.users                                       OK</span><br><span class="line">zabbix.users_groups                                OK</span><br><span class="line">zabbix.usrgrp                                      OK</span><br><span class="line">zabbix.valuemaps                                   OK</span><br><span class="line">zabbix.widget                                      OK</span><br><span class="line">zabbix.widget_field                                OK</span><br><span class="line">Phase 7/7: Running <span class="string">'FLUSH PRIVILEGES'</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置服务自启动 </span></span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录数据库验证 </span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级过程遇到错误记得先查看日志分析 </span></span><br></pre></td></tr></table></figure><h2 id="MariaDB-官方升级文档"><a href="#MariaDB-官方升级文档" class="headerlink" title="MariaDB 官方升级文档"></a>MariaDB 官方升级文档</h2><p>Upgrading from MariaDB 5.5 to MariaDB 10.0<br><a href="https://mariadb.com/kb/en/library/upgrading-from-mariadb-55-to-mariadb-100/" target="_blank" rel="noopener">https://mariadb.com/kb/en/library/upgrading-from-mariadb-55-to-mariadb-100/</a></p>]]></content>
    
    <summary type="html">
    
      CentOS7平滑升级MariaDB 5.5到10.x新版本实践
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>macOS 使用 homebrew-bundle 优雅的备份和恢复软件列表</title>
    <link href="https://wsgzao.github.io/post/homebrew-bundle/"/>
    <id>https://wsgzao.github.io/post/homebrew-bundle/</id>
    <published>2018-11-07T06:59:49.000Z</published>
    <updated>2018-11-07T10:50:52.494Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>每个人都会积累一套自己习惯使用的 App。如果平时习惯使用 Time Machine 备份，那么在重装系统时，直接用它还原倒是一个不错的办法，不必再手动安装一个个 App。但是有些时候，我们可能想要一个更加「干净」的新系统，此时就需要依次手动安装。这显然不是个高效、省心的方法，可能还需要一个个回忆之前用的 App。这时候，我们往往希望有一份属于自己的 App 清单，最好还能在重装时一键安装，省心省力。无论是 Windows 还是 macOS 下我们都希望实现一键装机，而 homebrew-bundle 正是这样一款 Mac 下的备份恢复利器。</p><blockquote><p>macOS 使用 homebrew-bundle 优雅的备份和恢复软件列表</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 07 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/homebrew-bundle/">https://wsgzao.github.io/post/homebrew-bundle/</a></p><p><strong> 扩展阅读 </strong></p><p>定期自动云备份 macOS 软件列表，维护一份属于自己的必备 App 清单 - <a href="https://sspai.com/post/43265" target="_blank" rel="noopener">https://sspai.com/post/43265</a><br>狡兔三窟——云备份软件列表与相应配置，补充 Time Machine - <a href="https://sspai.com/post/43479" target="_blank" rel="noopener">https://sspai.com/post/43479</a></p><hr><h2 id="Time-Machine"><a href="#Time-Machine" class="headerlink" title="Time Machine"></a>Time Machine</h2><p>macOS 自带的 Time Machine 无疑是备份与还原的利器。无论是重装系统，还是新机配置，Time Machine 用起来都十分方便、省心。但是它存在以下不足：</p><ol><li>如果直接在本机硬盘上备份，Time Machine 动辄百 G 的硬盘占用，令小硬盘电脑用户望而却步。而且一般情况下，电脑内只有一块硬盘，如果系统和备份在同一硬盘上，那么硬盘挂了就两者皆挂。</li><li>如果使用网络备份，带宽和网络空间费用可能都是问题。</li><li>如果使用 NAS 或者使用树莓派架设 Time Capsule，则需要有一定的计算机相关基础和折腾能力。</li></ol><p>即使上述情况对你来说都不是问题，多一种备份方式也是多一份安全和保障。</p><h2 id="homebrew-bundle"><a href="#homebrew-bundle" class="headerlink" title="homebrew-bundle"></a>homebrew-bundle</h2><blockquote><p>Bundler for non-Ruby dependencies from Homebrew</p></blockquote><p>homebrew-bundle - <a href="https://github.com/Homebrew/homebrew-bundle" target="_blank" rel="noopener">https://github.com/Homebrew/homebrew-bundle</a></p><ol><li>Mac 上非常常用的包管理器 Homebrew, 我们经常用它来安装其他的软件包</li><li>还有 Homebrew-cask, 可以用来安装图形界面的 App</li><li>homebrew-bundle 类似 node 中的 package.json 或者 Cocoapods 中的 Podfile</li><li>我们将需要的包和 App, 声明在一个 Brewfile 中, 然后执行 brew bundle 即可安装所有包</li></ol><h3 id="homebrew-bundle-如何备份"><a href="#homebrew-bundle-如何备份" class="headerlink" title="homebrew-bundle 如何备份"></a>homebrew-bundle 如何备份</h3><p>备份列表包含:</p><ol><li>brew tap 中的软件库</li><li>brew 安装的命令行工具</li><li>brew cask 安装的 App</li><li>Mac App Store 安装的 App</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行 brew bundle dump 备份命令 </span></span><br><span class="line">brew bundle dump --describe --force --file=<span class="string">"~/Desktop/Brewfile"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明 </span></span><br><span class="line">--describe：为列表中的命令行工具加上说明性文字。</span><br><span class="line">--force：直接覆盖之前生成的 Brewfile 文件。如果没有该参数，则询问你是否覆盖。</span><br><span class="line">--file=<span class="string">"~/Desktop/Brewfile"</span>：在指定位置生成文件。如果没有该参数，则在当前目录生成 Brewfile 文件。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该命令会在桌面上生成 Brewfile 文件，双击打开查看，其内容类似于 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 该部分是 brew 中的 tap，相当于一个个软件库 </span></span><br><span class="line">tap <span class="string">"homebrew/bundle"</span></span><br><span class="line">tap <span class="string">"homebrew/cask"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 该部分是 brew 安装的命令行工具 </span></span><br><span class="line"><span class="comment"># Mac App Store command-line interface</span></span><br><span class="line">brew <span class="string">"mas"</span></span><br><span class="line"><span class="comment"># UNIX shell (command interpreter)</span></span><br><span class="line">brew <span class="string">"zsh"</span></span><br><span class="line"><span class="comment"># Fish shell like syntax highlighting for zsh</span></span><br><span class="line">brew <span class="string">"zsh-syntax-highlighting"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 该部分是 brew cask 安装的 app</span></span><br><span class="line">cask <span class="string">"mounty"</span></span><br><span class="line">cask <span class="string">"dteoh/sqa/slowquitapps"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 该部分是 Mac App Store 安装的 app</span></span><br><span class="line">mas <span class="string">"ting_en"</span>, id: 734383760</span><br><span class="line">mas <span class="string">"Xcode"</span>, id: 497799835</span><br></pre></td></tr></table></figure><h3 id="homebrew-bundle-如何恢复"><a href="#homebrew-bundle-如何恢复" class="headerlink" title="homebrew-bundle 如何恢复"></a>homebrew-bundle 如何恢复</h3><blockquote><p>通过备份的软件列表文件批量安装软件</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Homebrew</span></span><br><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br><span class="line"><span class="comment"># 安装 mas</span></span><br><span class="line">brew install mas</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量安装软件 </span></span><br><span class="line">brew bundle --file=<span class="string">"~/Desktop/Brewfile"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里分享一份自己的真实备份文件 </span></span><br><span class="line">wangao@wangao-MAC ~/Desktop <span class="comment"># cat Brewfile</span></span><br><span class="line">tap <span class="string">"buo/cask-upgrade"</span></span><br><span class="line">tap <span class="string">"dteoh/sqa"</span></span><br><span class="line">tap <span class="string">"homebrew/bundle"</span></span><br><span class="line">tap <span class="string">"homebrew/cask"</span></span><br><span class="line">tap <span class="string">"homebrew/core"</span></span><br><span class="line">tap <span class="string">"homebrew/services"</span></span><br><span class="line"><span class="comment"># GNU compiler collection</span></span><br><span class="line">brew <span class="string">"gcc"</span></span><br><span class="line"><span class="comment"># Distributed revision control system</span></span><br><span class="line">brew <span class="string">"git"</span>, link: <span class="literal">false</span></span><br><span class="line"><span class="comment"># Improved top (interactive process viewer)</span></span><br><span class="line">brew <span class="string">"htop"</span></span><br><span class="line"><span class="comment"># Mac App Store command-line interface</span></span><br><span class="line">brew <span class="string">"mas"</span></span><br><span class="line"><span class="comment"># MySQL database connector for C applications</span></span><br><span class="line">brew <span class="string">"mysql-connector-c"</span></span><br><span class="line"><span class="comment"># Platform built on V8 to build network applications</span></span><br><span class="line">brew <span class="string">"node"</span></span><br><span class="line"><span class="comment"># Perl compatible regular expressions library</span></span><br><span class="line">brew <span class="string">"pcre"</span></span><br><span class="line"><span class="comment"># Password generator</span></span><br><span class="line">brew <span class="string">"pwgen"</span></span><br><span class="line"><span class="comment"># Interpreted, interactive, object-oriented programming language</span></span><br><span class="line">brew <span class="string">"python"</span></span><br><span class="line"><span class="comment"># Interpreted, interactive, object-oriented programming language</span></span><br><span class="line">brew <span class="string">"python@2"</span></span><br><span class="line">brew <span class="string">"sshpass"</span></span><br><span class="line"><span class="comment"># User interface to the TELNET protocol (built from macOS Sierra sources)</span></span><br><span class="line">brew <span class="string">"telnet"</span></span><br><span class="line"><span class="comment"># Display directories as trees (with optional color/HTML output)</span></span><br><span class="line">brew <span class="string">"tree"</span></span><br><span class="line"><span class="comment"># Internet file retriever</span></span><br><span class="line">brew <span class="string">"wget"</span></span><br><span class="line"><span class="comment"># UNIX shell (command interpreter)</span></span><br><span class="line">brew <span class="string">"zsh"</span></span><br><span class="line"><span class="comment"># Fish shell like syntax highlighting for zsh</span></span><br><span class="line">brew <span class="string">"zsh-syntax-highlighting"</span></span><br><span class="line">cask <span class="string">"java"</span></span><br><span class="line">cask <span class="string">"mounty"</span></span><br><span class="line">cask <span class="string">"xquartz"</span></span><br><span class="line">cask <span class="string">"dteoh/sqa/slowquitapps"</span></span><br><span class="line">mas <span class="string">"GarageBand"</span>, id: 682658836</span><br><span class="line">mas <span class="string">"iMovie"</span>, id: 408981434</span><br><span class="line">mas <span class="string">"Keynote"</span>, id: 409183694</span><br><span class="line">mas <span class="string">"Microsoft Remote Desktop"</span>, id: 1295203466</span><br><span class="line">mas <span class="string">"Numbers"</span>, id: 409203825</span><br><span class="line">mas <span class="string">"Pages"</span>, id: 409201541</span><br><span class="line">mas <span class="string">"ting_en"</span>, id: 734383760</span><br><span class="line">mas <span class="string">"Xcode"</span>, id: 497799835</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      macOS 使用 homebrew-bundle 优雅的备份和恢复软件列表
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Zabbix Proxy 分布式监控安装和配置实践</title>
    <link href="https://wsgzao.github.io/post/zabbix-proxy/"/>
    <id>https://wsgzao.github.io/post/zabbix-proxy/</id>
    <published>2018-11-02T06:59:49.000Z</published>
    <updated>2018-11-02T09:18:16.286Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Zabbix 最简单的监控模式莫过于 Zabbix Server -&gt; Zabbix Agent, 默认的监控类型是 Zabbix agent(俗称被动模式)。但是在监控服务器数量越来越多，且地理位置分散在全球各个角落的时候，孤零零的 Zabbix Server 就显得力不从心了，这时候就轮到 Zabbix Proxy 闪亮登场。</p><blockquote><p>Zabbix Proxy 分布式监控安装和配置实践</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 02 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix-proxy/">https://wsgzao.github.io/post/zabbix-proxy/</a></p><p><strong> 扩展阅读 </strong></p><p>Zabbix - <a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p><hr><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://www.zabbix.com/documentation/current/manual/concepts/proxy" target="_blank" rel="noopener">https://www.zabbix.com/documentation/current/manual/concepts/proxy</a><br><a href="https://www.zabbix.com/documentation/3.4/zh/manual/concepts/proxy" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.4/zh/manual/concepts/proxy</a><br><a href="https://www.zabbix.com/download" target="_blank" rel="noopener">https://www.zabbix.com/download</a></p><h2 id="Zabbix-Proxy-介绍"><a href="#Zabbix-Proxy-介绍" class="headerlink" title="Zabbix Proxy 介绍"></a>Zabbix Proxy 介绍</h2><p>Zabbix Proxy 可以代替 Zabbix Server 检索客户端的数据，然后把数据汇报给 Zabbix Server，<br>并且在一定程度上分担了 Zabbix Server 的压力。Zabbix Proxy 可以非常简便的实现了集中式、分布式监控。</p><p>Zabbix Proxy 使用场景:</p><ol><li>监控远程区域设备</li><li>监控本地网络不稳定区域</li><li>当 Zabbix 监控上千设备时，使用它来减轻 Server 的压力</li><li>简化 Zabbix 的维护</li></ol><p>Zabbix Proxy 仅仅需要一条 TCP 连接到 Zabbix Server，所以防火墙上仅仅需要加上一条规则即可。<br>Zabbix Proxy 数据库必须和 Zabbix Server 分开，否则数据会被破坏，毕竟这两个数据库的表大部分都相同。<br>总之记住，数据库分开即可。<br>Zabbix Proxy 收集到数据之后，首先将数据缓存在本地，然后在一定的时间之后传递给 Zabbix Server。<br>这个时间由 Zabbix Proxy 配置文件中参数 ProxyLocalBuffer and ProxyOfflineBuffer 决定。    </p><p>Zabbix Proxy 是一个数据收集器，它不计算触发器、不处理事件、不发送报警。</p><h2 id="Zabbix-Proxy-安装"><a href="#Zabbix-Proxy-安装" class="headerlink" title="Zabbix Proxy 安装"></a>Zabbix Proxy 安装</h2><p>Zabbix Proxy 架构变化其实很简单，通常在每个机房搭建一台，最终把数据汇总到 Zabbix Server</p><ol><li>Zabbix Server -&gt; Zabbix Proxy -&gt; Zabbix Agent</li><li>Items 变为 Zabbix agent(active)，俗称主动模式</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zabbix proxy 的依赖就只有数据库了，用于存储配置信息 </span></span><br><span class="line">yum install -y mariadb-server mariadb</span><br><span class="line"><span class="comment"># 启动 mariadb 服务 </span></span><br><span class="line">systemctl start mariadb.service</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb.service</span><br><span class="line"><span class="comment"># 初始化 mysql 数据库，并配置 root 用户密码 </span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 zabbix_proxy 数据库 </span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">mysql&gt; create database zabbix_proxy character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix_proxy.* to zabbix@localhost identified by <span class="string">'zabbix'</span>;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署 zabbix_proxy</span></span><br><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class="line">yum install -y zabbix-proxy-mysql</span><br><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql*/schema.sql.gz | mysql -uzabbix -p zabbix_proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据库用户及密码 </span></span><br><span class="line">vim /etc/zabbix/zabbix_proxy.conf</span><br><span class="line">Server=192.168.56.103</span><br><span class="line">Hostname=zabbix_proxy</span><br><span class="line">DBName=zabbix_proxy</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 Zabbix Server Proxy</span></span><br><span class="line">Administration -&gt; Proxies -&gt; Create proxy</span><br><span class="line">Proxy name: zabbix_proxy</span><br><span class="line">Proxy mode: Active</span><br><span class="line">Proxy address: 192.168.56.101</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 zabbix_proxy</span></span><br><span class="line">systemctl restart zabbix-proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 zabbix_agent 配置指向 zabbix_proxy</span></span><br><span class="line">vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">Server=192.168.56.101,192.168.56.103</span><br><span class="line">ServerActive=192.168.56.101</span><br><span class="line">Hostname=192.168.56.101</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 zabbix_proxy 服务 </span></span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 zabbix_server 中添加代理主机 </span></span><br><span class="line">Configuration -&gt; Hosts -&gt; Create host</span><br><span class="line">Monitored by proxy: zabbix_proxy</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Zabbix Proxy分布式监控安装和配置实践
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Zabbix 常见问题整理</title>
    <link href="https://wsgzao.github.io/post/zabbix-faq/"/>
    <id>https://wsgzao.github.io/post/zabbix-faq/</id>
    <published>2018-11-02T06:59:49.000Z</published>
    <updated>2018-11-07T11:09:30.317Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>根据安装和使用 Zabbix 中遇到的常见报错提示，结合 Zabbix 官网和 Google 到的一些解决方案，简单做下分享</p><blockquote><p>Zabbix 常见问题整理</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 02 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix-faq/">https://wsgzao.github.io/post/zabbix-faq/</a></p><p><strong> 扩展阅读 </strong></p><p>Zabbix - <a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p><hr><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p>Frequently asked questions / Troubleshooting</p><p><a href="https://www.zabbix.org/wiki/Troubleshooting" target="_blank" rel="noopener">https://www.zabbix.org/wiki/Troubleshooting</a><br><a href="https://www.zabbix.com/documentation/current/manual/appendix/faq" target="_blank" rel="noopener">https://www.zabbix.com/documentation/current/manual/appendix/faq</a></p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><blockquote><p>常见错误建议先查看 log，常见的问题通常由权限，防火墙，数据库，参数错误，性能瓶颈等问题导致</p></blockquote><p>1.zabbix_get [7189]: Check access restrictions in Zabbix agent configuration<br>zabbix 的服务器端与客户端连接的主要工具就是 zabbix 里 bin 文件夹下的 zabbix_get 文件，这个命令只能在 zabbix 的 server 端使用</p><p>2.Assuming that agent dropped connection because of access permissions（由于访问权限导致 agent 连接失败）<br>问题实现：zabbix_server 和 zabbix_agent 在同一台机器，server 监听全网地址，agent 监听内网地址。导致上面的报错发生<br>解决方案：把 zabbix_agentd.conf 中 的 server 把 zabbix_server 的公网和内网地址都加行。然后 agent 就可以正常获取到值了</p><ol start="3"><li>解决 zabbix 中文乱码问题</li></ol><p>方法一：下载文泉驿字体<br>yum -y install wqy-microhei-fonts<br>cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /usr/share/fonts/dejavu/DejaVuSans.ttf</p><p>方法二：从 Windows 中拷贝<br>cd /usr/share/zabbix/fonts<br>从 windows 拷贝 simhei.ttf 字体到当前目录<br>替换配置文件<br>vim /usr/share/zabbix/include/defines.inc.php<br>define(‘ZBX_GRAPH_FONT_NAME’,           ‘simhei’)</p><p>4.Zabbix 报 No route to host<br>原来是被客户端的防火墙档掉了，关闭客户端防火墙或者配置相应规则即可</p><p>5.No active checks on server: host [] not found<br>查看监控机上的 / tmp/zabbix_server.log，显示日志：<br>cannot send list of active checks to [192.168.0.1]: host [Zabbix server] not found<br>查看被监控机上的 / tmp/zabbix_agentd.log，显示日志：<br>No active checks on server: host [Zabbix server] not found<br>这是因为通过 zabbix dashboard 页面配置的被监控主机名跟被监控主机上 zabbix_agentd.conf 中配置的 Hostname 不一致。修改为一致的名字后，重启 zabbix_agentd 即可。</p>]]></content>
    
    <summary type="html">
    
      Zabbix常见问题整理
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Zabbix 3.x 升级到 Zabbix 4.x</title>
    <link href="https://wsgzao.github.io/post/zabbix-upgrade/"/>
    <id>https://wsgzao.github.io/post/zabbix-upgrade/</id>
    <published>2018-11-01T06:59:49.000Z</published>
    <updated>2018-11-02T02:28:43.643Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Zabbix 目前已经发布 4.0 LTS 长期支持版，虽然很多插件还停留在 3.4 版本比如 Grafana，但是还是要提前做好准备。生产环境建议暂时保持在 3.4 版本，因为在 4.0 版本中很多语法发生改变，建议仔细评估。最重要的事情提醒三遍，不要忘记备份，不要忘记备份，不要忘记备份。</p><blockquote><p>Zabbix 3.x 升级到 Zabbix 4.x</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 01 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix-upgrade/">https://wsgzao.github.io/post/zabbix-upgrade/</a></p><p><strong> 扩展阅读 </strong></p><p>Zabbix - <a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p><hr><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://www.zabbix.com/documentation/4.0/manual/installation/upgrade_notes_400" target="_blank" rel="noopener">https://www.zabbix.com/documentation/4.0/manual/installation/upgrade_notes_400</a><br><a href="https://www.zabbix.com/documentation/3.4/zh/manual/installation/upgrade" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.4/zh/manual/installation/upgrade</a><br><a href="https://www.zabbix.com/download" target="_blank" rel="noopener">https://www.zabbix.com/download</a></p><h2 id="Zabbix-升级步骤"><a href="#Zabbix-升级步骤" class="headerlink" title="Zabbix 升级步骤"></a>Zabbix 升级步骤</h2><h3 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库全备时间比较长且文件交大，建议压缩或者使用 xtrabackup</span></span><br><span class="line">mysqldump -uzabbix -pzabbix --opt --skip-lock-tables --database zabbix &gt; zabbix.sql</span><br><span class="line">mysqldump -uzabbix -pzabbix --opt --skip-lock-tables --database zabbix | gzip &gt; zabbix_`date +<span class="string">'%Y%m%d%H%M%S'</span>`.sql.gz</span><br></pre></td></tr></table></figure><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止服务 </span></span><br><span class="line">service zabbix-server stop</span><br><span class="line">service zabbix-agent stop</span><br><span class="line">service httpd stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份 zabbix 文件 </span></span><br><span class="line">mkdir /opt/zabbix-backup/</span><br><span class="line">cp /etc/zabbix/zabbix_server.conf /opt/zabbix-backup/</span><br><span class="line">cp /etc/httpd/conf.d/zabbix.conf  /opt/zabbix-backup/</span><br><span class="line">cp -R /usr/share/zabbix/ /opt/zabbix-backup/</span><br><span class="line">cp -R /usr/share/doc/zabbix-* /opt/zabbix-backup/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级 zabbix 源 </span></span><br><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class="line"><span class="comment"># 升级 zabbix</span></span><br><span class="line"><span class="comment"># yum upgrade zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-proxy-mysql</span></span><br><span class="line">yum clean all</span><br><span class="line">yum upgrade zabbix-server-mysql zabbix-web-mysql zabbix-agent </span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 zabbix</span></span><br><span class="line">service zabbix-server start</span><br><span class="line">service zabbix-agent start</span><br><span class="line">service httpd start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查升级日志 </span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/zabbix/zabbix_server.log</span><br><span class="line"></span><br><span class="line">5044:20181101:212148.975 Starting Zabbix Server. Zabbix 4.0.1 (revision 86073).</span><br><span class="line">  5044:20181101:212149.173 ****** Enabled features ******</span><br><span class="line">  5044:20181101:212149.173 SNMP monitoring:           YES</span><br><span class="line">  5044:20181101:212149.173 IPMI monitoring:           YES</span><br><span class="line">  5044:20181101:212149.173 Web monitoring:            YES</span><br><span class="line">  5044:20181101:212149.173 VMware monitoring:         YES</span><br><span class="line">  5044:20181101:212149.173 SMTP authentication:       YES</span><br><span class="line">  5044:20181101:212149.173 Jabber notifications:      YES</span><br><span class="line">  5044:20181101:212149.173 Ez Texting notifications:  YES</span><br><span class="line">  5044:20181101:212149.173 ODBC:                      YES</span><br><span class="line">  5044:20181101:212149.173 SSH2 support:              YES</span><br><span class="line">  5044:20181101:212149.173 IPv6 support:              YES</span><br><span class="line">  5044:20181101:212149.173 TLS support:               YES</span><br><span class="line">  5044:20181101:212149.173 ******************************</span><br><span class="line">  5044:20181101:212149.173 using configuration file: /etc/zabbix/zabbix_server.conf</span><br><span class="line">  5044:20181101:212149.276 current database version (mandatory/optional): 03040000/03040007</span><br><span class="line">  5044:20181101:212149.360 required mandatory version: 04000000</span><br><span class="line">  5044:20181101:212149.361 starting automatic database upgrade</span><br><span class="line">  5044:20181101:212149.774 completed 0% of database upgrade</span><br><span class="line">  5044:20181101:212149.775 completed 1% of database upgrade</span><br><span class="line">  5044:20181101:212149.865 completed 2% of database upgrade</span><br><span class="line">  5044:20181101:212149.867 completed 3% of database upgrade</span><br><span class="line">  5044:20181101:212149.871 completed 4% of database upgrade</span><br><span class="line">  5044:20181101:212149.874 completed 5% of database upgrade</span><br><span class="line">  5044:20181101:212149.922 completed 6% of database upgrade</span><br><span class="line">  5044:20181101:212150.015 completed 7% of database upgrade</span><br><span class="line">  5044:20181101:212150.169 completed 8% of database upgrade</span><br><span class="line">  5044:20181101:212150.314 completed 9% of database upgrade</span><br><span class="line">  5044:20181101:212150.469 completed 10% of database upgrade</span><br><span class="line">  5044:20181101:212150.523 completed 11% of database upgrade</span><br><span class="line">  5044:20181101:212150.563 completed 12% of database upgrade</span><br><span class="line">  5044:20181101:212150.565 completed 13% of database upgrade</span><br><span class="line">  5044:20181101:212150.574 completed 14% of database upgrade</span><br><span class="line">  5044:20181101:212150.621 completed 15% of database upgrade</span><br><span class="line">  5044:20181101:212150.715 completed 16% of database upgrade</span><br><span class="line">  5044:20181101:212150.809 completed 17% of database upgrade</span><br><span class="line">  5044:20181101:212150.818 completed 18% of database upgrade</span><br><span class="line">  5044:20181101:212150.867 completed 19% of database upgrade</span><br><span class="line">  5044:20181101:212150.871 completed 20% of database upgrade</span><br><span class="line">  5044:20181101:212150.959 completed 21% of database upgrade</span><br><span class="line">  5044:20181101:212151.124 completed 22% of database upgrade</span><br><span class="line">  5044:20181101:212151.209 completed 23% of database upgrade</span><br><span class="line">  5044:20181101:212151.272 completed 24% of database upgrade</span><br><span class="line">  5044:20181101:212151.275 completed 25% of database upgrade</span><br><span class="line">  5044:20181101:212151.314 completed 26% of database upgrade</span><br><span class="line">  5044:20181101:212152.118 completed 27% of database upgrade</span><br><span class="line">  5044:20181101:212152.613 completed 28% of database upgrade</span><br><span class="line">  5044:20181101:212153.271 completed 29% of database upgrade</span><br><span class="line">  5044:20181101:212153.570 completed 30% of database upgrade</span><br><span class="line">  5044:20181101:212154.869 completed 31% of database upgrade</span><br><span class="line">  5044:20181101:212156.368 completed 32% of database upgrade</span><br><span class="line">  5044:20181101:212156.665 completed 33% of database upgrade</span><br><span class="line">  5044:20181101:212157.465 completed 34% of database upgrade</span><br><span class="line">  5044:20181101:212157.820 completed 35% of database upgrade</span><br><span class="line">  5044:20181101:212158.509 completed 36% of database upgrade</span><br><span class="line">  5044:20181101:212200.662 completed 37% of database upgrade</span><br><span class="line">  5044:20181101:212200.710 completed 38% of database upgrade</span><br><span class="line">  5044:20181101:212200.715 completed 39% of database upgrade</span><br><span class="line">  5044:20181101:212200.761 completed 40% of database upgrade</span><br><span class="line">  5044:20181101:212200.807 completed 41% of database upgrade</span><br><span class="line">  5044:20181101:212200.810 completed 42% of database upgrade</span><br><span class="line">  5044:20181101:212200.811 completed 43% of database upgrade</span><br><span class="line">  5044:20181101:212200.813 completed 44% of database upgrade</span><br><span class="line">  5044:20181101:212200.815 completed 45% of database upgrade</span><br><span class="line">  5044:20181101:212200.818 completed 46% of database upgrade</span><br><span class="line">  5044:20181101:212200.913 completed 47% of database upgrade</span><br><span class="line">  5044:20181101:212200.960 completed 48% of database upgrade</span><br><span class="line">  5044:20181101:212201.013 completed 49% of database upgrade</span><br><span class="line">  5044:20181101:212201.116 completed 50% of database upgrade</span><br><span class="line">  5044:20181101:212201.119 completed 51% of database upgrade</span><br><span class="line">  5044:20181101:212201.157 completed 52% of database upgrade</span><br><span class="line">  5044:20181101:212201.160 completed 53% of database upgrade</span><br><span class="line">  5044:20181101:212201.164 completed 54% of database upgrade</span><br><span class="line">  5044:20181101:212201.166 completed 55% of database upgrade</span><br><span class="line">  5044:20181101:212201.169 completed 56% of database upgrade</span><br><span class="line">  5044:20181101:212201.206 completed 57% of database upgrade</span><br><span class="line">  5044:20181101:212201.208 completed 58% of database upgrade</span><br><span class="line">  5044:20181101:212201.305 completed 59% of database upgrade</span><br><span class="line">  5044:20181101:212201.308 completed 60% of database upgrade</span><br><span class="line">  5044:20181101:212201.311 completed 61% of database upgrade</span><br><span class="line">  5044:20181101:212201.356 completed 62% of database upgrade</span><br><span class="line">  5044:20181101:212201.363 completed 63% of database upgrade</span><br><span class="line">  5044:20181101:212201.413 completed 64% of database upgrade</span><br><span class="line">  5044:20181101:212201.414 completed 65% of database upgrade</span><br><span class="line">  5044:20181101:212201.465 completed 66% of database upgrade</span><br><span class="line">  5044:20181101:212201.517 completed 67% of database upgrade</span><br><span class="line">  5044:20181101:212201.562 completed 68% of database upgrade</span><br><span class="line">  5044:20181101:212201.656 completed 69% of database upgrade</span><br><span class="line">  5044:20181101:212201.666 completed 70% of database upgrade</span><br><span class="line">  5044:20181101:212201.719 completed 71% of database upgrade</span><br><span class="line">  5044:20181101:212201.758 completed 72% of database upgrade</span><br><span class="line">  5044:20181101:212201.760 completed 73% of database upgrade</span><br><span class="line">  5044:20181101:212201.764 completed 74% of database upgrade</span><br><span class="line">  5044:20181101:212201.766 completed 75% of database upgrade</span><br><span class="line">  5044:20181101:212201.817 completed 76% of database upgrade</span><br><span class="line">  5044:20181101:212201.862 completed 77% of database upgrade</span><br><span class="line">  5044:20181101:212202.054 completed 78% of database upgrade</span><br><span class="line">  5044:20181101:212202.112 completed 79% of database upgrade</span><br><span class="line">  5044:20181101:212202.158 completed 80% of database upgrade</span><br><span class="line">  5044:20181101:212202.210 completed 81% of database upgrade</span><br><span class="line">  5044:20181101:212202.261 completed 82% of database upgrade</span><br><span class="line">  5044:20181101:212202.315 completed 83% of database upgrade</span><br><span class="line">  5044:20181101:212202.566 completed 84% of database upgrade</span><br><span class="line">  5044:20181101:212202.609 completed 85% of database upgrade</span><br><span class="line">  5044:20181101:212202.619 completed 86% of database upgrade</span><br><span class="line">  5044:20181101:212202.656 completed 87% of database upgrade</span><br><span class="line">  5044:20181101:212202.659 completed 88% of database upgrade</span><br><span class="line">  5044:20181101:212202.661 completed 89% of database upgrade</span><br><span class="line">  5044:20181101:212202.669 completed 90% of database upgrade</span><br><span class="line">  5044:20181101:212202.761 completed 91% of database upgrade</span><br><span class="line">  5044:20181101:212203.214 completed 92% of database upgrade</span><br><span class="line">  5044:20181101:212203.360 completed 93% of database upgrade</span><br><span class="line">  5044:20181101:212203.365 completed 94% of database upgrade</span><br><span class="line">  5044:20181101:212203.403 completed 95% of database upgrade</span><br><span class="line">  5044:20181101:212203.417 completed 96% of database upgrade</span><br><span class="line">  5044:20181101:212203.467 completed 97% of database upgrade</span><br><span class="line">  5044:20181101:212203.508 completed 98% of database upgrade</span><br><span class="line">  5044:20181101:212203.564 completed 99% of database upgrade</span><br><span class="line">  5044:20181101:212203.566 completed 100% of database upgrade</span><br><span class="line">  5044:20181101:212203.566 database upgrade fully completed</span><br><span class="line">  5044:20181101:212203.660 starting event name update forced by database upgrade</span><br><span class="line">  5044:20181101:212203.706 completed 1% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 2% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 3% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 4% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 5% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 6% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 7% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 8% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 9% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 10% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 11% of event name update</span><br><span class="line">  5044:20181101:212203.706 completed 12% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 13% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 14% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 15% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 16% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 17% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 18% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 19% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 20% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 21% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 22% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 23% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 24% of event name update</span><br><span class="line">  5044:20181101:212203.707 completed 25% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 26% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 27% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 28% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 29% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 30% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 31% of event name update</span><br><span class="line">  5044:20181101:212203.708 completed 32% of event name update</span><br><span class="line">  5044:20181101:212203.710 completed 33% of event name update</span><br><span class="line">  5044:20181101:212203.712 completed 34% of event name update</span><br><span class="line">  5044:20181101:212203.714 completed 35% of event name update</span><br><span class="line">  5044:20181101:212203.717 completed 36% of event name update</span><br><span class="line">  5044:20181101:212203.717 completed 37% of event name update</span><br><span class="line">  5044:20181101:212203.717 completed 38% of event name update</span><br><span class="line">  5044:20181101:212203.717 completed 39% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 40% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 41% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 42% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 43% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 44% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 45% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 46% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 47% of event name update</span><br><span class="line">  5044:20181101:212203.718 completed 48% of event name update</span><br><span class="line">  5044:20181101:212203.719 completed 49% of event name update</span><br><span class="line">  5044:20181101:212203.719 completed 50% of event name update</span><br><span class="line">  5044:20181101:212203.758 completed 51% of event name update</span><br><span class="line">  5044:20181101:212203.804 completed 52% of event name update</span><br><span class="line">  5044:20181101:212203.804 completed 53% of event name update</span><br><span class="line">  5044:20181101:212203.804 completed 54% of event name update</span><br><span class="line">  5044:20181101:212203.804 completed 55% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 56% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 57% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 58% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 59% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 60% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 61% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 62% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 63% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 64% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 65% of event name update</span><br><span class="line">  5044:20181101:212203.805 completed 66% of event name update</span><br><span class="line">  5044:20181101:212203.806 completed 67% of event name update</span><br><span class="line">  5044:20181101:212203.806 completed 68% of event name update</span><br><span class="line">  5044:20181101:212203.806 completed 69% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 70% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 71% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 72% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 73% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 74% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 75% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 76% of event name update</span><br><span class="line">  5044:20181101:212203.807 completed 77% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 78% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 79% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 80% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 81% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 82% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 83% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 84% of event name update</span><br><span class="line">  5044:20181101:212203.808 completed 85% of event name update</span><br><span class="line">  5044:20181101:212203.809 completed 86% of event name update</span><br><span class="line">  5044:20181101:212203.809 completed 87% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 88% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 89% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 90% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 91% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 92% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 93% of event name update</span><br><span class="line">  5044:20181101:212203.810 completed 94% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 95% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 96% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 97% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 98% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 99% of event name update</span><br><span class="line">  5044:20181101:212203.811 completed 100% of event name update</span><br><span class="line">  5044:20181101:212205.304 event name update completed</span><br></pre></td></tr></table></figure><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止服务 </span></span><br><span class="line">service zabbix-server stop</span><br><span class="line">service zabbix-agent stop</span><br><span class="line">service apache2 stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份 zabbix 文件 </span></span><br><span class="line">mkdir /opt/zabbix-backup/</span><br><span class="line">cp /etc/zabbix/zabbix_server.conf /opt/zabbix-backup/</span><br><span class="line">cp /etc/apache2/conf-enabled/zabbix.conf /opt/zabbix-backup/</span><br><span class="line">cp -R /usr/share/zabbix/ /opt/zabbix-backup/ </span><br><span class="line">cp -R /usr/share/doc/zabbix-* /opt/zabbix-backup/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级 zabbix 源 </span></span><br><span class="line">rm -Rf /etc/apt/sources.list.d/zabbix.list</span><br><span class="line">wget https://repo.zabbix.com/zabbix/4.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_4.0-2+bionic_all.deb</span><br><span class="line">dpkg -i zabbix-release_4.0-2+xenial_all.deb</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加时出现问题：dpkg: error: dpkg status database is locked by another process</span></span><br><span class="line">rm /var/lib/dpkg/lock</span><br><span class="line">dpkg --configure -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级 zabbix</span></span><br><span class="line"><span class="comment"># apt-get install --only-upgrade zabbix-server-mysql zabbix-frontend-php zabbix-agent zabbix-proxy-mysql</span></span><br><span class="line">apt-get install --only-upgrade zabbix-server-mysql zabbix-frontend-php zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 zabbix</span></span><br><span class="line">service zabbix-server start</span><br><span class="line">service zabbix-agent start</span><br><span class="line">service apache2 start</span><br></pre></td></tr></table></figure><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><ol><li>拉取最新镜像</li><li>停止并删除当前运行容器</li><li>用最新镜像重新创建容器</li><li>All Done</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前系统中使用的镜像 </span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 拉取最新镜像 </span></span><br><span class="line">docker pull zabbix/zabbix-web-nginx-mysql</span><br><span class="line">docker pull zabbix/zabbix-server-mysql</span><br><span class="line"><span class="comment"># 查找容器 ID</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 导出之前的容器配置信息 </span></span><br><span class="line">docker inspect 14fd67405076</span><br><span class="line"><span class="comment"># 停止容器 </span></span><br><span class="line">docker stop 14fd67405076</span><br><span class="line">docker <span class="built_in">kill</span> 14fd67405076</span><br><span class="line"><span class="comment"># 删除容器 </span></span><br><span class="line">docker rm 14fd67405076</span><br><span class="line"><span class="comment"># 用最新镜像重新创建容器 </span></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">-v /data/docker/zabbix/alertscripts:/usr/lib/zabbix/alertscripts \</span><br><span class="line">-v /data/docker/zabbix/externalscripts:/usr/lib/zabbix/externalscripts \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-server-mysql</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">"Asia/Singapore"</span> \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-web-nginx-mysql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Zabbix 3.x 升级到 Zabbix 4.x
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Zabbix 安装和使用配置小结</title>
    <link href="https://wsgzao.github.io/post/zabbix/"/>
    <id>https://wsgzao.github.io/post/zabbix/</id>
    <published>2018-11-01T06:59:49.000Z</published>
    <updated>2018-11-15T03:45:03.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Zabbix 是目前最为主流的开源监控方案之一，部署本身并不困难，难的是深入理解。根据在生产环境的实践从新版 Zabbix 4.0 LTS 开始全部使用 Docker 部署，我相信未来越来越多的开源组件都会以容器化的形式呈现在我们面前。</p><blockquote><p>Zabbix 安装和使用配置小结</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 11 月 01 日 - 更新官方 LAMP 部署过程<br>2018 年 10 月 16 日 - 更新 Docker 部署 Zabbix 4.0<br>2018 年 08 月 06 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix/">https://wsgzao.github.io/post/zabbix/</a></p><p><strong> 扩展阅读 </strong></p><p>Zabbix - <a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p><hr><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://www.zabbix.com/download" target="_blank" rel="noopener">https://www.zabbix.com/download</a><br><a href="https://www.zabbix.com/documentation" target="_blank" rel="noopener">https://www.zabbix.com/documentation</a></p><h2 id="Zabbix-Server"><a href="#Zabbix-Server" class="headerlink" title="Zabbix Server"></a>Zabbix Server</h2><blockquote><p>基于官方的 LAMP 架构，按照最简单的原生方式来部署，不做任何多余优化</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装必要依赖包 </span></span><br><span class="line">yum install -y httpd mariadb-server mariadb php php-mysql php-gd libjpeg* php-ldap php-odbc php-pear php-xml php-xmlrpc php-mhash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 apache 配置 </span></span><br><span class="line">vi /etc/httpd/conf/httpd.conf</span><br><span class="line">ServerName 192.168.56.103</span><br><span class="line">DirectoryIndex index.html index.php</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 php 时区 </span></span><br><span class="line">vi /etc/php.ini</span><br><span class="line">date.timezone = Asia/Singapore</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 httpd 服务 </span></span><br><span class="line">systemctl start httpd.service</span><br><span class="line"><span class="comment"># 启动 mariadb 服务 </span></span><br><span class="line">systemctl start mariadb.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 mysql 数据库，并配置 root 用户密码 </span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 万一新版本忘记随机密码可以通过日志获取 </span></span><br><span class="line">grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个测试页，测试 LAMP 是否搭建成功 </span></span><br><span class="line">cat &gt; /var/www/html/index.php &lt;&lt; EOF</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 zabbix 数据库 </span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by <span class="string">'zabbix'</span>;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署 zabbix</span></span><br><span class="line">rpm -i https://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br><span class="line">yum install -y zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br><span class="line">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据库用户及密码 </span></span><br><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBPassword=zabbix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改时区 </span></span><br><span class="line">vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">php_value date.timezone Asia/Singapore</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 zabbix 并设置自启动服务 </span></span><br><span class="line">systemctl restart zabbix-server zabbix-agent httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-server zabbix-agent httpd mariadb</span><br></pre></td></tr></table></figure><blockquote><p>以下是基于 LNMP 手动编译安装 Zabbix 的过程，仅供参考</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># hostname</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname &lt;host-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># firewall</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># selinux</span></span><br><span class="line">getenforce</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">"s/SELINUX=enforcing/SELINUX=disabled/g"</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># epel</span></span><br><span class="line">yum install epel-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx</span></span><br><span class="line">yum install nginx</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">systemctl start nginx</span><br><span class="line">systemctl status nginx</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql | mariadb</span></span><br><span class="line">yum -y install mariadb mariadb-server</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb.service</span><br><span class="line">systemctl start mariadb.service</span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment"># php</span></span><br><span class="line">wget http://cn2.php.net/distributions/php-7.2.8.tar.gz</span><br><span class="line">tar xf php-7.2.8.tar.gz </span><br><span class="line"><span class="built_in">cd</span> ./php-7.2.8/</span><br><span class="line">yum install -y libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel </span><br><span class="line">yum install -y libmcrypt libmcrypt-devel gcc</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/php --with-config-file-path=/etc --<span class="built_in">enable</span>-fpm --with-fpm-user=nginx  --with-fpm-group=nginx --<span class="built_in">enable</span>-inline-optimization --<span class="built_in">disable</span>-debug --<span class="built_in">disable</span>-rpath --<span class="built_in">enable</span>-shared  --<span class="built_in">enable</span>-soap --with-libxml-dir --with-xmlrpc --with-openssl --with-mcrypt --with-mhash --with-pcre-regex --with-sqlite3 --with-zlib --<span class="built_in">enable</span>-bcmath  --with-iconv --with-bz2 --<span class="built_in">enable</span>-calendar --with-curl --with-cdb --<span class="built_in">enable</span>-dom --<span class="built_in">enable</span>-exif --<span class="built_in">enable</span>-fileinfo --<span class="built_in">enable</span>-filter --with-pcre-dir --<span class="built_in">enable</span>-ftp --with-gd --with-openssl-dir  --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir --<span class="built_in">enable</span>-gd-native-ttf --<span class="built_in">enable</span>-gd-jis-conv --with-gettext --with-gmp --with-mhash --<span class="built_in">enable</span>-json --<span class="built_in">enable</span>-mbstring --<span class="built_in">enable</span>-mbregex --<span class="built_in">enable</span>-mbregex-backtrack --with-libmbfl --with-onig --<span class="built_in">enable</span>-pdo --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-zlib-dir --with-pdo-sqlite --with-readline --<span class="built_in">enable</span>-session --<span class="built_in">enable</span>-shmop --<span class="built_in">enable</span>-simplexml --<span class="built_in">enable</span>-sockets  --<span class="built_in">enable</span>-sysvmsg --<span class="built_in">enable</span>-sysvsem --<span class="built_in">enable</span>-sysvshm --<span class="built_in">enable</span>-wddx --with-libxml-dir --with-xsl --<span class="built_in">enable</span>-zip --<span class="built_in">enable</span>-mysqlnd-compression-support --with-pear --<span class="built_in">enable</span>-opcache</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/php/bin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">php -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># php-fpm </span></span><br><span class="line">cp ./php.ini-production /etc/php.ini</span><br><span class="line">cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line">cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.d/www.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.d/www.conf</span><br><span class="line">cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line">chmod +x /etc/init.d/php-fpm</span><br><span class="line"></span><br><span class="line">vi /etc/php.ini</span><br><span class="line"></span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">memory_limit = 128M</span><br><span class="line">post_max_size = 16M</span><br><span class="line">date.timezone = Asia/Singapore</span><br><span class="line"></span><br><span class="line">/etc/init.d/php-fpm start</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx</span></span><br><span class="line">vi /etc/nginx/conf.d/default.conf</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line">    root /data/www;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index  index.php index.html index.htm;</span><br><span class="line">        <span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            rewrite ^/(.*)$ /index.php/<span class="variable">$1</span>;</span><br><span class="line">            <span class="comment">#rewrite ^/subdir/(.*)$ /subdir/index.php/$1;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#proxy the php scripts to php-fpm</span></span><br><span class="line">    location ~ \.php &#123;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$path_info</span> <span class="string">""</span>;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$real_script_name</span> <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$fastcgi_script_name</span> ~ <span class="string">"^(.+?\.php)(/.+)$"</span>) &#123;</span><br><span class="line">            <span class="built_in">set</span> <span class="variable">$real_script_name</span> <span class="variable">$1</span>;</span><br><span class="line">            <span class="built_in">set</span> <span class="variable">$path_info</span> <span class="variable">$2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$real_script_name</span>;</span><br><span class="line">        fastcgi_param SCRIPT_NAME <span class="variable">$real_script_name</span>;</span><br><span class="line">        fastcgi_param PATH_INFO <span class="variable">$path_info</span>;</span><br><span class="line">        fastcgi_intercept_errors on;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">vi /data/www/info.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">    phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/info.php </span><br><span class="line"></span><br><span class="line"><span class="comment"># zabbix-server</span></span><br><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br><span class="line">yum -y install zabbix-server-mysql zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># create zabbix in db</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">grant all privileges on zabbix.* to <span class="string">'zabbix'</span>@<span class="string">'%'</span> identified by <span class="string">'zabbix'</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-3.4.11/</span><br><span class="line">zcat create.sql.gz | mysql -u root -p zabbix</span><br><span class="line"></span><br><span class="line">vi /etc/zabbix/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line"></span><br><span class="line">chown -R zabbix:zabbix /etc/zabbix</span><br><span class="line">chown -R zabbix:zabbix /usr/lib/zabbix</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-server</span><br><span class="line">systemctl start zabbix-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># zabbix-web</span></span><br><span class="line">wget -O zabbix-3.4.11.tar.gz https://excellmedia.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.4.11/zabbix-3.4.11.tar.gz</span><br><span class="line">tar zxvf zabbix-3.4.11.tar.gz</span><br><span class="line">cp -rf ./zabbix-3.4.11/frontends/php/ /data/www/zabbix</span><br><span class="line">mv /data/www/zabbix/conf/zabbix.conf.php.example /data/www/zabbix/conf/zabbix.conf.php </span><br><span class="line">vi /data/www/zabbix/conf/zabbix.conf.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">// Zabbix GUI configuration file.</span><br><span class="line">global <span class="variable">$DB</span>, <span class="variable">$HISTORY</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'TYPE'</span>]                             = <span class="string">'MYSQL'</span>;</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'SERVER'</span>]                   = <span class="string">'127.0.0.1'</span>;</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'PORT'</span>]                             = <span class="string">'0'</span>;</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'DATABASE'</span>]                 = <span class="string">'zabbix'</span>;</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'USER'</span>]                             = <span class="string">'zabbix'</span>;</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'PASSWORD'</span>]                 = <span class="string">'zabbix'</span>;</span><br><span class="line">// Schema name. Used <span class="keyword">for</span> IBM DB2 and PostgreSQL.</span><br><span class="line"><span class="variable">$DB</span>[<span class="string">'SCHEMA'</span>]                   = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ZBX_SERVER</span>                             = <span class="string">'localhost'</span>;</span><br><span class="line"><span class="variable">$ZBX_SERVER_PORT</span>                = <span class="string">'10051'</span>;</span><br><span class="line"><span class="variable">$ZBX_SERVER_NAME</span>                = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$IMAGE_FORMAT_DEFAULT</span>   = IMAGE_FORMAT_PNG;</span><br><span class="line"></span><br><span class="line">// Elasticsearch url (can be string <span class="keyword">if</span> same url is used <span class="keyword">for</span> all types).</span><br><span class="line"><span class="variable">$HISTORY</span>[<span class="string">'url'</span>]   = [</span><br><span class="line">                <span class="string">'uint'</span> =&gt; <span class="string">'http://127.0.0.1:9200'</span>,</span><br><span class="line">                <span class="string">'text'</span> =&gt; <span class="string">'http://127.0.0.1:9200'</span></span><br><span class="line">];</span><br><span class="line">// Value types stored <span class="keyword">in</span> Elasticsearch.</span><br><span class="line"><span class="variable">$HISTORY</span>[<span class="string">'types'</span>] = [<span class="string">'uint'</span>, <span class="string">'text'</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://127.0.0.1/zabbix</span><br><span class="line"></span><br><span class="line"><span class="comment">## zabbix-agent</span></span><br><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br><span class="line">yum -y install zabbix-agent</span><br><span class="line">vi /etc/zabbix/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line">Server=127.0.0.1</span><br><span class="line">ServerActive=127.0.0.1</span><br><span class="line">Hostname=Zabbix server</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent</span><br><span class="line">systemctl start zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU test</span></span><br><span class="line"></span><br><span class="line">CPU use percent gt 80%</span><br><span class="line">&#123;Template OS Linux:system.cpu.util[,idle].avg(1m)&#125;&lt;80</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scale=5000; 4*a(1)"</span> | bc -l -q</span><br></pre></td></tr></table></figure><h2 id="Zabbix-表分区优化"><a href="#Zabbix-表分区优化" class="headerlink" title="Zabbix 表分区优化"></a>Zabbix 表分区优化</h2><p><a href="https://www.zabbix.org/wiki/Docs/howto/mysql_partition" target="_blank" rel="noopener">https://www.zabbix.org/wiki/Docs/howto/mysql_partition</a><br><a href="https://cloud.tencent.com/developer/article/1006301" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1006301</a></p><p>Zabbix 数据库优化<br>目的: 快速清理历史数据，并减少数据存储容量<br>方法: 历史表使用分区表 (删除分区表速度快), 使用 Tokudb 引擎 (适合大量 insert 少量 update 和 select 等日志表)<br>Zabbix 版本: 3.4<br>涉及表项:<br>存储不同类型 item 的历史数据，最终 1 小时或者 1 天等段时间的绘图数据从其中获取<br>history、history_log、history_str、history_text、history_uint<br>存储不同类型 item 的历史趋势数据，每隔一小时从历史数据中统计一次，并计算统计区间的平均值，最大值，最小值 trends、trends_uint</p><p>zabbix 的 db 有做分表 根据这个来的<br><a href="https://www.zabbix.org/wiki/Docs/howto/mysql_partition" target="_blank" rel="noopener">https://www.zabbix.org/wiki/Docs/howto/mysql_partition</a><br>cronjob 里的脚本包括了建新表和删除旧表, 用 mysql 的 procedure 控制, 删除旧表可以释放空间<br>想要修改短一点，需要修改 procedure partition_maintenance_all 里规定的时间<br>我的做法是 Drop 旧 procedure 再创建新的</p><p>存储过程执行后将可以使用命令对想要分区的表进行表分区了，其中的参数我这里解释一下。</p><p>CALL partition_maintenance(‘&lt;zabbix_db_name&gt;’, ‘&lt;table_name&gt;’, &lt;days_to_keep_data&gt;, &lt;hourly_interval&gt;, &lt;num_future_intervals_to_create&gt;)</p><p>这是举例：</p><pre><code>CALL partition_maintenance(zabbix, &apos;history_uint&apos;, 31, 24, 14);</code></pre><p>zabbix_db_name：库名<br>table_name：表名<br>days_to_keep_data：保存多少天的数据<br>hourly_interval：每隔多久生成一个分区<br>num_future_intervals_to_create：本次一共生成多少个分区</p><p>这个例子就是 history_uint 表最多保存 31 天的数据，每隔 24 小时生成一个分区，这次一共生成 14 个分区</p><p>这里可以将上面四个存储过程保存为一个文件，导入到数据库中，文件我稍后将会放在附件中，这里使用的命令是</p><pre><code>mysql -uzabbix -pzabbix zabbix&lt;partition_call.sql</code></pre><p>然后可以将 CALL 统一调用也做成一个文件</p><blockquote><p>关闭 zabbix 的 housekeeper 功能</p></blockquote><ol><li>login mysql zabbix</li><li>DROP PROCEDURE IF EXISTS partition_maintenance_all</li><li>根据需要修改括号内第三列的时间，估计得改成 45 或者 30 了。每列的定义请参照最上面给的链接</li><li>再手动跑下 cronjob 内的那个指令就好</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-gop-10-65-200-90 mysql]<span class="comment"># grep -Ev '^$|#' /etc/zabbix/zabbix_server.conf</span></span><br><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_server.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_server.pid</span><br><span class="line">SocketDir=/var/run/zabbix</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line">StartPollers=500</span><br><span class="line">StartPingers=50</span><br><span class="line">SNMPTrapperFile=/var/<span class="built_in">log</span>/snmptrap/snmptrap.log</span><br><span class="line">CacheSize=8G</span><br><span class="line">TrendCacheSize=1G</span><br><span class="line">Timeout=15</span><br><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class="line">LogSlowQueries=3000</span><br><span class="line"></span><br><span class="line">[root@sg-gop-10-65-200-90 percona-server.conf.d]<span class="comment"># grep -Ev '^$|#' /etc/percona-server.conf.d/mysqld.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="built_in">log</span>-error=/var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">max_connections=1000</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"># login mysql</span><br><span class="line">mysql -uroot -p</span><br><span class="line">zabbix</span><br><span class="line"></span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show variables like '%dir%';</span><br><span class="line">+<span class="comment">-----------------------------------------+-------------------------------------+</span></span><br><span class="line">| Variable_name                           | Value                               |</span><br><span class="line">+<span class="comment">-----------------------------------------+-------------------------------------+</span></span><br><span class="line">| basedir                                 | /usr/                               |</span><br><span class="line">| binlog_direct_non_transactional_updates | OFF                                 |</span><br><span class="line">| character_sets_dir                      | /usr/share/percona-server/charsets/ |</span><br><span class="line">| datadir                                 | /var/lib/mysql/                     |</span><br><span class="line">| ignore_db_dirs                          |                                     |</span><br><span class="line">| innodb_data_home_dir                    |                                     |</span><br><span class="line">| innodb_log_group_home_dir               | ./                                  |</span><br><span class="line">| innodb_max_dirty_pages_pct              | 75.000000                           |</span><br><span class="line">| innodb_max_dirty_pages_pct_lwm          | 0.000000                            |</span><br><span class="line">| innodb_tmpdir                           |                                     |</span><br><span class="line">| innodb_undo_directory                   | ./                                  |</span><br><span class="line">| lc_messages_dir                         | /usr/share/percona-server/          |</span><br><span class="line">| plugin_dir                              | /usr/lib64/mysql/plugin/            |</span><br><span class="line">| slave_load_tmpdir                       | /tmp                                |</span><br><span class="line">| tmpdir                                  | /tmp                                |</span><br><span class="line">+<span class="comment">-----------------------------------------+-------------------------------------+</span></span><br><span class="line">15 rows in <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br><span class="line"><span class="keyword">SELECT</span> table_name <span class="keyword">AS</span> <span class="string">"Tables"</span>,</span><br><span class="line"><span class="keyword">round</span>(((data_length + index_length) / <span class="number">1024</span> / <span class="number">1024</span>), <span class="number">2</span>) <span class="string">"Size in MB"</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLES</span><br><span class="line"><span class="keyword">WHERE</span> table_schema = <span class="string">'zabbix'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (data_length + index_length) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----------------------------+------------+</span></span><br><span class="line">| Tables                     | Size in MB |</span><br><span class="line">+<span class="comment">----------------------------+------------+</span></span><br><span class="line">| history                    |  545043.75 |</span><br><span class="line">| history_uint               |   44729.66 |</span><br><span class="line">| trends                     |   13500.41 |</span><br><span class="line">| trends_uint                |    1666.66 |</span><br><span class="line">| history_text               |     650.31 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Zabbix &gt; 3.2, history 30, Trends 300</span><br><span class="line"></span><br><span class="line">#cat partition.sql</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_create`</span>(SCHEMANAME <span class="built_in">varchar</span>(<span class="number">64</span>), TABLENAME <span class="built_in">varchar</span>(<span class="number">64</span>), PARTITIONNAME <span class="built_in">varchar</span>(<span class="number">64</span>), CLOCK <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           PARTITIONNAME = The name of the partition to create</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Verify that the partition does not already exist</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_description &gt;= CLOCK;</span><br><span class="line"></span><br><span class="line">        IF RETROWS = 0 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Print a message indicating that a partition was created.</span></span><br><span class="line"><span class="comment">                   2. Create the SQL to create the partition.</span></span><br><span class="line"><span class="comment">                   3. Execute the SQL from #2.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>( <span class="string">"partition_create("</span>, SCHEMANAME, <span class="string">","</span>, TABLENAME, <span class="string">","</span>, PARTITIONNAME, <span class="string">","</span>, CLOCK, <span class="string">")"</span> ) <span class="keyword">AS</span> msg;</span><br><span class="line">                <span class="keyword">SET</span> @<span class="keyword">sql</span> = <span class="keyword">CONCAT</span>( <span class="string">'ALTER TABLE'</span>, SCHEMANAME, <span class="string">'.'</span>, TABLENAME, <span class="string">'ADD PARTITION (PARTITION'</span>, PARTITIONNAME, <span class="string">'VALUES LESS THAN ('</span>, CLOCK, <span class="string">'));'</span> );</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @<span class="keyword">sql</span>;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_drop`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), DELETE_BELOW_PARTITION_DATE <span class="built_in">BIGINT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           DELETE_BELOW_PARTITION_DATE = Delete any partitions with names that are dates older than this one (yyyy-mm-dd)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> done <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> drop_part_name <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Get a list of all the partitions that are older than the date</span></span><br><span class="line"><span class="comment">           in DELETE_BELOW_PARTITION_DATE.  All partitions are prefixed with</span></span><br><span class="line"><span class="comment">           a "p", so use SUBSTRING TO get rid of that character.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> myCursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">                <span class="keyword">SELECT</span> partition_name</span><br><span class="line">                <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">                <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> <span class="keyword">CAST</span>(<span class="keyword">SUBSTRING</span>(partition_name <span class="keyword">FROM</span> <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">UNSIGNED</span>) &lt; DELETE_BELOW_PARTITION_DATE;</span><br><span class="line">        <span class="keyword">DECLARE</span> CONTINUE <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">NOT</span> <span class="keyword">FOUND</span> <span class="keyword">SET</span> done = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Create the basics for when we need to drop the partition.  Also, create</span></span><br><span class="line"><span class="comment">           @drop_partitions to hold a comma-delimited list of all partitions that</span></span><br><span class="line"><span class="comment">           should be deleted.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">SET</span> @alter_header = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE"</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">"DROP PARTITION"</span>);</span><br><span class="line">        <span class="keyword">SET</span> @drop_partitions = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Start looping through all the partitions that are too old.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        OPEN myCursor;</span><br><span class="line">        read_loop: LOOP</span><br><span class="line">                FETCH myCursor INTO drop_part_name;</span><br><span class="line">                IF done THEN</span><br><span class="line">                        LEAVE read_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @drop_partitions = <span class="keyword">IF</span>(@drop_partitions = <span class="string">""</span>, drop_part_name, <span class="keyword">CONCAT</span>(@drop_partitions, <span class="string">","</span>, drop_part_name));</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">        IF @drop_partitions != ""THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Build the SQL to drop all the necessary partitions.</span></span><br><span class="line"><span class="comment">                   2. Run the SQL to drop the partitions.</span></span><br><span class="line"><span class="comment">                   3. Print out the table partitions that were deleted.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SET</span> @full_sql = <span class="keyword">CONCAT</span>(@alter_header, @drop_partitions, <span class="string">";"</span>);</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @full_sql;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, @drop_partitions <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        ELSE</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   No partitions are being deleted, so print out"N/A"(Not applicable) to indicate</span></span><br><span class="line"><span class="comment">                   that no changes were made.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, <span class="string">"N/A"</span> <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_maintenance`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), TABLE_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), KEEP_DATA_DAYS <span class="built_in">INT</span>, HOURLY_INTERVAL <span class="built_in">INT</span>, CREATE_NEXT_INTERVALS <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> OLDER_THAN_PARTITION_DATE <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> OLD_PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> LESS_THAN_TIMESTAMP <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> CUR_TIME <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">CALL</span> partition_verify(SCHEMA_NAME, TABLE_NAME, HOURLY_INTERVAL);</span><br><span class="line">        <span class="keyword">SET</span> CUR_TIME = <span class="keyword">UNIX_TIMESTAMP</span>(<span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'%Y-%m-%d 00:00:00'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> @__interval = <span class="number">1</span>;</span><br><span class="line">        create_loop: LOOP</span><br><span class="line">                IF @__interval &gt; CREATE_NEXT_INTERVALS THEN</span><br><span class="line">                        LEAVE create_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SET</span> LESS_THAN_TIMESTAMP = CUR_TIME + (HOURLY_INTERVAL * @__interval * <span class="number">3600</span>);</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = FROM_UNIXTIME(CUR_TIME + HOURLY_INTERVAL * (@__interval - <span class="number">1</span>) * <span class="number">3600</span>, <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line">                IF(PARTITION_NAME != OLD_PARTITION_NAME) THEN</span><br><span class="line">                        <span class="keyword">CALL</span> partition_create(SCHEMA_NAME, TABLE_NAME, PARTITION_NAME, LESS_THAN_TIMESTAMP);</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @__interval=@__interval+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">SET</span> OLD_PARTITION_NAME = PARTITION_NAME;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> OLDER_THAN_PARTITION_DATE=<span class="keyword">DATE_FORMAT</span>(<span class="keyword">DATE_SUB</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> KEEP_DATA_DAYS <span class="keyword">DAY</span>), <span class="string">'%Y%m%d0000'</span>);</span><br><span class="line">        <span class="keyword">CALL</span> partition_drop(SCHEMA_NAME, TABLE_NAME, OLDER_THAN_PARTITION_DATE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_verify`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), HOURLYINTERVAL <span class="built_in">INT</span>(<span class="number">11</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>(<span class="number">11</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> FUTURE_TIMESTAMP <span class="keyword">TIMESTAMP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Check if any partitions exist for the given SCHEMANAME.TABLENAME.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_name <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If partitions do not exist, go ahead and partition the table</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        IF RETROWS = 1 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Take the current date at 00:00:00 and add HOURLYINTERVAL to it.  This is the timestamp below which we will store values.</span></span><br><span class="line"><span class="comment">                 * We begin partitioning based on the beginning of a day.  This is because we don't want to generate a random partition</span></span><br><span class="line"><span class="comment">                 * that won't necessarily fall in line with the desired partition naming (ie: if the hour interval is 24 hours, we could</span></span><br><span class="line"><span class="comment">                 * end up creating a partition now named"p201403270600"when all other partitions will be like"p201403280000").</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">SET</span> FUTURE_TIMESTAMP = <span class="keyword">TIMESTAMPADD</span>(<span class="keyword">HOUR</span>, HOURLYINTERVAL, <span class="keyword">CONCAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">" "</span>, <span class="string">'00:00:00'</span>));</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = <span class="keyword">DATE_FORMAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Create the partitioning query</span></span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE "</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">" PARTITION BY RANGE(`clock`)"</span>);</span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(@__PARTITION_SQL, <span class="string">"(PARTITION "</span>, PARTITION_NAME, <span class="string">" VALUES LESS THAN ("</span>, <span class="keyword">UNIX_TIMESTAMP</span>(FUTURE_TIMESTAMP), <span class="string">"));"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Run the partitioning query</span></span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @__PARTITION_SQL;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span><span class="string">`partition_maintenance_all`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history'</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_log'</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_str'</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_text'</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_uint'</span>, <span class="number">30</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends'</span>, <span class="number">120</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line">               <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends_uint'</span>, <span class="number">120</span>, <span class="number">24</span>, <span class="number">14</span>);</span><br><span class="line"><span class="keyword">END</span>$$</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import partition.sql</span></span><br><span class="line">mysql -u<span class="string">'zabbix'</span> -p<span class="string">'zabbix'</span> zabbix  &lt; partition.sql</span><br><span class="line"><span class="comment"># run</span></span><br><span class="line">nohup mysql -u<span class="string">'zabbix'</span> -p<span class="string">'zabbix'</span> <span class="string">'zabbix'</span> -e <span class="string">"CALL partition_maintenance_all('zabbix')"</span> &amp;&gt; /root/partition.log&amp;</span><br><span class="line">tail -f /root/partition.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看过程逻辑 </span></span><br><span class="line">show create procedure partition_maintenance_all \G;</span><br><span class="line"><span class="comment"># 删除存储过程 </span></span><br><span class="line">drop procedure <span class="keyword">if</span> exists partition_maintenance_all; </span><br><span class="line"><span class="comment"># 查看存储过程 </span></span><br><span class="line">show procedure status like <span class="string">'partition_maintenance%'</span> \G;</span><br><span class="line"><span class="comment"># 查看 </span></span><br><span class="line">show create table <span class="built_in">history</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># crontab</span></span><br><span class="line">[root@sg-gop-10-65-200-90 wangao]<span class="comment"># cat /etc/crontab</span></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># For details see man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line"></span><br><span class="line">15 3 * * * root bash /opt/sa_scripts/zabbix_partitioning.sh</span><br><span class="line">[root@sg-gop-10-65-200-90 wangao]<span class="comment"># cat /opt/sa_scripts/zabbix_partitioning.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">user=<span class="string">'zabbix'</span></span><br><span class="line">password=<span class="string">'zabbix'</span></span><br><span class="line">database=<span class="string">'zabbix'</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$&#123;user&#125;</span> -p<span class="variable">$password</span> <span class="variable">$database</span> -e <span class="string">"CALL partition_maintenance_all('zabbix');"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mod</span></span><br><span class="line">chmod 755 /opt/sa_scripts/zabbix_partitioning.sh</span><br><span class="line">service crond restart</span><br></pre></td></tr></table></figure><h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p><a href="https://www.zabbix.com/documentation/3.4/zh/manual/installation/containers" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.4/zh/manual/installation/containers</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install docker-ce</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum install -y docker-ce</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker: Error response from daemon: Get https://registry-1.docker.io/v2/: x509: certificate has expired or is not yet valid.</span></span><br><span class="line">ntpdate 0.pool.ntp.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install mysql, zabbix, nginx in docker </span></span><br><span class="line">docker run --name mysql-server -t \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-p 127.0.0.1:3306:3306 \</span><br><span class="line">-d mysql:5.7 \</span><br><span class="line">--character-set-server=utf8 --collation-server=utf8_bin</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-server-mysql:centos-4.0-latest</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">"Asia/Singapore"</span> \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-web-nginx-mysql:centos-4.0-latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zabbix_server ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE                                  COMMAND                  CREATED              STATUS              PORTS                           NAMES</span><br><span class="line">98cbe8d8a6bd        zabbix/zabbix-web-nginx-mysql:latest   <span class="string">"docker-entrypoint.sh"</span>   6 seconds ago        Up 5 seconds        443/tcp, 0.0.0.0:8080-&gt;80/tcp   zabbix-web-nginx-mysql</span><br><span class="line">de040d43d60f        zabbix/zabbix-server-mysql:latest      <span class="string">"docker-entrypoint.sh"</span>   59 seconds ago       Up 59 seconds       0.0.0.0:10051-&gt;10051/tcp        zabbix-server-mysql</span><br><span class="line">3276f18def8d        mysql:5.7                              <span class="string">"docker-entrypoint.s…"</span>   About a minute ago   Up About a minute   3306/tcp                        mysql-server</span><br><span class="line"></span><br><span class="line">[root@zabbix_server ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">zabbix/zabbix-web-nginx-mysql   latest              4db891b4393a        10 hours ago        177MB</span><br><span class="line">zabbix/zabbix-server-mysql      latest              f5e58dafe9ac        10 hours ago        62.2MB</span><br><span class="line">mysql                           5.7                 f0f3956a9dd8        7 days ago          409MB</span><br><span class="line"></span><br><span class="line">http://127.0.0.1:8080</span><br><span class="line"></span><br><span class="line">Admin/zabbix</span><br></pre></td></tr></table></figure><h2 id="Zabbix-自定义监控"><a href="#Zabbix-自定义监控" class="headerlink" title="Zabbix 自定义监控"></a>Zabbix 自定义监控</h2><blockquote><p>以监控文件系统目录的权限为例</p></blockquote><p>Zabbix 用户自定义参数<br><a href="https://www.zabbix.com/documentation/3.4/zh/manual/config/items/userparameters" target="_blank" rel="noopener">https://www.zabbix.com/documentation/3.4/zh/manual/config/items/userparameters</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建自定义监控配置文件 userparameter</span></span><br><span class="line"><span class="built_in">cd</span> /etc/zabbix/zabbix_agentd.d</span><br><span class="line">vi userparameter_tmp.conf</span><br><span class="line">UserParameter=check.tmp[*],<span class="built_in">stat</span> -c %a /tmp</span><br><span class="line"><span class="comment"># 重启 zabbix agent</span></span><br><span class="line">service zabbix-agent restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Zabbix Server 服务端验证 </span></span><br><span class="line">zabbix_get -s 10.65.200.90 -k check.tmp</span><br><span class="line">1777</span><br><span class="line">zabbix_get -s 10.65.200.90 -k agent.version</span><br><span class="line">3.0.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 WebUI 中创建新的 Template 或者使用已有新增 Items</span></span><br><span class="line">Items: Key 为 check.tmp</span><br><span class="line">Triggers: 定义 Serverity，Expression 如下所示 </span><br><span class="line">&#123;Template Sea Ops WangAo:check.tmp.last()&#125;&lt;&gt;1777</span><br><span class="line"></span><br><span class="line"><span class="comment"># 点击 Monitoring Latest data 查看 Item 最新数据 </span></span><br><span class="line">Moniroting -&gt; Latest data -&gt; Hosts -&gt; check /tmp permission</span><br></pre></td></tr></table></figure><p>如果需要配置 Actions 可以查看 Zabbix 使用企业微信告警配置小结<br><a href="https://wsgzao.github.io/post/zabbix-alert-wechat/">https://wsgzao.github.io/post/zabbix-alert-wechat/</a></p><h2 id="Zabbix-备份恢复"><a href="#Zabbix-备份恢复" class="headerlink" title="Zabbix 备份恢复"></a>Zabbix 备份恢复</h2><p>mysql 数据库备份通常使用 mysqldump 或者 xtrabackup</p><p>因为一般历史数据较大，如果需要保留所有数据可以考虑主从同步，如果不需要保留数据直接过滤历史数据备份相关的告警配置即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前版本 Zabbix 的数据库表结构 </span></span><br><span class="line">mysql -uzabbix -pzabbix zabbix -e <span class="string">"show tables"</span>|egrep -v <span class="string">"(Tables_in_zabbix)"</span></span><br><span class="line">mysql -uzabbix -pzabbix zabbix -e <span class="string">"show tables"</span>|egrep -v <span class="string">"(Tables_in_zabbix|history*|trends*|acknowledges|alerts|auditlog|events|service_alarms)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下表中标记 + 号为需要过滤的表 </span></span><br><span class="line">+acknowledges</span><br><span class="line">actions</span><br><span class="line">+alerts</span><br><span class="line">application_discovery</span><br><span class="line">application_prototype</span><br><span class="line">application_template</span><br><span class="line">applications</span><br><span class="line">+auditlog</span><br><span class="line">+auditlog_details</span><br><span class="line">autoreg_host</span><br><span class="line">conditions</span><br><span class="line">config</span><br><span class="line">corr_condition</span><br><span class="line">corr_condition_group</span><br><span class="line">corr_condition_tag</span><br><span class="line">corr_condition_tagpair</span><br><span class="line">corr_condition_tagvalue</span><br><span class="line">corr_operation</span><br><span class="line">correlation</span><br><span class="line">dashboard</span><br><span class="line">dashboard_user</span><br><span class="line">dashboard_usrgrp</span><br><span class="line">dbversion</span><br><span class="line">dchecks</span><br><span class="line">dhosts</span><br><span class="line">drules</span><br><span class="line">dservices</span><br><span class="line">escalations</span><br><span class="line">event_recovery</span><br><span class="line">event_tag</span><br><span class="line">+events</span><br><span class="line">expressions</span><br><span class="line"><span class="built_in">functions</span></span><br><span class="line">globalmacro</span><br><span class="line">globalvars</span><br><span class="line">graph_discovery</span><br><span class="line">graph_theme</span><br><span class="line">graphs</span><br><span class="line">graphs_items</span><br><span class="line">group_discovery</span><br><span class="line">group_prototype</span><br><span class="line">groups</span><br><span class="line">+<span class="built_in">history</span></span><br><span class="line">+history_log</span><br><span class="line">+history_str</span><br><span class="line">+history_text</span><br><span class="line">+history_uint</span><br><span class="line">host_discovery</span><br><span class="line">host_inventory</span><br><span class="line">hostmacro</span><br><span class="line">hosts</span><br><span class="line">hosts_groups</span><br><span class="line">hosts_templates</span><br><span class="line">housekeeper</span><br><span class="line">httpstep</span><br><span class="line">httpstep_field</span><br><span class="line">httpstepitem</span><br><span class="line">httptest</span><br><span class="line">httptest_field</span><br><span class="line">httptestitem</span><br><span class="line">icon_map</span><br><span class="line">icon_mapping</span><br><span class="line">ids</span><br><span class="line">images</span><br><span class="line">interface</span><br><span class="line">interface_discovery</span><br><span class="line">item_application_prototype</span><br><span class="line">item_condition</span><br><span class="line">item_discovery</span><br><span class="line">item_preproc</span><br><span class="line">items</span><br><span class="line">items_applications</span><br><span class="line">maintenances</span><br><span class="line">maintenances_groups</span><br><span class="line">maintenances_hosts</span><br><span class="line">maintenances_windows</span><br><span class="line">mappings</span><br><span class="line">media</span><br><span class="line">media_type</span><br><span class="line">opcommand</span><br><span class="line">opcommand_grp</span><br><span class="line">opcommand_hst</span><br><span class="line">opconditions</span><br><span class="line">operations</span><br><span class="line">opgroup</span><br><span class="line">opinventory</span><br><span class="line">opmessage</span><br><span class="line">opmessage_grp</span><br><span class="line">opmessage_usr</span><br><span class="line">optemplate</span><br><span class="line">problem</span><br><span class="line">problem_tag</span><br><span class="line">profiles</span><br><span class="line">proxy_autoreg_host</span><br><span class="line">+proxy_dhistory</span><br><span class="line">+proxy_history</span><br><span class="line">regexps</span><br><span class="line">rights</span><br><span class="line">screen_user</span><br><span class="line">screen_usrgrp</span><br><span class="line">screens</span><br><span class="line">screens_items</span><br><span class="line">scripts</span><br><span class="line">+service_alarms</span><br><span class="line">services</span><br><span class="line">services_links</span><br><span class="line">services_times</span><br><span class="line">sessions</span><br><span class="line">slides</span><br><span class="line">slideshow_user</span><br><span class="line">slideshow_usrgrp</span><br><span class="line">slideshows</span><br><span class="line">sysmap_element_trigger</span><br><span class="line">sysmap_element_url</span><br><span class="line">sysmap_shape</span><br><span class="line">sysmap_url</span><br><span class="line">sysmap_user</span><br><span class="line">sysmap_usrgrp</span><br><span class="line">sysmaps</span><br><span class="line">sysmaps_elements</span><br><span class="line">sysmaps_link_triggers</span><br><span class="line">sysmaps_links</span><br><span class="line">task</span><br><span class="line">task_acknowledge</span><br><span class="line">task_close_problem</span><br><span class="line">task_remote_command</span><br><span class="line">task_remote_command_result</span><br><span class="line">timeperiods</span><br><span class="line">+trends</span><br><span class="line">+trends_uint</span><br><span class="line">trigger_depends</span><br><span class="line">trigger_discovery</span><br><span class="line">trigger_tag</span><br><span class="line">triggers</span><br><span class="line">users</span><br><span class="line">users_groups</span><br><span class="line">usrgrp</span><br><span class="line">valuemaps</span><br><span class="line">widget</span><br><span class="line">widget_field</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们直接提取需要过滤的表 </span></span><br><span class="line">acknowledges</span><br><span class="line">alerts</span><br><span class="line">auditlog</span><br><span class="line">auditlog_details</span><br><span class="line">events</span><br><span class="line"><span class="built_in">history</span></span><br><span class="line">history_log</span><br><span class="line">history_str</span><br><span class="line">history_text</span><br><span class="line">history_uint</span><br><span class="line">proxy_dhistory</span><br><span class="line">proxy_history</span><br><span class="line">service_alarms</span><br><span class="line">trends</span><br><span class="line">trends_uint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 --ignore-table 跳过不需要备份的表 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤最简单的表只需要 history * 和 trends*</span></span><br><span class="line">mysqldump -uzabbix -pzabbix --databases zabbix \</span><br><span class="line">--ignore-table=zabbix.history \</span><br><span class="line">--ignore-table=zabbix.history_log \</span><br><span class="line">--ignore-table=zabbix.history_str \</span><br><span class="line">--ignore-table=zabbix.history_text \</span><br><span class="line">--ignore-table=zabbix.history_uint \</span><br><span class="line">--ignore-table=zabbix.trends \</span><br><span class="line">--ignore-table=zabbix.trends_uint &gt; /tmp/zabbix_config.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要做更细化的过滤，可以参考下面的过滤表 </span></span><br><span class="line">mysqldump -uzabbix -pzabbix --databases zabbix \</span><br><span class="line">--ignore-table=zabbix.acknowledges \</span><br><span class="line">--ignore-table=zabbix.alerts \</span><br><span class="line">--ignore-table=zabbix.auditlog \</span><br><span class="line">--ignore-table=zabbix.auditlog_details \</span><br><span class="line">--ignore-table=zabbix.events \</span><br><span class="line">--ignore-table=zabbix.history \</span><br><span class="line">--ignore-table=zabbix.history_log \</span><br><span class="line">--ignore-table=zabbix.history_str \</span><br><span class="line">--ignore-table=zabbix.history_text \</span><br><span class="line">--ignore-table=zabbix.history_uint \</span><br><span class="line">--ignore-table=zabbix.proxy_dhistory \</span><br><span class="line">--ignore-table=zabbix.proxy_history \</span><br><span class="line">--ignore-table=zabbix.service_alarms \</span><br><span class="line">--ignore-table=zabbix.services_times \</span><br><span class="line">--ignore-table=zabbix.trends \</span><br><span class="line">--ignore-table=zabbix.trends_uint &gt; /tmp/zabbix_config.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果数据量交大，可以考虑使用 gzip 压缩 </span></span><br><span class="line">--ignore-table=zabbix.trends_uint | gzip &gt; zabbix_`date +<span class="string">'%Y%m%d%H%M%S'</span>`.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传至新的数据库执行导入 </span></span><br><span class="line">mysql -uzabbix -pzabbix zabbix &lt; zabbix_config.sql</span><br></pre></td></tr></table></figure><p>itnihao 的书中分享了一部分代码，可以做些许参考吧<br><a href="https://github.com/itnihao/zabbix-book/tree/master/03-chapter" target="_blank" rel="noopener">https://github.com/itnihao/zabbix-book/tree/master/03-chapter</a></p>]]></content>
    
    <summary type="html">
    
      学习使用Zabbix
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>macOS Mojave 升级后开机卡在进度条的解决方法</title>
    <link href="https://wsgzao.github.io/post/macos/"/>
    <id>https://wsgzao.github.io/post/macos/</id>
    <published>2018-11-01T04:43:14.000Z</published>
    <updated>2018-11-01T07:57:59.397Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://wx3.sinaimg.cn/large/7207510dgy1fwskwveum6g20jg0b5hdz.gif" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>刚刚从 macOS High Sierra 手贱升级到 macOS Mojave (version 10.14)，各种字体发虚，Kernel Panic(六国语言重启)，系统卡顿，耗电快等问题接踵而至。本来寄希望于今天升级 macOS Mojave (version 10.14.1)可以解决部分稳定性和兼容性问题，但是 MacBook 居然开机卡在进度条，然后我等了一上午都没有完成，差点以为要悲剧的重装系统丢失数据了。所以很有必要给大伙提个醒，无论是 Windows 还是 macOS 在新版本推送的早期都不要点击更新，抑制住你体内的洪荒之力和强迫症，不要手贱，不要手贱，不要手贱。</p><blockquote><p>拒绝重装！教你如何拯救开机失败的 Mac 电脑</p></blockquote><hr><h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018 年 11 月 01 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/macos/">https://wsgzao.github.io/post/macos/</a></p><p><strong> 扩展阅读 </strong></p><p>Upgrade to macOS Mojave - <a href="https://www.apple.com/macos/how-to-upgrade/" target="_blank" rel="noopener">https://www.apple.com/macos/how-to-upgrade/</a><br>如何升级到 macOS Mojave - <a href="https://support.apple.com/zh-cn/HT201475" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201475</a><br>如何通过 macOS 恢复功能重新安装 macOS - <a href="https://support.apple.com/zh-cn/HT204904" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT204904</a><br>如何创建可引导的 macOS 安装器 - <a href="https://support.apple.com/zh-cn/HT201372" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201372</a><br>使用 “时间机器” 备份您的 Mac - <a href="https://support.apple.com/zh-cn/HT201250" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201250</a></p><hr><h2 id="macOS-history"><a href="#macOS-history" class="headerlink" title="macOS history"></a>macOS history</h2><blockquote><p>第一次体验苹果虚拟机和黑苹果记得还是 Tiger 和 Leopard 的时候</p></blockquote><table><thead><tr><th>Version</th><th>Codename</th><th>﻿Most recent version</th></tr></thead><tbody><tr><td>Mac OS X 10.0</td><td>Cheetah</td><td>﻿10.0.4 (June 22, 2001)</td></tr><tr><td>Mac OS X 10.1</td><td>Puma</td><td>10.1.5 (June 6, 2002)</td></tr><tr><td>Mac OS X 10.2</td><td>Jaguar</td><td>10.2.8 (October 3, 2003)</td></tr><tr><td>Mac OS X 10.3</td><td>Panther</td><td>10.3.9 (April 15, 2005)</td></tr><tr><td>Mac OS X 10.4</td><td>Tiger</td><td>10.4.11 (November 14, 2007)</td></tr><tr><td>Mac OS X 10.5</td><td>Leopard</td><td>10.5.8 (August 5, 2009)</td></tr><tr><td>Mac OS X 10.6</td><td>Snow Leopard</td><td>10.6.8 v1.1 (July 25, 2011)</td></tr><tr><td>Mac OS X 10.7</td><td>Lion</td><td>10.7.5 (September 19, 2012)</td></tr><tr><td>OS X 10.8</td><td>Mountain Lion</td><td>10.8.5 (12F45) (October 3, 2013)</td></tr><tr><td>OS X 10.9</td><td>Mavericks</td><td>10.9.5 (13F1112) (September 18, 2014)[170]</td></tr><tr><td>OS X 10.10</td><td>Yosemite</td><td>10.10.5 (14F27) (August 13, 2015)</td></tr><tr><td>OS X 10.11</td><td>El Capitan</td><td>10.11.6 (15G31) (July 18, 2016)</td></tr><tr><td>macOS 10.12</td><td>Sierra</td><td>10.12.6 (16G29) (July 19, 2017)</td></tr><tr><td>macOS 10.13</td><td>High Sierra</td><td>10.13.6 (17G65) (July 9, 2018)</td></tr><tr><td>macOS 10.14</td><td>Mojave</td><td>10.14 (18A391) (September 24, 2018)</td></tr></tbody></table><h2 id="网络上常见的拯救方法"><a href="#网络上常见的拯救方法" class="headerlink" title="网络上常见的拯救方法"></a>网络上常见的拯救方法</h2><blockquote><p>你可以尝试进行，不过大部分情况下是无效的</p></blockquote><h3 id="重置-SMC"><a href="#重置-SMC" class="headerlink" title="重置 SMC"></a>重置 SMC</h3><p>先关机，然后断开电源，拔掉所有 USB 的连接，然后同时按住键盘左下角的 Shift，Control，Option 和开机键 15 秒。全过程 Mac 不会开机。15 秒后松手插上电源开机。</p><p>如何重置 Mac 上的系统管理控制器 (SMC) - <a href="https://support.apple.com/zh-cn/HT201295" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201295</a></p><h3 id="重置-NVRAM"><a href="#重置-NVRAM" class="headerlink" title="重置 NVRAM"></a>重置 NVRAM</h3><p>将 Mac 关机，然后开机并立即同时按住以下四个按键：Option、Command、P 和 R。您可以在大约 20 秒后松开这些按键，在此期间您的 Mac 可能看似在重新启动。</p><p>重置 Mac 上的 NVRAM 或 PRAM - <a href="https://support.apple.com/zh-cn/HT204063" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT204063</a></p><h3 id="重装系统"><a href="#重装系统" class="headerlink" title="重装系统"></a>重装系统</h3><p>如果以上都不能解决你的问题，且系统是最新的，硬件是没问题的，那么重装系统吧。哈哈，重装系统总是这么简单霸气的解决一些问题。</p><p>前提：</p><ol><li>保证你能连到 wifi 或者有线，因为重装系统需要连接远程服务器</li><li>保证有足够的电源，最好是附件有插板可以充电的情况下重装系统，这个过程还是比较久的，50 分钟左右。</li></ol><p>步骤如下：</p><ol><li>开机按住 Command (⌘)-R</li><li>出现的四个选项的界面选择第二个重装系统(Reinstall macOS)</li><li>等待重装系统完成即可</li></ol><p>如何通过 macOS 恢复功能重新安装 macOS - <a href="https://support.apple.com/zh-cn/HT204904" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT204904</a></p><h3 id="TimeMachine-恢复"><a href="#TimeMachine-恢复" class="headerlink" title="TimeMachine 恢复"></a>TimeMachine 恢复</h3><blockquote><p>TimeMachine 数据恢复的成本太高，需要先 Reinstall macOS 然后使用 TimeMacthine 恢复，再重新配置软件，不到万不得已之时不推荐</p></blockquote><ol><li>制作 U 盘启动</li><li>TimeMachine 恢复</li></ol><p>如何创建可引导的 macOS 安装器 - <a href="https://support.apple.com/zh-cn/HT201372" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201372</a></p><p>使用 “时间机器” 备份您的 Mac - <a href="https://support.apple.com/zh-cn/HT201250" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201250</a></p><h2 id="Mac-的启动组合键"><a href="#Mac-的启动组合键" class="headerlink" title="Mac 的启动组合键"></a>Mac 的启动组合键</h2><p>若要使用这些组合键中的任何一个，请在按下电源按钮以开启 Mac 后或在 Mac 开始重新启动后，立即按住相应按键。请一直按住，直至电脑出现对应的行为。</p><p>Command (⌘)-R：从内建的 macOS 恢复系统启动。或者，您也可以使用 Option-Command-R 或 Shift-Option-Command-R 以通过互联网从 macOS 恢复功能启动。macOS 恢复功能可以安装不同版本的 macOS，具体取决于您在电脑启动时使用的组合键。如果您的 Mac 使用了固件密码，系统将要求您输入这个密码。</p><p>Option (⌥)：启动进入“启动管理器”，您可以从中选取其他启动磁盘或宗卷（若可用）。如果您的 Mac 使用了固件密码，系统将要求您输入这个密码。</p><p>Option-Command-P-R：重置 NVRAM 或 PRAM。如果您的 Mac 使用了固件密码，它会忽略这个组合键或从 macOS 恢复功能启动。</p><p>Shift (⇧)：以安全模式启动。</p><p>D：从内建的 Apple Hardware Test 或 Apple Diagnostics 实用工具启动，具体取决于您的 Mac 机型。或者，您也可以使用 Option-D 通过互联网从这个实用工具启动。</p><p>N：从兼容的 NetBoot 服务器启动（若可用）。要使用 NetBoot 服务器上默认的引导映像，则请按住 Option-N。配备 Apple T2 芯片的电脑不支持这个启动键。</p><p>Command-S：以单用户模式启动。这个组合键要求使用 macOS High Sierra 或更早版本。</p><p>T：以目标磁盘模式启动。</p><p>Command-V：以详细模式启动。</p><p>Mac 的启动组合键 - <a href="https://support.apple.com/zh-cn/HT201255" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201255</a></p><h2 id="有效的解决方法"><a href="#有效的解决方法" class="headerlink" title="有效的解决方法"></a>有效的解决方法</h2><blockquote><p>如果你遇到和我类似的问题，不妨尝试寻找下具体的错误日志，然后向 Google 或者咨询苹果客服求助</p></blockquote><ol><li>command + v 进入代码界面，等出现不停的输出 Too many corpses being created 这段代码的时候，说明是缓存太多造成的</li><li>command + R 进入 macOS 使用工具页面，左上角找到终端工具</li><li>输入以下代码，重命名数据库缓存就行了</li><li>然后再重新启动电脑，耐心等待一会儿就可以重新进入桌面</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Volumes/Macintosh\ HD/var/db/caches/opendirectory/</span><br><span class="line">mv ./mbr_cache ./mbr_cache-old</span><br></pre></td></tr></table></figure><h2 id="不着急的解决方案"><a href="#不着急的解决方案" class="headerlink" title="不着急的解决方案"></a>不着急的解决方案</h2><p>联系 Apple 支持 - <a href="https://getsupport.apple.com/" target="_blank" rel="noopener">https://getsupport.apple.com/</a></p>]]></content>
    
    <summary type="html">
    
      拒绝重装！教你如何拯救开机失败的Mac电脑
    
    </summary>
    
      <category term="软件 | Soft" scheme="https://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
    
  </entry>
  
  <entry>
    <title>使用 Docker 安装 Zabbix 实践</title>
    <link href="https://wsgzao.github.io/post/zabbix-docker/"/>
    <id>https://wsgzao.github.io/post/zabbix-docker/</id>
    <published>2018-10-30T06:59:49.000Z</published>
    <updated>2018-10-31T13:58:36.493Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Zabbix 是目前最为主流的开源监控方案之一，前面的文章主要介绍了传统的安装方式，在 Docker 容器出现后我们也拥有更高效的安装方式，这里就主要分享基于 Docker 安装和配置 Zabbix 的相关心得。</p><blockquote><p>使用 Docker 安装 Zabbix 实践</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 10 月 30 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix-docker/">https://wsgzao.github.io/post/zabbix-docker/</a></p><p><strong> 扩展阅读 </strong></p><p>Zabbix - <a href="https://www.zabbix.com/" target="_blank" rel="noopener">https://www.zabbix.com/</a></p><hr><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://www.zabbix.com/download" target="_blank" rel="noopener">https://www.zabbix.com/download</a><br><a href="https://www.zabbix.com/documentation" target="_blank" rel="noopener">https://www.zabbix.com/documentation</a></p><h2 id="zabbix-server"><a href="#zabbix-server" class="headerlink" title="zabbix-server"></a>zabbix-server</h2><blockquote><p>从容器安装 Zabbix Server 最简单的方式之一，关于数据卷是否需要映射，看实际需求吧</p></blockquote><p><a href="https://hub.docker.com/r/zabbix/zabbix-server-mysql/tags/" target="_blank" rel="noopener">https://hub.docker.com/r/zabbix/zabbix-server-mysql/tags/</a><br><a href="https://hub.docker.com/r/zabbix/zabbix-web-nginx-mysql/tags/" target="_blank" rel="noopener">https://hub.docker.com/r/zabbix/zabbix-web-nginx-mysql/tags/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install docker-ce</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum install -y docker-ce</span><br><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install mysql, zabbix, nginx in docker </span></span><br><span class="line">docker run --name mysql-server -t \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-p 127.0.0.1:3306:3306 \</span><br><span class="line">-d mysql:5.7 \</span><br><span class="line">--character-set-server=utf8 --collation-server=utf8_bin</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-server-mysql:centos-4.0-latest</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">"Asia/Singapore"</span> \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-web-nginx-mysql:centos-4.0-latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 做数据映射后的方案 </span></span><br><span class="line"></span><br><span class="line">mkdir -p /data/docker/mysql/zabbix/data</span><br><span class="line">mkdir -p /data/docker/zabbix/alertscripts</span><br><span class="line">mkdir -p /data/docker/zabbix/externalscripts</span><br><span class="line"></span><br><span class="line">docker run --name mysql-server -t \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-v /data/docker/mysql/zabbix/data:/var/lib/mysql \</span><br><span class="line">-p 127.0.0.1:3306:3306 \</span><br><span class="line">-d mysql:5.7 \</span><br><span class="line">--character-set-server=utf8 --collation-server=utf8_bin</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">-v /data/docker/zabbix/alertscripts:/usr/lib/zabbix/alertscripts \</span><br><span class="line">-v /data/docker/zabbix/externalscripts:/usr/lib/zabbix/externalscripts \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-server-mysql:centos-4.0-latest</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">"Asia/Singapore"</span> \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-web-nginx-mysql:centos-4.0-latest</span><br></pre></td></tr></table></figure><p>zabbix-proxy 和 zabbix-agent 也可以用容器安装，不过 agent 就不推荐容器化了，针对容器本身的监控可以使用 zabbix-docker-monitoring，当然 Prometheus 才是监控容器的利刃。<br><a href="https://github.com/monitoringartist/zabbix-docker-monitoring" target="_blank" rel="noopener">https://github.com/monitoringartist/zabbix-docker-monitoring</a></p><p>zabbix-docker 官方的 GitHub 站点还包含更详细的 docker compose 配置<br><a href="https://github.com/zabbix/zabbix-docker" target="_blank" rel="noopener">https://github.com/zabbix/zabbix-docker</a></p><p>关于 Docker 常用命令可以参考 Docker 从入门到实践<br><a href="https://wsgzao.github.io/post/docker/">https://wsgzao.github.io/post/docker/</a></p><h2 id="Zabbix-容器化后的配置"><a href="#Zabbix-容器化后的配置" class="headerlink" title="Zabbix 容器化后的配置"></a>Zabbix 容器化后的配置</h2><blockquote><p>容器化的配置和传统方式略有不同，尤其是网络防火墙策略</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据 zabbix_server.conf 配置文件内容创建对应的目录和权限 </span></span><br><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_server.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_server.pid</span><br><span class="line">SocketDir=/var/run/zabbix</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line">StartPollers=500</span><br><span class="line">StartPingers=50</span><br><span class="line">SNMPTrapperFile=/var/<span class="built_in">log</span>/snmptrap/snmptrap.log</span><br><span class="line">CacheSize=8G</span><br><span class="line">TrendCacheSize=1G</span><br><span class="line">Timeout=15</span><br><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class="line">LogSlowQueries=3000</span><br><span class="line"></span><br><span class="line"><span class="comment"># Zabbix 容器默认的配置 </span></span><br><span class="line">LogType=console</span><br><span class="line">DBHost=mysql-server</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br><span class="line">DBPort=3306</span><br><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class="line">FpingLocation=/usr/sbin/fping</span><br><span class="line">Fping6Location=/usr/sbin/fping6</span><br><span class="line">SSHKeyLocation=/var/lib/zabbix/ssh_keys</span><br><span class="line">SSLCertLocation=/var/lib/zabbix/ssl/certs/</span><br><span class="line">SSLKeyLocation=/var/lib/zabbix/ssl/keys/</span><br><span class="line">SSLCALocation=/var/lib/zabbix/ssl/ssl_ca/</span><br><span class="line">LoadModulePath=/var/lib/zabbix/modules/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照规范映射指定卷并做好脚本权限设置 </span></span><br><span class="line">-v /data/docker/zabbix/alertscripts:/usr/lib/zabbix/alertscripts \</span><br><span class="line">-v /data/docker/zabbix/externalscripts:/usr/lib/zabbix/externalscripts \</span><br><span class="line"></span><br><span class="line"><span class="comment"># Zabbix partition optimization</span></span><br><span class="line">1. <span class="built_in">disable</span> Housekeeping</span><br><span class="line">2. mysql_partition</span><br><span class="line"></span><br><span class="line">https://www.zabbix.org/wiki/Docs/howto/mysql_partition</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器内部的调整 </span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install lrzsz vim cron -y</span><br><span class="line"></span><br><span class="line">mysql -uzabbix -pzabbix zabbix &lt; partition.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置定时任务 </span></span><br><span class="line">vim /etc/crontab</span><br><span class="line">01 01 * * *  root mysql -uzabbix -pzabbix zabbix -e<span class="string">"CALL partition_maintenance_all('zabbix')"</span> </span><br><span class="line"></span><br><span class="line">service cron restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在宿主机上配置定时任务的方法 </span></span><br><span class="line">docker <span class="built_in">exec</span> $(docker ps -aqf <span class="string">"name=mysql-server"</span>) mysql -uzabbix -pzabbix zabbix -e<span class="string">"CALL partition_maintenance_all('zabbix')"</span></span><br></pre></td></tr></table></figure><h3 id="升级容器"><a href="#升级容器" class="headerlink" title="升级容器"></a>升级容器</h3><ol><li>拉取最新镜像</li><li>停止并删除当前运行容器</li><li>用最新镜像重新创建容器</li><li>All Done</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找当前系统中使用的镜像 </span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 拉取最新镜像 </span></span><br><span class="line">docker pull zabbix/zabbix-web-nginx-mysql</span><br><span class="line">docker pull zabbix/zabbix-server-mysql</span><br><span class="line"><span class="comment"># 查找容器 ID</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 导出之前的容器配置信息 </span></span><br><span class="line">docker inspect 14fd67405076</span><br><span class="line"><span class="comment"># 停止容器 </span></span><br><span class="line">docker stop 14fd67405076</span><br><span class="line">docker <span class="built_in">kill</span> 14fd67405076</span><br><span class="line"><span class="comment"># 删除容器 </span></span><br><span class="line">docker rm 14fd67405076</span><br><span class="line"><span class="comment"># 用最新镜像重新创建容器 </span></span><br><span class="line">docker run --name zabbix-server-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-v /etc/localtime:/etc/localtime:ro \</span><br><span class="line">-v /data/docker/zabbix/alertscripts:/usr/lib/zabbix/alertscripts \</span><br><span class="line">-v /data/docker/zabbix/externalscripts:/usr/lib/zabbix/externalscripts \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-server-mysql</span><br><span class="line"></span><br><span class="line">docker run --name zabbix-web-nginx-mysql -t \</span><br><span class="line">--link mysql-server:mysql \</span><br><span class="line">--link zabbix-server-mysql:zabbix-server \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">"mysql-server"</span> \</span><br><span class="line">-e MYSQL_DATABASE=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=<span class="string">"zabbix"</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">"Asia/Singapore"</span> \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-d \</span><br><span class="line">zabbix/zabbix-web-nginx-mysql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      使用Docker安装Zabbix实践
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker 从入门到实践</title>
    <link href="https://wsgzao.github.io/post/docker/"/>
    <id>https://wsgzao.github.io/post/docker/</id>
    <published>2018-10-25T06:59:49.000Z</published>
    <updated>2018-10-31T07:06:06.247Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>把 docker-ce 安装和使用部分先独立抽取出来，关于 Docker 更加深入的理解可以参考文章开头推荐的文章</p><blockquote><p>Docker 从入门到实践</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 10 月 25 日 - 更新大量 Docker 实践操作和精选的 Docker 入门文章<br>2018 年 05 月 21 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/docker/">https://wsgzao.github.io/post/docker/</a></p><p><strong> 扩展阅读 </strong></p><p>Docker - <a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a></p><hr><h2 id="Docker-入门"><a href="#Docker-入门" class="headerlink" title="Docker 入门"></a>Docker 入门</h2><p>Docker 入门教程<br><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></p><p>Docker 微服务教程<br><a href="http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html</a></p><p>Nginx 容器教程<br><a href="http://www.ruanyifeng.com/blog/2018/02/nginx-docker.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2018/02/nginx-docker.html</a></p><p>DOCKER 从入门到实践<br><a href="https://imnerd.org/docker-in-action.html" target="_blank" rel="noopener">https://imnerd.org/docker-in-action.html</a></p><p>Docker — 从入门到实践</p><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 操作系统版本 </span></span><br><span class="line">cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br><span class="line"><span class="comment"># 操作系统内核 </span></span><br><span class="line">uname -r</span><br><span class="line">3.10.0-693.21.1.el7.x86_64</span><br><span class="line"><span class="comment"># 硬件架构 </span></span><br><span class="line">uname -m</span><br><span class="line">x86_64</span><br><span class="line"><span class="comment"># docker 版本 </span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line">Client:</span><br><span class="line"> Version:18.03.0-ce</span><br><span class="line"> API version:1.37</span><br><span class="line"> Go version:go1.9.4</span><br><span class="line"> Git commit:0520e24</span><br><span class="line"> Built:Wed Mar 21 23:09:15 2018</span><br><span class="line"> OS/Arch:linux/amd64</span><br><span class="line"> Experimental:<span class="literal">false</span></span><br><span class="line"> Orchestrator:swarm</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:18.03.0-ce</span><br><span class="line">  API version:1.37 (minimum version 1.12)</span><br><span class="line">  Go version:go1.9.4</span><br><span class="line">  Git commit:0520e24</span><br><span class="line">  Built:Wed Mar 21 23:13:03 2018</span><br><span class="line">  OS/Arch:linux/amd64</span><br><span class="line">  Experimental:<span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="部署-Docker"><a href="#部署-Docker" class="headerlink" title="部署 Docker"></a>部署 Docker</h2><h3 id="使用阿里云加速器加快获取-docker-官方的镜像"><a href="#使用阿里云加速器加快获取-docker-官方的镜像" class="headerlink" title="使用阿里云加速器加快获取 docker 官方的镜像"></a>使用阿里云加速器加快获取 docker 官方的镜像</h3><p>步骤一：如果没有阿里云账号，需要注册阿里云开发账号</p><p><a href="https://dev.aliyun.com/" target="_blank" rel="noopener">https://dev.aliyun.com/</a></p><p>步骤二：进入加速器页面获取加速信息</p><p><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a></p><h3 id="安装／升级你的-Docker-客户端"><a href="#安装／升级你的-Docker-客户端" class="headerlink" title="安装／升级你的 Docker 客户端"></a>安装／升级你的 Docker 客户端</h3><p>推荐安装 1.10.0 以上版本的 Docker 客户端，参考文档 docker-ce<br><a href="https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.6a721991ZTvV8S" target="_blank" rel="noopener">https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.6a721991ZTvV8S</a></p><blockquote><p>Docker CE 镜像源站</p></blockquote><p>使用官方安装脚本自动安装</p><pre><code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></pre><p>CentOS 7 (使用 yum 进行安装)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具 </span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息 </span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启 Docker 服务 </span></span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的 Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找 Docker-CE 的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2 : 安装指定版本的 Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br></pre></td></tr></table></figure><h3 id="如何配置镜像加速器"><a href="#如何配置镜像加速器" class="headerlink" title="如何配置镜像加速器"></a>如何配置镜像加速器</h3><p>针对 Docker 客户端版本大于 1.10.0 的用户</p><p>您可以通过修改 daemon 配置文件 / etc/docker/daemon.json 来使用加速器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://ffia7t7n.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p><h3 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用阿里云作加速 </span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; rm -f *.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">yum remove -y docker docker-common docker-selinux docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 docker 官方源，国内下载较慢建议切换为阿里云加速 </span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line">yum list docker-ce --showduplicates | sort -r |grep stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 docker，可以选择制定版本 </span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://ffia7t7n.mirror.aliyuncs.com"</span>]                <span class="comment"># 为了后期方便添加阿里云的加速镜像站 </span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="测试-Docker-服务正常"><a href="#测试-Docker-服务正常" class="headerlink" title="测试 Docker 服务正常"></a>测试 Docker 服务正常</h3><p>例行跑个 hello world 测试下 Docker 服务是否正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试 docker</span></span><br><span class="line">docker run hello-world</span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">ca4f61b1923c: Pull complete </span><br><span class="line">Digest: sha256:97ce6fa4b6cdc0790cda65fe7290b74cfebd9fa0c9b8c38e979330d547d22ce1</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://cloud.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure><h3 id="安装-docker-compose"><a href="#安装-docker-compose" class="headerlink" title="安装 docker-compose"></a>安装 docker-compose</h3><pre><code>yum install -y docker-compose</code></pre><h2 id="离线安装-Docker"><a href="#离线安装-Docker" class="headerlink" title="离线安装 Docker"></a>离线安装 Docker</h2><p>先在一台可以联网的相同操作系统环境下下载离线安装包，然后内网服务器构建本地 yum 源，最后安装 docker</p><h3 id="下载离线安装包"><a href="#下载离线安装包" class="headerlink" title="下载离线安装包"></a>下载离线安装包</h3><blockquote><p>在可以联网的机器上下载 rpm 包</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 yum-plugin-downloadonly 插件 </span></span><br><span class="line">yum install -y yum-plugin-downloadonly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 createrepo 相关 rpm 到指定目录，构建本地源之前需要在本地安装 createrepo，用于构建本地源 </span></span><br><span class="line">mkdir -p /tmp/repo/createrepo/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/createrepo/ createrepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 docker 相关 rpm 到指定目录 </span></span><br><span class="line">mkdir -p /tmp/repo/docker-ce/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/docker-ce/ docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载 docker-compose 相关 rpm 到指定目录 </span></span><br><span class="line">mkdir -p /tmp/repo/docker-compose/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/docker-compose/ docker-compose</span><br></pre></td></tr></table></figure><h3 id="构建本地-yum-源"><a href="#构建本地-yum-源" class="headerlink" title="构建本地 yum 源"></a>构建本地 yum 源</h3><p>将 docker 的 rpm 包拷贝到需要安装 docker 的局域网集群上面，例如：<br>/tmp/repo/docker-ce/</p><p>将 docker 的 rpm 包拷贝到需要安装 docker 的局域网集群上面，例如：<br>/tmp/repo/createrepo/</p><p>构建本地 yum 源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 createrepo</span></span><br><span class="line">rpm -ivh /tmp/repo/createrepo/*.rpm</span><br><span class="line"><span class="comment"># 备份 / etc/yum.repos.d 目录下文件 </span></span><br><span class="line">ls /etc/yum.repos.d | xargs -I&#123;&#125; mv /etc/yum.repos.d/&#123;&#125; /etc/yum.repos.d/&#123;&#125;.bk</span><br><span class="line"><span class="comment"># 创建新的 *.repo 文件，如：docker.repo，进行配置 </span></span><br><span class="line">vim docker.repo</span><br><span class="line">[<span class="built_in">local</span>-yum]</span><br><span class="line">name=<span class="built_in">local</span>-yum</span><br><span class="line">baseurl=file:////tmp/repo/docker-ce/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="comment"># 设置本地源 </span></span><br><span class="line">createrepo -d /tmp/repo/docker-ce/</span><br><span class="line"><span class="comment"># 查看看是否能看到自己构建的本地源 </span></span><br><span class="line">yum repolist</span><br><span class="line"><span class="comment"># 清除缓存 </span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="comment"># 创建缓存 </span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="comment"># 看本地源是否配置成功，通过 yum list 看是否输出了新的 rpm 包，如果能查询到，证明配置成功 </span></span><br><span class="line">yum list | grep docker</span><br><span class="line"><span class="comment"># 离线安装 docker</span></span><br><span class="line">yum install docker -y</span><br></pre></td></tr></table></figure><h2 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 docker 服务 </span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前系统 Docker 信息 </span></span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取 docker 镜像 </span></span><br><span class="line">docker pull image_name</span><br><span class="line"><span class="comment"># 从 Docker hub 上下载某个镜像 </span></span><br><span class="line">docker pull centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看宿主机上的镜像，Docker 镜像保存在 / var/lib/docker 目录下:</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mysql                           5.7                 1b30b36ae96a        8 days ago          372MB</span><br><span class="line">zabbix/zabbix-web-nginx-mysql   centos-4.0-latest   8be5f91b2fa1        3 weeks ago         415MB</span><br><span class="line">zabbix/zabbix-server-mysql      centos-4.0-latest   8e5becf45c4e        3 weeks ago         326MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除镜像 </span></span><br><span class="line">docker rmi image_name/image_id</span><br><span class="line">docker rmi zabbix/zabbix-web-nginx-mysql:centos-4.0-latest 或者 docker rmi 8be5f91b2fa1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前有哪些容器正在运行 </span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 查看所有容器 </span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE                                             COMMAND                  CREATED             STATUS                       PORTS                           NAMES</span><br><span class="line">b30307ad65be        zabbix/zabbix-web-nginx-mysql:centos-4.0-latest   <span class="string">"docker-entrypoint.sh"</span>   7 days ago          Exited (255) 8 minutes ago   443/tcp, 0.0.0.0:8080-&gt;80/tcp   zabbix-web-nginx-mysql</span><br><span class="line">0ad822cd52b7        zabbix/zabbix-server-mysql:centos-4.0-latest      <span class="string">"docker-entrypoint.sh"</span>   7 days ago          Exited (255) 8 minutes ago   0.0.0.0:10051-&gt;10051/tcp        zabbix-server-mysql</span><br><span class="line">d01c89a112f7        mysql:5.7                                         <span class="string">"docker-entrypoint.s…"</span>   7 days ago          Exited (255) 8 minutes ago   3306/tcp, 33060/tcp             mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动、停止、重启容器命令：</span></span><br><span class="line">docker start container_name/container_id</span><br><span class="line">docker stop container_name/container_id</span><br><span class="line">docker restart container_name/container_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后台启动一个容器后，如果想进入到这个容器，可以使用 attach</span></span><br><span class="line">docker attach container_name/container_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除容器 </span></span><br><span class="line">docker rm container_name/container_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器日志 </span></span><br><span class="line">docker logs -f container_name/container_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器 IP 地址 </span></span><br><span class="line">docker inspect container_name/container_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器 </span></span><br><span class="line">docker <span class="built_in">exec</span> -it container_name/container_id bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 Docker 容器与宿主机相互传输文件 </span></span><br><span class="line">[root@localhost tmp]<span class="comment"># docker cp --help</span></span><br><span class="line"></span><br><span class="line">Usage:docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line">docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">Copy files/folders between a container and the <span class="built_in">local</span> filesystem</span><br><span class="line"></span><br><span class="line">docker cp zabbix_config.sql mysql-server:/tmp</span><br><span class="line">docker cp mysql-server:/tmp/zabbix_config.sql /tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量删除所有已经退出的容器 </span></span><br><span class="line">docker rm -v $(docker ps -aq -f status=exited)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker help</span></span><br><span class="line">[root@centos7lined1 wangao]<span class="comment"># docker help</span></span><br><span class="line"></span><br><span class="line">Usage:docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default <span class="string">"/root/.docker"</span>)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --<span class="built_in">log</span>-level string   Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default <span class="string">"/root/.docker/ca.pem"</span>)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default <span class="string">"/root/.docker/cert.pem"</span>)</span><br><span class="line">      --tlskey string      Path to TLS key file (default <span class="string">"/root/.docker/key.pem"</span>)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach <span class="built_in">local</span> standard input, output, and error streams to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br></pre></td></tr></table></figure><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><p>Compose 是 Docker 公司推出的一个工具软件，可以管理多个 Docker 容器组成一个应用。你需要定义一个 YAML 格式的配置文件 docker-compose.yml，写好多个容器之间的调用关系。然后，只要一个命令，就能同时启动 / 关闭这些容器。</p><h1 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h1><p>docker-compose –version</p><h1 id="启动所有服务"><a href="#启动所有服务" class="headerlink" title="启动所有服务"></a>启动所有服务</h1><p>docker-compose up</p><h1 id="关闭所有服务"><a href="#关闭所有服务" class="headerlink" title="关闭所有服务"></a>关闭所有服务</h1><p>docker-compose stop</p>]]></content>
    
    <summary type="html">
    
      Docker从入门到实践
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Grafana 安装部署</title>
    <link href="https://wsgzao.github.io/post/grafana/"/>
    <id>https://wsgzao.github.io/post/grafana/</id>
    <published>2018-10-24T06:59:49.000Z</published>
    <updated>2018-11-02T11:31:38.588Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Grafana 是一个开源的数据分析和监控平台，它是一个开箱即用的可视化工具，具有功能齐全的度量仪表盘和图形编辑器，有灵活丰富的图形化选项，可以混合多种风格，支持多个数据源特点。Grafana + Zabbix 的组合方式，主要是通过插件的形式，将 Zabbix 接入到 Grafana 中，使其可以借助 Grafana 的 portal 进行统一的监控和管理。</p><blockquote><p>The open platform for beautiful analytics and monitoring</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 10 月 24 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/grafana/">https://wsgzao.github.io/post/grafana/</a></p><p><strong> 扩展阅读 </strong></p><p>Grafana - <a href="https://grafana.com/" target="_blank" rel="noopener">https://grafana.com/</a></p><hr><h2 id="Grafana-入门"><a href="#Grafana-入门" class="headerlink" title="Grafana 入门"></a>Grafana 入门</h2><p>观看 10 分钟的初学者指南，以建立仪表板，以快速介绍设置仪表板和面板。<br><a href="https://www.youtube.com/watch?v=sKNZMtoSHN4&amp;index=7&amp;list=PLDGkOdUX1Ujo3wHw9-z5Vo12YLqXRjzg2" target="_blank" rel="noopener">https://www.youtube.com/watch?v=sKNZMtoSHN4&amp;index=7&amp;list=PLDGkOdUX1Ujo3wHw9-z5Vo12YLqXRjzg2</a></p><p>阅读基本概念文档，以获得 Grafana 概念的速成关键课程<br><a href="http://docs.grafana.org/guides/basic_concepts/" target="_blank" rel="noopener">http://docs.grafana.org/guides/basic_concepts/</a></p><h2 id="Grafana-安装"><a href="#Grafana-安装" class="headerlink" title="Grafana 安装"></a>Grafana 安装</h2><blockquote><p>No matter where your data is, or what kind of database it lives in, you can bring it together with Grafana. Beautifully.</p></blockquote><p><a href="http://docs.grafana.org/installation/" target="_blank" rel="noopener">http://docs.grafana.org/installation/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install grafana</span></span><br><span class="line">cat &gt; /etc/yum.repos.d/grafana.repo &lt;&lt; <span class="string">'EOF'</span></span><br><span class="line">[grafana]</span><br><span class="line">name=grafana</span><br><span class="line">baseurl=https://packagecloud.io/grafana/stable/el/7/<span class="variable">$basearch</span></span><br><span class="line">gpgkey=https://packagecloud.io/gpg.key https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install grafana</span></span><br><span class="line">yum --enablerepo=grafana -y install grafana initscripts fontconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># change anything if you need</span></span><br><span class="line">vi /etc/grafana/grafana.ini</span><br><span class="line"> </span><br><span class="line"> 30 [server]</span><br><span class="line"> 31 <span class="comment"># Protocol (http, https, socket)</span></span><br><span class="line"> 32 ;protocol = http</span><br><span class="line"> 33</span><br><span class="line"> 34 <span class="comment"># The ip address to bind to, empty will bind to all interfaces</span></span><br><span class="line"> 35 ;http_addr =</span><br><span class="line"> 36</span><br><span class="line"> 37 <span class="comment"># The http port  to use</span></span><br><span class="line"> 38 ;http_port = 3000</span><br><span class="line"> 39</span><br><span class="line"> 40 <span class="comment"># The public facing domain name used to access grafana from a browser</span></span><br><span class="line"> 41 ;domain = localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># start and enable grafana</span></span><br><span class="line">sudo systemctl start grafana-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> grafana-server</span><br><span class="line">sudo systemctl status grafana-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">http://&lt;ip&gt;:3000</span><br><span class="line">admin/admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据源 </span></span><br><span class="line"> 安装很简单，之后需要配置数据源比如 InfluxDB/Zabbix API 等才能发挥真正的作用</span><br></pre></td></tr></table></figure><h3 id="grafana-zabbix"><a href="#grafana-zabbix" class="headerlink" title="grafana-zabbix"></a>grafana-zabbix</h3><p><a href="https://grafana.com/plugins/alexanderzobnin-zabbix-app" target="_blank" rel="noopener">https://grafana.com/plugins/alexanderzobnin-zabbix-app</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 zabbix 插件（grafana-zabbix）</span></span><br><span class="line">grafana-cli plugins install alexanderzobnin-zabbix-app</span><br><span class="line">systemctl restart grafana-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用插件 </span></span><br><span class="line"> 进入 Plugins 界面，选择 “Zabbix” </span><br><span class="line">开始面板（左上角图标） -&gt; Plugins -&gt; Apps -&gt; Zabbix </span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 zabbix 数据源 </span></span><br><span class="line"> 进入 “添加数据源” 界面 </span><br><span class="line">开始面板（左上角图标） -&gt; Data Sources -&gt; Add data <span class="built_in">source</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 Zabbix 数据源 </span></span><br><span class="line">配置完后，保存退出，配置的内容如下： </span><br><span class="line">重要参数有： </span><br><span class="line">Type: Zabbix </span><br><span class="line">Url: http://192.168.56.103/zabbix/api_jsonrpc.php </span><br><span class="line">Access: direct </span><br><span class="line">(Zabbix API details) </span><br><span class="line">Username: Admin（默认） </span><br><span class="line">Password: zabbix（默认）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证 </span></span><br><span class="line"> 之后，我们从 开始面板 -&gt; Zabbix 中，便可看到 Zabbix 相关的监控数据。</span><br></pre></td></tr></table></figure><h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p>InfluxDB 里存储的数据被称为时间序列数据, InfluxDB 存储方式跟传统关系型数据库不同的是：传统关系型数据库通过数据库 + 表 + 字段组织数据，InfluxDB 通过指标、标签、字段组织数据，时间戳是默认的索引列，标签跟字段其实就相当于关系型数据库中的字段，只不过标签会被索引，而字段不会。</p><p>Grafana 默认支持的数据源：Graphite，InfluxDB，OpenTSDB，Prometheus，Elasticsearch，CloudWatch<br>Grafana 支持同时绑定多套数据源，根据自己需求管理即可，这里以 InfluxDB 为例。</p><p><a href="https://portal.influxdata.com/downloads" target="_blank" rel="noopener">https://portal.influxdata.com/downloads</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install influxdb</span></span><br><span class="line">cat &gt; /etc/yum.repos.d/influxdb.repo &lt;&lt; <span class="string">'EOF'</span></span><br><span class="line">[influxdb]</span><br><span class="line">name = InfluxDB Repository - RHEL \<span class="variable">$releasever</span></span><br><span class="line">baseurl = https://repos.influxdata.com/rhel/\<span class="variable">$releasever</span>/\<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled = 1</span><br><span class="line">gpgcheck = 1</span><br><span class="line">gpgkey = https://repos.influxdata.com/influxdb.key</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum install influxdb</span></span><br><span class="line">yum install -y influxdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># start and enable influxdb</span></span><br><span class="line">sudo systemctl start influxdb</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> influxdb</span><br><span class="line">sudo systemctl status influxdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 influx 命令进入 cli 命令行</span></span><br><span class="line">influx</span><br><span class="line">Connected to http://localhost:8086 version 1.4.2</span><br><span class="line">InfluxDB shell version: 1.4.2</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看用户</span></span><br><span class="line">SHOW USERS</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line">CREATE USER influx WITH PASSWORD <span class="string">'influx'</span> WITH ALL PRIVILEGES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看用户</span></span><br><span class="line">SHOW USERS</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库</span></span><br><span class="line">CREATE DATABASE <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据库</span></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using 数据库</span></span><br><span class="line">USE <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">INSERT cpu,host=192.168.1.1 load=0.1,usage=0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有数据</span></span><br><span class="line">SELECT * FROM <span class="string">"cpu"</span></span><br><span class="line">SELECT <span class="string">"host"</span>,<span class="string">"load"</span>,<span class="string">"usage"</span> FROM <span class="string">"cpu"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据条件查询</span></span><br><span class="line">SELECT <span class="string">"host"</span>,<span class="string">"load"</span>,<span class="string">"usage"</span> FROM <span class="string">"cpu"</span> WHERE <span class="string">"host"</span> = <span class="string">'192.168.1.1'</span></span><br><span class="line">SELECT <span class="string">"host"</span>,<span class="string">"load"</span>,<span class="string">"usage"</span> FROM <span class="string">"cpu"</span> WHERE <span class="string">"usage"</span> &gt; 0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库</span></span><br><span class="line">CREATE DATABASE <span class="string">"db_name"</span></span><br><span class="line"><span class="comment"># 显示所有数据库</span></span><br><span class="line">SHOW DATABASES</span><br><span class="line"><span class="comment"># 删除数据库</span></span><br><span class="line">DROP DATABASE <span class="string">"db_name"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用数据库</span></span><br><span class="line">USE mydb</span><br><span class="line"><span class="comment"># 显示该数据库中的表</span></span><br><span class="line">SHOW MEASUREMENTS</span><br><span class="line"><span class="comment"># 删除表</span></span><br><span class="line">DROP MEASUREMENT <span class="string">"t_name"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库 API</span></span><br><span class="line">curl -i -XPOST http://localhost:8086/query --data-urlencode <span class="string">"q=CREATE DATABASE test"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入数据 API</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入单条</span></span><br><span class="line">curl -i -XPOST http://localhost:8086/write?db=<span class="built_in">test</span> --data-binary <span class="string">"cpu,host=192.168.1.3 load=0.1,usage=0.33"</span></span><br><span class="line">curl -i -XPOST http://localhost:8086/write?db=<span class="built_in">test</span> --data-binary <span class="string">"cpu,host=192.168.1.3 load=0.1,usage=0.33 6666666666666666666"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入多条</span></span><br><span class="line">curl -i -XPOST http://localhost:8086/write?db=<span class="built_in">test</span> --data-binary <span class="string">"cpu,host=192.168.1.2 load=0.1,usage=0.22 1666666666666666661 </span></span><br><span class="line"><span class="string">cpu,host=192.168.1.3 load=0.1,usage=0.33 1666666666666666661 </span></span><br><span class="line"><span class="string">cpu,host=192.168.1.2 load=0.2,usage=0.22 1666666666666666662 </span></span><br><span class="line"><span class="string">cpu,host=192.168.1.3 load=0.2,usage=0.33 1666666666666666662"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据 API</span></span><br><span class="line">curl -G http://localhost:8086/query?db=<span class="built_in">test</span> --data-urlencode <span class="string">"q=SELECT * FROM  \"cpu\""</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      The open platform for beautiful analytics and monitoring
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>MacBook 使用指北</title>
    <link href="https://wsgzao.github.io/post/macbook/"/>
    <id>https://wsgzao.github.io/post/macbook/</id>
    <published>2018-10-19T06:59:49.000Z</published>
    <updated>2018-11-22T08:08:07.822Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><img src="https://i.v2ex.co/y2JB0IAD.png" alt=""></p><p>这里做下 MacBook 从小白到入门的持续更新记录</p><blockquote><p>学习使用 MacBook</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 10 月 19 日 - 更新升级 macOS Mojave 后的各种小问题解决方法<br>2018 年 07 月 25 日 - 补充细节<br>2018 年 07 月 05 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/macbook/">https://wsgzao.github.io/post/macbook/</a></p><p><strong> 扩展阅读 </strong></p><p>Awesome Mac - <a href="http://wangchujiang.com/awesome-mac/index.zh.html" target="_blank" rel="noopener">http://wangchujiang.com/awesome-mac/index.zh.html</a></p><hr><h2 id="System-Preferences"><a href="#System-Preferences" class="headerlink" title="System Preferences"></a>System Preferences</h2><blockquote><p>在任何的操作系统中，首先你需要做一件事就是更新系统，点击窗口左上角的  &gt; 关于本机 &gt; 软件更新 。此外，如果这是一部新的电脑，你还需要到系统设置进行一些适当调整。如何调整，取决于个人喜好。</p></blockquote><h3 id="触控板"><a href="#触控板" class="headerlink" title="触控板"></a>触控板</h3><p>系统设置 &gt; 触控板</p><p>光标与点击</p><ul><li>轻拍来点按</li><li>辅助点按</li><li>查找</li><li>三指拖移</li></ul><p>滚动缩放</p><ul><li>默认全选</li></ul><p>更多手势</p><ul><li>默认全选</li></ul><h3 id="Dock"><a href="#Dock" class="headerlink" title="Dock"></a>Dock</h3><p>置于屏幕上的位置：左边<br>设置 Dock 图标更小（大小随个人喜好）</p><ul><li>自动显示和隐藏 Dock</li></ul><h3 id="Finder"><a href="#Finder" class="headerlink" title="Finder"></a>Finder</h3><p>Finder &gt; 显示</p><ul><li>显示标签页栏</li><li>显示路径栏</li><li>显示状态栏</li><li>自定工具栏 &gt; 去除所有按钮，仅剩搜索栏</li></ul><p>Finder &gt; 偏好设置</p><p>通用</p><ul><li>开启新 Finder 窗口时打开：HOME「用户名」目录</li></ul><p>边栏</p><ul><li>添加 HOME「用户名」目录 和 创建代码文件目录</li><li>将 共享的(shared) 和 标记(tags) 目录去掉</li></ul><h3 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h3><ul><li>去掉蓝牙等无需经常使用的图标</li><li>将电池显示设置为百分比</li></ul><h3 id="Spotlight"><a href="#Spotlight" class="headerlink" title="Spotlight"></a>Spotlight</h3><ul><li>去掉字体和书签与历史记录等不需要的内容</li><li>设置合适的快捷键</li></ul><h3 id="互联网帐户"><a href="#互联网帐户" class="headerlink" title="互联网帐户"></a>互联网帐户</h3><ul><li>添加 iCloud 用户，同步日历，联系人和 Find my mac 等等</li></ul><h3 id="English"><a href="#English" class="headerlink" title="English"></a>English</h3><p>Trackpad</p><ul><li>Tap to click</li></ul><p>Accessibility -&gt; Mouse &amp; Trackpad -&gt; Trackpad Options</p><ul><li>Enable dragging | three finger drag</li></ul><p>Language &amp; Region</p><ul><li>Time format | 24-Hour Time</li><li>click add button | Chinese, Simplified</li></ul><p>Language &amp; Region -&gt; Keyboard Preferences -&gt; Shortcuts -&gt; Input Sources</p><ul><li>Select the previous input source</li></ul><p>Display -&gt; Arrangement</p><ul><li>Drag the graphics and just make what you want</li><li>if the display rotates 90 degrees then change Rotation to 90° or 270° and click confirm button to save</li></ul><h2 id="Mac-键盘快捷键"><a href="#Mac-键盘快捷键" class="headerlink" title="Mac 键盘快捷键"></a>Mac 键盘快捷键</h2><p><a href="https://support.apple.com/zh-cn/HT201236" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201236</a></p><p>Command ⌘<br>Shift ⇧<br>Option ⌥<br>Control ⌃<br>Caps Lock ⇪<br>Fn</p><blockquote><p>我自己常用的快捷键</p></blockquote><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>Command(⌘)-C</td><td>复制</td></tr><tr><td>Command(⌘)-V</td><td>粘贴</td></tr><tr><td>Command(⌘)-Z</td><td>撤销</td></tr><tr><td>Command(⌘)-Option-V</td><td>剪切粘贴</td></tr><tr><td>Command(⌘)-A</td><td>全选</td></tr><tr><td>Command(⌘)-F</td><td>查找</td></tr><tr><td>Command(⌘)-S</td><td>保存</td></tr><tr><td>Command(⌘)-W</td><td>关闭当前窗口</td></tr><tr><td>Command(⌘)- 空格键</td><td>聚焦</td></tr><tr><td>Command(⌘)- 方向左键</td><td>后退</td></tr><tr><td>Command(⌘)- 方向右键</td><td>前进</td></tr><tr><td>Control-A</td><td>移至行或段落的开头</td></tr><tr><td>Control-E</td><td>移至行或段落的末尾</td></tr><tr><td>Control - 空格键</td><td>切换输入法（需要手动设置）</td></tr><tr><td>Control-Command-Q</td><td>系统自带锁屏快捷键</td></tr><tr><td>Option-Command-C</td><td>复制文件路径，当然也可以直接拖拽到命令行</td></tr></tbody></table><h2 id="Mac-Soft"><a href="#Mac-Soft" class="headerlink" title="Mac Soft"></a>Mac Soft</h2><p>Homebrew - Mac 下必备的包管理工具<br><a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a></p><p>Alfred - Mac 下被无数人安利的效率工具，虽然我觉得 Spotlight 暂时够用了<br><a href="https://www.alfredapp.com/" target="_blank" rel="noopener">https://www.alfredapp.com/</a></p><p>Mounty for NTFS - 免费的 NTFS 支持软件<br><a href="http://enjoygineering.com/mounty/" target="_blank" rel="noopener">http://enjoygineering.com/mounty/</a></p><p>Sougou Input - 陪伴大家多年的搜狗输入法<br><a href="https://pinyin.sogou.com/mac/" target="_blank" rel="noopener">https://pinyin.sogou.com/mac/</a></p><p>Youdao Dict - 网易开发的老牌翻译工具<br><a href="http://cidian.youdao.com/index-mac.html" target="_blank" rel="noopener">http://cidian.youdao.com/index-mac.html</a></p><p>Jietu - 腾讯开发的截图工具，其实可以使用 QQ 或者微信快捷键<br><a href="http://jietu.qq.com/" target="_blank" rel="noopener">http://jietu.qq.com/</a></p><p>Kantu - 腾讯开发的看图工具<br><a href="https://kantu.qq.com/" target="_blank" rel="noopener">https://kantu.qq.com/</a></p><p>f.lux - Mac 和 Windows 都必备的护眼亮度调整工具<br><a href="https://justgetflux.com/" target="_blank" rel="noopener">https://justgetflux.com/</a></p><p>Foxit Reader - 国内福昕开发的免费 PDF 阅读器<br><a href="https://www.foxitsoftware.com/pdf-reader/" target="_blank" rel="noopener">https://www.foxitsoftware.com/pdf-reader/</a></p><p>Clearview - 支持 PDF, EPUB, CHM, MOBI 的免费阅读器<br><a href="https://itunes.apple.com/app/clearview/id557090104?mt=12&amp;ls=1" target="_blank" rel="noopener">https://itunes.apple.com/app/clearview/id557090104?mt=12&amp;ls=1</a></p><p>Evernote - 轻量级的在线笔记类应用内<br><a href="https://evernote.com/" target="_blank" rel="noopener">https://evernote.com/</a></p><p>Dropbox - 最佳的实时同步工具之一<br><a href="https://www.dropbox.com/" target="_blank" rel="noopener">https://www.dropbox.com/</a></p><p>Keka - 国外开源的免费压缩解压缩工具<br><a href="https://www.keka.io/en/" target="_blank" rel="noopener">https://www.keka.io/en/</a></p><p>Mac 迅雷 - 支持协议多广告也多<br><a href="http://mac.xunlei.com/" target="_blank" rel="noopener">http://mac.xunlei.com/</a></p><p>百度网盘 - 国内的网盘共享基本只剩下百度一家独大了<br><a href="https://pan.baidu.com/" target="_blank" rel="noopener">https://pan.baidu.com/</a></p><p>FOLX - 用来代替迅雷的免费下载工具<br><a href="https://mac.eltima.com/download-manager.html" target="_blank" rel="noopener">https://mac.eltima.com/download-manager.html</a></p><p>IINA - 国人编写的开源视频播放器<br><a href="https://lhc70000.github.io/iina/" target="_blank" rel="noopener">https://lhc70000.github.io/iina/</a></p><p>Clipy - 记录多条粘贴板小工具<br><a href="https://github.com/Clipy/Clipy" target="_blank" rel="noopener">https://github.com/Clipy/Clipy</a></p><p>Grid - 快速调整程序窗口位置的效率工具<br><a href="http://mildgrind.com/" target="_blank" rel="noopener">http://mildgrind.com/</a></p><p>Proxyee Down - Mac 下百度网盘下载神器<br><a href="https://github.com/proxyee-down-org/proxyee-down" target="_blank" rel="noopener">https://github.com/proxyee-down-org/proxyee-down</a></p><p>Sourcetree - 图形化 Git 管理工具<br><a href="https://www.sourcetreeapp.com/" target="_blank" rel="noopener">https://www.sourcetreeapp.com/</a></p><p>Microsoft Remote Desktop - Mac 下的微软 RDP 远程桌面登录工具<br><a href="https://itunes.apple.com/us/app/microsoft-remote-desktop-10/id1295203466?mt=12" target="_blank" rel="noopener">https://itunes.apple.com/us/app/microsoft-remote-desktop-10/id1295203466?mt=12</a></p><p>VirtualBox - 免费的虚拟机工具<br><a href="http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html</a></p><p>VMware OS Optimization Tool - VMware 开发的 Windows 虚拟机优化工具<br><a href="https://labs.vmware.com/flings/vmware-os-optimization-tool" target="_blank" rel="noopener">https://labs.vmware.com/flings/vmware-os-optimization-tool</a></p><h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h3><p><a href="https://docs.brew.sh/Installation" target="_blank" rel="noopener">https://docs.brew.sh/Installation</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install xcode first</span></span><br><span class="line">https://itunes.apple.com/us/app/xcode/id497799835</span><br><span class="line"></span><br><span class="line"><span class="comment"># install homebrew</span></span><br><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install packages</span></span><br><span class="line">brew tap dteoh/sqa</span><br><span class="line">brew install zsh</span><br><span class="line">brew install wget</span><br><span class="line">brew install git</span><br><span class="line"><span class="comment"># default install is python3 now, if you need python2 just run `brew install python2`</span></span><br><span class="line">brew install python</span><br></pre></td></tr></table></figure><h3 id="iTerm2-zsh-Oh-My-Zsh"><a href="#iTerm2-zsh-Oh-My-Zsh" class="headerlink" title="iTerm2 + zsh + Oh My Zsh"></a>iTerm2 + zsh + Oh My Zsh</h3><p>iTerm2<br><a href="https://www.iterm2.com/" target="_blank" rel="noopener">https://www.iterm2.com/</a></p><p>Oh My Zsh<br><a href="http://ohmyz.sh/" target="_blank" rel="noopener">http://ohmyz.sh/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install latest zsh zsh-syntax-highlighting</span></span><br><span class="line">brew install zsh zsh-syntax-highlighting</span><br><span class="line"><span class="comment"># 修改默认 shell，在 /etc/shells 文件中加入如下一行</span></span><br><span class="line">vi /etc/shells</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/zsh</span><br><span class="line"><span class="comment"># 然后运行命令切换 shell</span></span><br><span class="line">chsh -s /usr/<span class="built_in">local</span>/bin/zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install oh-my-zsh</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改主题为 agnoster，增加一行 zsh-syntax-highlighting</span></span><br><span class="line">vi ~/.zshrc</span><br><span class="line"></span><br><span class="line">ZSH_THEME=<span class="string">"agnoster"</span></span><br><span class="line"><span class="built_in">source</span> /usr/<span class="built_in">local</span>/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选增加 visual studio code 命令行 code 支持 zsh</span></span><br><span class="line"><span class="keyword">function</span> code &#123;</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$#</span> = 0 ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        open -a <span class="string">"Visual Studio Code"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">local</span> argPath=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">        [[ <span class="variable">$1</span> = /* ]] &amp;&amp; argPath=<span class="string">"<span class="variable">$1</span>"</span> || argPath=<span class="string">"<span class="variable">$PWD</span>/<span class="variable">$&#123;1#./&#125;</span>"</span></span><br><span class="line">        open -a <span class="string">"Visual Studio Code"</span> <span class="string">"<span class="variable">$argPath</span>"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决 Too many files open error</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 10000</span><br><span class="line"><span class="built_in">ulimit</span> -u 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新环境变量</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 powerline 字体</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/powerline/fonts.git</span><br><span class="line"><span class="built_in">cd</span> fonts</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><blockquote><p>配置 iTerm2 主题，主题可以从 iterm2colorschemes 下载</p></blockquote><p><a href="https://iterm2colorschemes.com/" target="_blank" rel="noopener">https://iterm2colorschemes.com/</a></p><ol><li>Download iTerm2 color you like</li><li>Open iTerm2 that we already downloaded at the first section</li><li>Go to iTerm2 &gt; Preferences &gt; Profiles &gt; Colors Tab</li><li>Click Color Presets at the bottom right</li><li>Click Import</li><li>Select the *.itermcolors file</li><li>Select the * from Load Presets</li></ol><p>在 Keys -&gt; Hotkey 中设置 <code>command + i</code> 快速显示和隐藏 iTerm<br>在 Profiles -&gt; Default -&gt; Colors -&gt; Load Presets 导入主题，作为默认颜色，我的主题是 <code>3024 Night</code><br>在 Profiles -&gt; Text -&gt; Change Font 调整字体 / 大小 / 颜色等，我的字体是 <code>18pt Ubuntu Mono derivative Powerline</code></p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p><img src="http://wx4.sinaimg.cn/large/7207510dgy1fxgwknz69qg20jg0b5hdz.gif" alt=""></p><h3 id="升级-macOS-Mojave-新版卡顿和字体发虚解决方案"><a href="#升级-macOS-Mojave-新版卡顿和字体发虚解决方案" class="headerlink" title="升级 macOS Mojave 新版卡顿和字体发虚解决方案"></a>升级 macOS Mojave 新版卡顿和字体发虚解决方案</h3><ol><li>输入文字卡顿</li></ol><p>如果你的 Mac 已经更新至 macOS Mojave，在输入文字时经常卡顿，频繁出现小风车，那很有可能是搜狗输入法造成的，只需将它升级至最新的 4.8.0 版本，即可完美解决。</p><ol start="2"><li>字体发虚</li></ol><p>升级 macOS Mojave 新系统后，苹果默认关闭了子像素抗锯齿，导致字体变细锯齿增多。<br>解决字体渲染过细，打开终端，输入：</p><pre><code>defaults write -g CGFontRenderingFontSmoothingDisabled -bool NO</code></pre><p>重启应用比如 VS Code 后即可看到效果</p><h3 id="解决-Command-Q-经常误按"><a href="#解决-Command-Q-经常误按" class="headerlink" title="解决 Command+Q 经常误按"></a>解决 Command+Q 经常误按</h3><p>Slow Quit Apps</p><p>A macOS app that adds a global delay of 1 second to the Cmd-Q shortcut. In other words, you have to hold down Cmd-Q for 1 second before an application will quit.</p><p>When the delay is active, an overlay is drawn at the center of the screen.</p><p><a href="https://github.com/dteoh/SlowQuitApps" target="_blank" rel="noopener">https://github.com/dteoh/SlowQuitApps</a></p><p>brew cask install slowquitapps</p><p>运行程序按照提示授权后重启应用并设置开机自启动即可享受 1s 延迟关闭提醒，如果觉得时间不够长可以自己设定</p><h3 id="提示应用程序被破坏无法打开"><a href="#提示应用程序被破坏无法打开" class="headerlink" title="提示应用程序被破坏无法打开"></a>提示应用程序被破坏无法打开</h3><blockquote><p>SOLVED: “Application” is damaged and can’t be opened in macOS Sierra</p></blockquote><pre><code>sudo spctl --master-disable</code></pre><p>输入密码重新打开 System Preferences &gt; Security &amp; Privacy &gt; General 即可看到之前隐藏的“Anywhere”<br><a href="https://www.santoshsrinivas.com/disable-gatekeeper-in-macos-sierra/" target="_blank" rel="noopener">https://www.santoshsrinivas.com/disable-gatekeeper-in-macos-sierra/</a></p><h3 id="更改-Apple-ID-国家或地区"><a href="#更改-Apple-ID-国家或地区" class="headerlink" title="更改 Apple ID 国家或地区"></a>更改 Apple ID 国家或地区</h3><blockquote><p>区域在国内即使身在国外也看不到你需要的很多东东，建议修改</p></blockquote><p><a href="https://support.apple.com/zh-cn/ht201389" target="_blank" rel="noopener">https://support.apple.com/zh-cn/ht201389</a></p><h3 id="USB-Type-C-耳机"><a href="#USB-Type-C-耳机" class="headerlink" title="USB Type-C 耳机"></a>USB Type-C 耳机</h3><ol><li>插入耳机至任意 USB Type-C 接口</li><li>System Preferences -&gt; Sound -&gt; Output -&gt; 选择识别到的耳机设备即可</li></ol><h3 id="Macbook-外置键盘如何更改设置"><a href="#Macbook-外置键盘如何更改设置" class="headerlink" title="Macbook 外置键盘如何更改设置"></a>Macbook 外置键盘如何更改设置</h3><p>option 改成 command（win 版键盘下的四个方块图标按键）<br>command 改成 option</p><p><a href="https://jingyan.baidu.com/article/363872ec2185346e4aa16f61.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/363872ec2185346e4aa16f61.html</a></p><h3 id="配置从命令提示行启动-vscode"><a href="#配置从命令提示行启动-vscode" class="headerlink" title="配置从命令提示行启动 vscode"></a>配置从命令提示行启动 vscode</h3><p>安装 Visual Studio Code，打开命令面板（按 F1 或 command + shift + p）输入 Shell 命令找到 Shell 命令: 在 PATH 中安装 “code” 命令。命令执行完成之后，重启终端工具使新的 $PATH 可用。现在，您可以简单地在终端中任意文件夹下输入‘code .’来编辑该文件夹下的文件了。</p><h3 id="Git-Ignore"><a href="#Git-Ignore" class="headerlink" title="Git Ignore"></a>Git Ignore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新文件 ~/.gitignore ，并将以下内容添加进去，这样全部 git 仓库将会忽略以下内容所提及的文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Folder view configuration files</span></span><br><span class="line">.DS_Store</span><br><span class="line">Desktop.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thumbnail cache files</span></span><br><span class="line">._*</span><br><span class="line">Thumbs.db</span><br><span class="line"></span><br><span class="line"><span class="comment"># Files that might appear on external disks</span></span><br><span class="line">.Spotlight-V100</span><br><span class="line">.Trashes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiled Python files</span></span><br><span class="line">*.pyc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiled C++ files</span></span><br><span class="line">*.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># Application specific files</span></span><br><span class="line">venv</span><br><span class="line">node_modules</span><br><span class="line">.sass-cache</span><br></pre></td></tr></table></figure><h3 id="禁止-DS-store-生成"><a href="#禁止-DS-store-生成" class="headerlink" title="禁止. DS_store 生成"></a>禁止. DS_store 生成</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁止 .DS_store 生成，打开“终端”，复制黏贴下面的命令，回车执行，重启 Mac 即可生效。</span></span><br><span class="line">defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool TRUE</span><br><span class="line"><span class="comment"># 恢复 .DS_store 生成</span></span><br><span class="line">defaults delete com.apple.desktopservices DSDontWriteNetworkStores</span><br><span class="line"><span class="comment"># 刪除已存在的. DS_Store</span></span><br><span class="line">sudo find . -name <span class="string">".DS_Store"</span> -depth -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="ssh-相关"><a href="#ssh-相关" class="headerlink" title="ssh 相关"></a>ssh 相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -bash: warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory</span></span><br><span class="line"><span class="comment"># 禁止 OpenSSH 客户端从 OS X/Linux/Unix 桌面发送 LC_* 变量</span></span><br><span class="line">vi /etc/ssh/ssh_config</span><br><span class="line"><span class="comment">#SendEnv LANG LC_*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># port forwarding</span></span><br><span class="line">ssh -p 22202 wangao@127.0.0.1</span><br><span class="line">ssh -p 22202 wangao@127.0.0.1 -X</span><br><span class="line">scp -P 22202 -r sysctl.sh sysctl.d/ wangao@127.0.0.1:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh tunnel for one-time</span></span><br><span class="line">ssh -t -A wangao@xx.xx.xx.xx ssh wangao@10.65.32.60</span><br><span class="line"></span><br><span class="line"><span class="comment"># config ssh tunnel to make easy connect everyday</span></span><br><span class="line">vim ~/.ssh/config</span><br><span class="line"></span><br><span class="line">StrictHostKeyChecking=no</span><br><span class="line"></span><br><span class="line">Host 10.65.32.*</span><br><span class="line">  HostName %h</span><br><span class="line">  ProxyCommand ssh bastion_GOP_SG_NC_MAIN -W %h:%p</span><br><span class="line">Host bastion_GOP_SG_NC_MAIN</span><br><span class="line">  HostName 8.8.8.8</span><br><span class="line">  port 22</span><br><span class="line">  User wangao</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">ssh 10.65.32.60</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      学习使用MacBook
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Zabbix 使用企业微信告警配置小结</title>
    <link href="https://wsgzao.github.io/post/zabbix-alert-wechat/"/>
    <id>https://wsgzao.github.io/post/zabbix-alert-wechat/</id>
    <published>2018-10-17T06:59:49.000Z</published>
    <updated>2018-10-26T09:12:51.246Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>从 Zabbix 3.0 开始就已经有很多小伙伴开始使用微信公众号或者企业微信配置 Zabbix 告警，当然这里还可以使用阿里钉钉，Mattermost 等各种第三方集成方案。传统的邮件告警有效但笨重，短信告警及时但成本高，现在手机越来越强大，互联网套餐资费逐步降低，普通人使用手机的频率已经超过了 PC 端，而且移动办公也已经慢慢融入我们的生活。这里简单记录基于新版 Zabbix 4.0 LTS 配置企业微信告警配置步骤，希望对大家有帮助。</p><blockquote><p>用企业微信配置 Zabbix 告警</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 10 月 17 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zabbix-alert-wechat/">https://wsgzao.github.io/post/zabbix-alert-wechat/</a></p><p><strong> 扩展阅读 </strong></p><p>zabbix Alert WeChat zabbix 微信告警 - <a href="https://github.com/X-Mars/Zabbix-Alert-WeChat" target="_blank" rel="noopener">https://github.com/X-Mars/Zabbix-Alert-WeChat</a></p><hr><h2 id="Zabbix-简介"><a href="#Zabbix-简介" class="headerlink" title="Zabbix 简介"></a>Zabbix 简介</h2><blockquote><p>大家对 Zabbix 应该已经很熟悉了，不用你多介绍了吧</p></blockquote><p>Zabbix 是由 Alexei Vladishev 创建，目前由 Zabbix SIA 在持续开发和支持。</p><p>Zabbix 是一个企业级的分布式开源监控方案。</p><p>Zabbix 是一款能够监控各种网络参数以及服务器健康性和完整性的软件。Zabbix 使用灵活的通知机制，允许用户为几乎任何事件配置基于邮件的告警。这样可以快速反馈服务器的问题。基于已存储的数据，Zabbix 提供了出色的报告和数据可视化功能。这些功能使得 Zabbix 成为容量规划的理想方案。</p><p>Zabbix 支持主动轮询和被动捕获。Zabbix 所有的报告、统计信息和配置参数都可以通过基于 Web 的前端页面进行访问。基于 Web 的前端页面可以确保您从任何方面评估您的网络状态和服务器的健康性。适当的配置后，Zabbix 可以在 IT 基础架构监控方面扮演重要的角色。对于只有少量服务器的小型组织和拥有大量服务器的大型公司也同样如此。</p><p>Zabbix 是免费的。Zabbix 是根据 GPL 通用公共许可证第 2 版编写和发行的。这意味着它的源代码都是免费发行的，可供公众任意使用。</p><p>世界各地许多不同规模的组织将 Zabbix 作为主要的监控平台。</p><p><a href="https://www.zabbix.com/documentation/3.4/zh/start" target="_blank" rel="noopener">Zabbix Documentation 3.4 中文版</a></p><p><a href="https://www.zabbix.com/documentation/current/start" target="_blank" rel="noopener">Zabbix Documentation 4.0 英文版</a></p><h2 id="Zabbix-安装"><a href="#Zabbix-安装" class="headerlink" title="Zabbix 安装"></a>Zabbix 安装</h2><p><a href="https://wsgzao.github.io/post/zabbix/">Zabbix 使用指北</a></p><h2 id="微信告警配置"><a href="#微信告警配置" class="headerlink" title="微信告警配置"></a>微信告警配置</h2><p>企业微信注册网址（如果有直接登陆即可）<br><a href="https://work.weixin.qq.com" target="_blank" rel="noopener">https://work.weixin.qq.com</a></p><p>在企业微信中需要获取知道的信息</p><ol><li>CorpID（获取方法：企业微信中我的企业 -&gt; 企业信息）</li><li>User（获取方法：企业微信中通信录点击要接收消息者的名字）</li><li>Partyid（获取方法：企业微信中通信录左侧部门的选择按钮显示部门 ID）[群发时需要]</li><li>Agentid（获取方法：在企业微信中企业用用中创建自建应用中，所以微信监控需要在微信企业中自建一个应用）</li><li>Secret（获取方法：同 Agentid）</li></ol><p><img src="http://ws3.sinaimg.cn/large/7207510dgy1fwcf1dmj23j20u70mkq5m.jpg" alt=""><br><img src="http://wx2.sinaimg.cn/large/7207510dgy1fwcf1qxxgxj20h108at9c.jpg" alt=""><br><img src="http://ws1.sinaimg.cn/large/7207510dgy1fwcex9ke1pj20uk0bt0uc.jpg" alt=""><br><img src="http://wx4.sinaimg.cn/large/7207510dgy1fwcexrrpxtj20lt0b6mxz.jpg" alt=""></p><h2 id="配置-Zabbix-发送微信消息的脚本并测试"><a href="#配置-Zabbix-发送微信消息的脚本并测试" class="headerlink" title="配置 Zabbix 发送微信消息的脚本并测试"></a>配置 Zabbix 发送微信消息的脚本并测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 zabbix-server 配置文件，查看 zabbix 默认脚本路径配置是否打开 </span></span><br><span class="line">egrep -v <span class="string">'^$|^#'</span> /etc/zabbix/zabbix_server.conf  </span><br><span class="line"></span><br><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装必要的软件包 </span></span><br><span class="line">yum install -y epel-release </span><br><span class="line">yum install -y gcc telnet wget git vim python python-pip</span><br><span class="line"><span class="comment"># update pip</span></span><br><span class="line">pip install --upgrade pip</span><br><span class="line"><span class="comment"># install requests</span></span><br><span class="line">pip install requests</span><br><span class="line">pip install --upgrade requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传脚本至 server 配置文件中 AlertScriptsPath 所对应的路径下：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/lib/zabbix/alertscripts/</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/X-Mars/Zabbix-Alert-WeChat.git</span><br><span class="line">cp Zabbix-Alert-WeChat/wechat.py .</span><br><span class="line">chown zabbix:zabbix wechat.py config.json</span><br><span class="line">chmod +x wechat.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传好该脚本后对脚本进行测试 </span></span><br><span class="line">python wechat.py wangao <span class="built_in">test</span> helloworld</span><br><span class="line">&#123;u<span class="string">'invaliduser'</span>: u<span class="string">''</span>, u<span class="string">'errcode'</span>: 0, u<span class="string">'errmsg'</span>: u<span class="string">'ok'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 企业号中的用户帐号，在 zabbix 用户 Media 中配置，如果配置不正常，将按部门发送 </span></span><br><span class="line">python wechat.py wangao1 <span class="built_in">test</span> wangao</span><br><span class="line">&#123;u<span class="string">'invaliduser'</span>: u<span class="string">'wangao1'</span>, u<span class="string">'errcode'</span>: 0, u<span class="string">'errmsg'</span>: u<span class="string">'ok'</span>&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 参数说明，这里使用企业号中的部门 ID 作群发使用 </span></span><br><span class="line">Corpid = <span class="string">"xxx"</span> <span class="comment"># CorpID 是企业号的标识 </span></span><br><span class="line">Secret = <span class="string">"xxx"</span> <span class="comment"># Secret 是管理组凭证密钥 </span></span><br><span class="line">Agentid = <span class="string">"1000002"</span> <span class="comment"># 应用 ID</span></span><br><span class="line">Partyid = <span class="string">"2"</span> <span class="comment"># 部门 ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看企业微信测试告警通知 </span></span><br></pre></td></tr></table></figure><h2 id="Zabbix-界面配置"><a href="#Zabbix-界面配置" class="headerlink" title="Zabbix 界面配置"></a>Zabbix 界面配置</h2><blockquote><p>Zabbix 4.0 和老版本在界面显示上有略微差异</p></blockquote><ol><li>创建告警媒介</li></ol><p>Administration - Media types - Create media type</p><p>Name: wechat<br>Type: Script<br>Script name: wechat.py<br>Script parameters: </p><ul><li>{ALERT.SENDTO}</li><li>{ALERT.SUBJECT}</li><li>{ALERT.MESSAGE}</li></ul><p><img src="http://ws1.sinaimg.cn/large/7207510dgy1fwdcyast9fj20na0ehdh7.jpg" alt=""></p><ol start="2"><li>创建 wechat 专用账户</li></ol><p>Administration - Users - Create user</p><p>Alias: wechat<br>Groups: Zabbix administrators # 根据需求定义</p><ol start="3"><li>为专用账户添加 Media</li></ol><p>Users - Media - Add</p><p>Type: wechat<br>Send to: 2 # 因为我配置的是群发所以按照部门 ID 填写区分不同项目监控，也可以按照用户名独立发送</p><p><img src="http://wx3.sinaimg.cn/large/7207510dgy1fwdcyprfv9j21030hjac0.jpg" alt=""></p><ol start="4"><li>设置告警动作</li></ol><p>Configuration - Actions - Create actions</p><p>创建动作</p><p>[Action]<br>Name: wechat<br>Conditions: # 根据需求定义<br>A    Trigger severity is greater than or equals Not classified</p><p>事件触发时的通知操作</p><p>[Operations]<br>Default operation step duration: 1m</p><p>Default subject:<br>Problem: {EVENT.NAME}</p><p>Default message:<br>Time: {EVENT.DATE} {EVENT.TIME}<br>Host: {HOST.NAME}<br>Level: {TRIGGER.SEVERITY}<br>ItemValue: {ITEM.VALUE}</p><p>Operations:<br>Send to Uers: wechat<br>Send only to: wechat<br>Conditions: Event acknowledged equals Not Ack</p><p>事件恢复时的通知操作</p><p>[Recovery operations]<br>Default subject:<br>Resolved: {EVENT.NAME}</p><p>Default message:<br>Time: {EVENT.DATE} {EVENT.TIME}<br>Host: {HOST.NAME}<br>Level: {TRIGGER.SEVERITY}<br>ItemValue: {ITEM.VALUE}</p><p>Operations:<br>Send to Uers: wechat<br>Send only to: wechat</p><p><img src="http://wx2.sinaimg.cn/large/7207510dgy1fwdczf20yyj20oy0ro77l.jpg" alt=""></p><p>更多有关 Zabbix Supported macros 的定义请参考官方解释</p><p><a href="https://www.zabbix.com/documentation/current/manual/appendix/macros/supported_by_location" target="_blank" rel="noopener">Zabbix Supported macros</a></p><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p>A. 测试不能通过，返回 errcode！</p><ol><li>检查 / etc/weixincfg.json 文件里的 corpid，secert，agentid 配置是否正确</li><li>检查接受者企业账号是否正确</li><li>检查接受着是否在这个应用的通讯录里</li></ol><p>B. Zabbix 不能收到告警消息</p><ol><li>检查发送程序有无可执行权限</li><li>检查发送程序是否在 zabbix server 的 AlertScriptsPath 目录下</li><li>检查是否关联到用户</li><li>检查是否掉用了发送动作</li></ol><p>C. 发送限制</p><ol><li>发送频率基本可以满足需求, 没有别的限制。</li><li>每日发送次数有一定限制，具体与企业号关注人数有关，详情查看企业号开发文档</li></ol>]]></content>
    
    <summary type="html">
    
      用企业微信配置Zabbix告警
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>ZooKeeper 安装使用</title>
    <link href="https://wsgzao.github.io/post/zookeeper/"/>
    <id>https://wsgzao.github.io/post/zookeeper/</id>
    <published>2018-09-27T07:59:49.000Z</published>
    <updated>2018-10-01T08:12:42.713Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>相信大家对 ZooKeeper 应该不算陌生，ZooKeeper 的使用和 ZooKeeper 集群的搭建并不复杂，这里分享自己看到的一些好文章以及使用 Ansible 快速部署和手动部署 ZooKeeper 的经验分享。</p><blockquote><p>ZooKeeper 分布式环境的协调利器</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 09 月 27 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/zookeeper/">https://wsgzao.github.io/post/zookeeper/</a></p><p><strong> 扩展阅读 </strong></p><p>ZooKeeper - <a href="https://zookeeper.apache.org/" target="_blank" rel="noopener">https://zookeeper.apache.org/</a></p><hr><h2 id="ZooKeeper-简介"><a href="#ZooKeeper-简介" class="headerlink" title="ZooKeeper 简介"></a>ZooKeeper 简介</h2><p>ZooKeeper is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services. All of these kinds of services are used in some form or another by distributed applications. Each time they are implemented there is a lot of work that goes into fixing the bugs and race conditions that are inevitable. Because of the difficulty of implementing these kinds of services, applications initially usually skimp on them ,which make them brittle in the presence of change and difficult to manage. Even when done correctly, different implementations of these services lead to management complexity when the applications are deployed.</p><p>ZooKeeper 是一个开源的为分布式应用提供分布式协调的服务。它公开了一组简单的原语，分布式应用程序可以基于这些原语实现更高级别的服务，包括同步、维护配置、组和命名。它的设计易于编程，它使用一个遵循文件系统中常见的目录树结构的数据模型。它在 Java 环境中运行，对 Java 和 C 都有绑定。<br>协调服务是出了名的难。它们特别容易出错，如竞态条件和死锁。ZooKeeper 背后的动机是让分布式应用从零开始实现一站式协调服务。</p><p>翻译：ZooKeeper OverView<br><a href="https://www.cnblogs.com/f-ck-need-u/p/9231153.html" target="_blank" rel="noopener">https://www.cnblogs.com/f-ck-need-u/p/9231153.html</a></p><p>可能是全网把 ZooKeeper 概念讲的最清楚的一篇文章<br><a href="https://github.com/Snailclimb/JavaGuide/blob/master/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/ZooKeeper.md" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide/blob/master/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/ZooKeeper.md</a></p><h2 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h2><h3 id="install-jdk-by-ansible"><a href="#install-jdk-by-ansible" class="headerlink" title="install jdk by ansible"></a>install jdk by ansible</h3><p><a href="https://galaxy.ansible.com/geerlingguy/java" target="_blank" rel="noopener">https://galaxy.ansible.com/geerlingguy/java</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download</span></span><br><span class="line">ansible-galaxy install geerlingguy.java</span><br><span class="line"><span class="comment"># create yaml file and config java version</span></span><br><span class="line">vi install_jdk.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  roles:</span><br><span class="line">    - role: geerlingguy.java</span><br><span class="line">      when: <span class="string">"ansible_os_family =='RedHat'"</span></span><br><span class="line">      java_packages:</span><br><span class="line">        - java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><h3 id="install-jdk-manually"><a href="#install-jdk-manually" class="headerlink" title="install jdk manually"></a>install jdk manually</h3><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum</span></span><br><span class="line">yum install java-1.8.0-openjdk</span><br><span class="line"><span class="comment"># rpm</span></span><br><span class="line">yum localinstall -y jdk-8u181-linux-x64.rpm</span><br><span class="line"><span class="comment"># set env</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_181</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin </span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h2><h3 id="install-zookeeper-by-ansible"><a href="#install-zookeeper-by-ansible" class="headerlink" title="install zookeeper by ansible"></a>install zookeeper by ansible</h3><p><a href="https://galaxy.ansible.com/ansibleshipyard/ansible-zookeeper" target="_blank" rel="noopener">https://galaxy.ansible.com/ansibleshipyard/ansible-zookeeper</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download</span></span><br><span class="line">ansible-galaxy install AnsibleShipyard.ansible-zookeeper</span><br><span class="line"><span class="comment"># create yaml file and config zookeeper version</span></span><br><span class="line">vi install_zookeeper.yml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">- name: Installing ZooKeeper</span><br><span class="line">  hosts: all</span><br><span class="line">  sudo: yes</span><br><span class="line">  vars:</span><br><span class="line">    zookeeper_version: 3.4.12</span><br><span class="line">  roles:</span><br><span class="line">    - role: AnsibleShipyard.ansible-zookeeper</span><br></pre></td></tr></table></figure><h3 id="install-zookeeper-manually"><a href="#install-zookeeper-manually" class="headerlink" title="install zookeeper manually"></a>install zookeeper manually</h3><p><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener">https://zookeeper.apache.org/releases.html#download</a><br><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install jdk</span></span><br><span class="line">yum -y install java-1.8.0-openjdk</span><br><span class="line"><span class="comment"># download and install zookeeper</span></span><br><span class="line">tar -zxvf zookeeper-3.4.12.tar.gz —C /opt</span><br><span class="line">ln -s /opt/zookeeper-3.4.12 /opt/zookeeper</span><br><span class="line"><span class="built_in">cd</span> /opt/zookeeper</span><br><span class="line"><span class="comment"># create zoo.cfg</span></span><br><span class="line"><span class="built_in">cd</span> /opt/zookeeper/conf</span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br><span class="line">vi zoo.cfg</span><br><span class="line"></span><br><span class="line">tickTime=2000</span><br><span class="line">dataDir=/var/lib/zookeeper</span><br><span class="line">dataLogDir=/var/<span class="built_in">log</span>/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line">server.1=zoo1:2888:3888</span><br><span class="line">server.2=zoo2:2888:3888</span><br><span class="line">server.3=zoo3:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="comment"># create directory</span></span><br><span class="line">mkdir /var/lib/zookeeper</span><br><span class="line">mkdir /var/<span class="built_in">log</span>/zookeeper</span><br><span class="line"><span class="comment"># create myid file in different zookeeper</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/zookeeper/</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /var/lib/zookeeper/myid</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /var/lib/zookeeper/myid</span><br><span class="line"><span class="built_in">echo</span> 3 &gt; /var/lib/zookeeper/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># live</span></span><br><span class="line">cat &lt;&lt; EOF &gt; /opt/zookeeper/conf/zoo.cfg</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">dataDir=/data/zookeeper/data</span><br><span class="line">dataLogDir=/var/<span class="built_in">log</span>/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=192.168.188.120:2888:3888</span><br><span class="line">server.2=192.168.188.121:2888:3888</span><br><span class="line">server.3=192.168.188.122:2888:3888</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># autostart</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/opt/zookeeper/bin/zkServer.sh start'</span>  &gt;&gt; /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># start</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/zookeeper/bin</span><br><span class="line">./zkServer.sh start</span><br><span class="line"><span class="comment"># check</span></span><br><span class="line">./zkServer.sh status</span><br><span class="line"><span class="comment"># create znode</span></span><br><span class="line">./zkCli.sh -server 127.0.0.1:2181</span><br><span class="line">create /codis codis</span><br><span class="line">ls /</span><br><span class="line">[zookeeper, codis]</span><br></pre></td></tr></table></figure><h2 id="Zookeeper-Configuration"><a href="#Zookeeper-Configuration" class="headerlink" title="Zookeeper Configuration"></a>Zookeeper Configuration</h2><p>Platform: RHEL / CentOS 7<br>Java: Oracle JDK</p><blockquote><p>Variables</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">zookeeper_version: 3.4.12</span><br><span class="line">zookeeper_group: zookeeper</span><br><span class="line">zookeeper_user: zookeeper</span><br><span class="line">zookeeper_dir: /opt/zookeeper-&#123;&#123;zookeeper_version&#125;&#125; <span class="comment"># or /opt/zookeeper</span></span><br><span class="line">zookeeper_conf_dir: &#123;&#123;zookeeper_dir&#125;&#125; <span class="comment"># or /etc/zookeeper</span></span><br><span class="line">zookeeper_tarball_dir: /opt/src</span><br><span class="line">data_dir: /var/lib/zookeeper</span><br><span class="line">log_dir: /var/<span class="built_in">log</span>/zookeeper</span><br><span class="line">zookeeper_client_port: 2181</span><br><span class="line">zookeeper_id: 1</span><br><span class="line">zookeeper_leader_port: 2888</span><br><span class="line">zookeeper_election_port: 3888</span><br></pre></td></tr></table></figure><blockquote><p>Default Ports</p></blockquote><table><thead><tr><th>Port</th><th>Description</th></tr></thead><tbody><tr><td>2181</td><td>Client connection port</td></tr><tr><td>2888</td><td>Quorum port for clustering</td></tr><tr><td>3888</td><td>Leader election port for clustering</td></tr></tbody></table><blockquote><p>conf/zoo.cfg</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">dataDir=/var/lib/zookeeper</span><br><span class="line">dataLogDir=/var/<span class="built_in">log</span>/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">server.1=zoo1:2888:3888</span><br><span class="line">server.2=zoo2:2888:3888</span><br><span class="line">server.3=zoo3:2888:3888</span><br></pre></td></tr></table></figure><p><strong>tickTime</strong><br>the basic time unit in milliseconds used by ZooKeeper. It is used to do heartbeats and the minimum session timeout will be twice the tickTime.</p><p><strong>dataDir</strong><br>the location to store the in-memory database snapshots and, unless specified otherwise, the transaction log of updates to the database.</p><p><strong>clientPort</strong><br>the port to listen for client connections</p><p><strong>initLimit</strong><br>is timeouts ZooKeeper uses to limit the length of time the ZooKeeper servers in quorum have to connect to a leader. </p><p><strong>syncLimit</strong><br>limits how far out of date a server can be from a leader.</p><p>In this example, the timeout for initLimit is 5 ticks at 2000 milleseconds a tick, or 10 seconds.</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>ZooKeeper 系列文章<br><a href="https://www.cnblogs.com/f-ck-need-u/p/7576137.html#zk" target="_blank" rel="noopener">https://www.cnblogs.com/f-ck-need-u/p/7576137.html#zk</a></p><p>ZooKeeper 系列 (1)：安装搭建 ZooKeeper 环境<br><a href="https://www.cnblogs.com/f-ck-need-u/p/9235308.html" target="_blank" rel="noopener">https://www.cnblogs.com/f-ck-need-u/p/9235308.html</a></p><p>Administrator’s Guide - a guide for system administrators and anyone else who might deploy ZooKeeper<br><a href="https://zookeeper.apache.org/doc/current/zookeeperAdmin.html" target="_blank" rel="noopener">https://zookeeper.apache.org/doc/current/zookeeperAdmin.html</a></p>]]></content>
    
    <summary type="html">
    
      ZooKeeper分布式环境的协调利器
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Scribe 安装使用</title>
    <link href="https://wsgzao.github.io/post/scribe/"/>
    <id>https://wsgzao.github.io/post/scribe/</id>
    <published>2018-09-27T06:59:49.000Z</published>
    <updated>2018-11-22T09:22:14.246Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Scribe 是 Facebook 开源的日志收集工具，我建议大家还是老老实实使用 ELK 或者 Splunk，不要瞎折腾 Scribe</p><blockquote><p>Centos 安装 Scribe 真是累</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 09 月 27 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/scribe/">https://wsgzao.github.io/post/scribe/</a></p><p><strong> 扩展阅读 </strong></p><p>Scribe - <a href="https://github.com/facebookarchive/scribe" target="_blank" rel="noopener">https://github.com/facebookarchive/scribe</a><br>Thrift - <a href="http://thrift.apache.org/docs/install/centos" target="_blank" rel="noopener">http://thrift.apache.org/docs/install/centos</a></p><hr><h2 id="Scribe-简介"><a href="#Scribe-简介" class="headerlink" title="Scribe 简介"></a>Scribe 简介</h2><p>Scribe is a server for aggregating log data that’s streamed in real time from clients. It is designed to be scalable and reliable.ß</p><p>See the Scribe Wiki for documentation:<br><a href="http://wiki.github.com/facebook/scribe" target="_blank" rel="noopener">http://wiki.github.com/facebook/scribe</a></p><h2 id="install-scribe"><a href="#install-scribe" class="headerlink" title="install scribe"></a>install scribe</h2><blockquote><p>OS: CentOS 7.x</p></blockquote><p>This guide shows how to install the precompiled scribed binary and its dependencies on a new server. Care must be taken to use the required versions for <code>boost (1.44.0)</code>, <code>thrift (0.7.0)</code> and <code>libevent (1.4.10)</code>. </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install necessary tools</span></span><br><span class="line">sudo yum install git make flex bison libtool automake openssl-devel libevent libevent-devel python-devel gcc-c++ byacc java-1.7.0-openjdk ant</span><br><span class="line"></span><br><span class="line"><span class="comment"># update autoconf</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">sudo rpm -e --nodeps `rpm -qf /usr/bin/autoconf`</span><br><span class="line">wget http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz</span><br><span class="line">tar xzf autoconf-2.69.tar.gz</span><br><span class="line"><span class="built_in">cd</span> autoconf-2.69/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="comment"># make sure /usr/local/bin is in system PATH: add following line to ~/.bashrc</span></span><br><span class="line">vi ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># install boost</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">wget http://jaist.dl.sourceforge.net/project/boost/boost/1.44.0/boost_1_44_0.tar.gz</span><br><span class="line">tar xzf boost_1_44_0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> boost_1_44_0/</span><br><span class="line">./bootstrap.sh</span><br><span class="line">sudo ./bjam install</span><br><span class="line"></span><br><span class="line"><span class="comment"># install thrift</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/apache/thrift.git</span><br><span class="line"><span class="built_in">cd</span> thrift/</span><br><span class="line">git fetch</span><br><span class="line">git branch -a</span><br><span class="line">git checkout 0.7.x</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">cp compiler/cpp/thrifty.hh compiler/cpp/thrifty.h</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> lib/py/</span><br><span class="line">sudo python setup.py install</span><br><span class="line"></span><br><span class="line"><span class="comment"># install fb303</span></span><br><span class="line"><span class="built_in">cd</span> ~/thrift/contrib/fb303/</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./configure CPPFLAGS=<span class="string">"-DHAVE_INTTYPES_H -DHAVE_NETINET_IN_H"</span></span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> py/</span><br><span class="line">sudo python setup.py install</span><br><span class="line"></span><br><span class="line"><span class="comment"># install libevent</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">wget https://github.com/downloads/libevent/libevent/libevent-1.4.10-stable.tar.gz</span><br><span class="line">tar xf libevent-1.4.10-stable.tar.gz </span><br><span class="line"><span class="built_in">cd</span> libevent-1.4.10-stable</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the scribed binary and put it in the desired directory</span></span><br><span class="line">scp scribe.tar.gz 10.65.32.134:/tmp</span><br><span class="line">scp scribed 10.65.32.134:/tmp</span><br><span class="line"><span class="comment"># unzip and mkdir</span></span><br><span class="line">mkdir /opt/running</span><br><span class="line"><span class="built_in">cd</span> /opt/running</span><br><span class="line">cp /tmp/scribe.tar.gz .</span><br><span class="line">tar xzvf scribe.tar.gz</span><br><span class="line">rm -f scribe.tar.gz</span><br><span class="line">mkdir -p /data/gop/live/primary/gop</span><br><span class="line">mkdir -p /data/gop/live/secondary/gop</span><br><span class="line">cp /tmp/scribed /usr/<span class="built_in">local</span>/bin/scribed</span><br><span class="line"><span class="built_in">cd</span> scribe/</span><br><span class="line"></span><br><span class="line">[root@vm4 scribe]<span class="comment"># cat run_scribed.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">export</span> LD_LIBRARY_PATH=/usr/lib:/usr/<span class="built_in">local</span>/lib</span><br><span class="line">        /usr/<span class="built_in">local</span>/bin/scribed scribe_11315.conf 1&gt;output/scribe.log 2&gt;output/scribe.err</span><br><span class="line">        sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">nohup sh run_scribed.sh &amp;</span><br><span class="line"></span><br><span class="line">[root@sg-gop-10-65-32-134 scribe]<span class="comment"># netstat -tlnp</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      55310/zabbix_agentd</span><br><span class="line">tcp        0      0 0.0.0.0:38422           0.0.0.0:*               LISTEN      52781/sshd</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1305/sshd</span><br><span class="line">tcp6       0      0 :::10050                :::*                    LISTEN      55310/zabbix_agentd</span><br><span class="line">tcp6       0      0 :::11315                :::*                    LISTEN      4294/scribed</span><br><span class="line">tcp6       0      0 :::38422                :::*                    LISTEN      52781/sshd</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1305/sshd</span><br></pre></td></tr></table></figure><h2 id="自动配置-scribe-sh"><a href="#自动配置-scribe-sh" class="headerlink" title="自动配置 scribe.sh"></a>自动配置 scribe.sh</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"><span class="comment">#scribe server installation for CentOS 7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$#</span>"</span> -ne 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Usage: bash <span class="variable">$0</span> project_name"</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">yum -y install git make flex bison libtool automake openssl-devel libevent libevent-devel python-devel gcc-c++ byacc java-1.7.0-openjdk ant</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#===============update autoconf===============</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">sudo rpm -e --nodeps `rpm -qf /usr/bin/autoconf`</span><br><span class="line">wget http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz</span><br><span class="line">tar xzf autoconf-2.69.tar.gz</span><br><span class="line"><span class="built_in">cd</span> autoconf-2.69/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"export PATH=<span class="variable">$PATH</span>:/usr/local/bin"</span> &gt;&gt; /etc/bashrc</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#.===============install boost===============</span></span><br><span class="line">wget http://jaist.dl.sourceforge.net/project/boost/boost/1.44.0/boost_1_44_0.tar.gz</span><br><span class="line">tar xzf boost_1_44_0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> boost_1_44_0/</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./bjam install</span><br><span class="line"></span><br><span class="line"><span class="comment">#add new lib path for libboost</span></span><br><span class="line"><span class="comment">#echo "/usr/local/lib" &gt;&gt; /etc/ld.so.conf.d/localbin.conf</span></span><br><span class="line"><span class="comment">#ldconfig</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#===============install thrift===============</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/apache/thrift.git</span><br><span class="line"><span class="built_in">cd</span> thrift/</span><br><span class="line">git fetch</span><br><span class="line">git branch -a</span><br><span class="line">git checkout 0.7.x</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./configure</span><br><span class="line">mv compiler/cpp/thrifty.hh compiler/cpp/thrifty.h</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> lib/py</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line"><span class="comment">#===============install fb303===============</span></span><br><span class="line"><span class="built_in">cd</span> ~/thrift/contrib/fb303/</span><br><span class="line">./bootstrap.sh</span><br><span class="line">./configure CPPFLAGS=<span class="string">"-DHAVE_INTTYPES_H -DHAVE_NETINET_IN_H"</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> py/</span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line"><span class="comment">#===============install libevent =============== </span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">wget https://github.com/downloads/libevent/libevent/libevent-1.4.10-stable.tar.gz</span><br><span class="line">tar xf libevent-1.4.10-stable.tar.gz </span><br><span class="line"><span class="built_in">cd</span> libevent-1.4.10-stable</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#setup scribe server</span></span><br><span class="line">mkdir -p /opt/scribe_server/<span class="variable">$PROJECT</span>/</span><br><span class="line"><span class="built_in">cd</span> /opt/scribe_server/<span class="variable">$PROJECT</span>/</span><br><span class="line">cat &lt;&lt;EOF&gt;&gt;scribed.conf</span><br><span class="line">port=12315</span><br><span class="line">max_msg_per_second=2000000</span><br><span class="line">check_interval=5</span><br><span class="line">new_thread_per_category=yes</span><br><span class="line">num_thrift_server_threads=5</span><br><span class="line"></span><br><span class="line">&lt;store&gt;</span><br><span class="line">category=default</span><br><span class="line"><span class="built_in">type</span>=buffer</span><br><span class="line"></span><br><span class="line">target_write_size=20480</span><br><span class="line">max_write_interval=1</span><br><span class="line">buffer_send_rate=2</span><br><span class="line">retry_interval=30</span><br><span class="line">retry_interval_range=10</span><br><span class="line"></span><br><span class="line">&lt;primary&gt;</span><br><span class="line"><span class="built_in">type</span>=file</span><br><span class="line">fs_type=std</span><br><span class="line">file_path=/data/scribe_primary/<span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">max_size=1000000000</span><br><span class="line">rotate_period=daily</span><br><span class="line">rotate_hour=0</span><br><span class="line">&lt;/primary&gt;</span><br><span class="line"></span><br><span class="line">&lt;secondary&gt;</span><br><span class="line"><span class="built_in">type</span>=file</span><br><span class="line">fs_type=std</span><br><span class="line">file_path=/data/scribe_secondary/<span class="variable">$&#123;PROJECT&#125;</span></span><br><span class="line">max_size=1000000000</span><br><span class="line">rotate_period=daily</span><br><span class="line">rotate_hour=0</span><br><span class="line">&lt;/secondary&gt;</span><br><span class="line">&lt;/store&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF&gt;&gt;run_scribe.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/lib:/usr/<span class="built_in">local</span>/lib</span><br><span class="line">scribed scribed.conf 1&gt;&gt;output/scribe.log 2&gt;&gt;output/scribe.err</span><br><span class="line">sleep 2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod +x run_scribe.sh</span><br><span class="line">mkdir output</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Done! Please modify config and iptables, and download scribed"</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Centos安装Scribe真是累
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>从国内跳槽至新加坡工作的经验分享</title>
    <link href="https://wsgzao.github.io/post/singapore/"/>
    <id>https://wsgzao.github.io/post/singapore/</id>
    <published>2018-09-09T06:59:49.000Z</published>
    <updated>2018-11-22T09:21:47.486Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://wx3.sinaimg.cn/large/7207510dgy1fv6xrebwasj21jj0uzqe6.jpg" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>记录和分享自己在新加坡的工作生活以及新加坡的基本介绍，如果你只想了解我是如何来到新加坡的可以直接跳到最后一章。</p><blockquote><p>为帮助大家玩转新加坡，快速适应当地生活</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 09 月 09 日 - 增加新加坡 3 个月工作生活感受<br>2018 年 08 月 01 日 - 更新个人经验<br>2018 年 05 月 15 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/singapore/">https://wsgzao.github.io/post/singapore/</a></p><p><strong> 扩展阅读 </strong></p><p>新加坡外交部 - <a href="https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch.html" target="_blank" rel="noopener">https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch.html</a><br>新加坡手册 - <a href="https://help.singask.com/" target="_blank" rel="noopener">https://help.singask.com/</a></p><hr><h2 id="认识狮城"><a href="#认识狮城" class="headerlink" title="认识狮城"></a>认识狮城</h2><p>姓名：新加坡</p><p>年龄：53 岁（成立于 1965 年，国庆日为每年的 8 月 9 日）</p><p>家庭住址：北半球赤道地区，位于马来半岛最南端 （北纬 1°22′，东经 103°48′）</p><p>住房面积：新加坡国土面积 710.3 平方公里 （新加坡面积是上海的 1/9，北京的 1/23）</p><p>家庭成员：人口约 520 万，密度达到每平方公里 7700 多人（排在世界前列）</p><p>相貌特征：新加坡多元种族和文化的相互融合是其极具魅力的原因之一，由华族（占全国人口约四分之三）、欧亚族、印度族、马来族、土生华人构成。</p><p>性格特征：新加坡以实行严格的法律和制度著称，无论是居民还是游客，都需要予以足够重视，否则可能会被课以重罚。当然，如果您遵循当地法律规章，也不必过分担心。</p><blockquote><p>所获荣誉：或许这些荣誉只属于过去，我们更需要关心的是现在和未来会怎样</p></blockquote><p>让人最想移民的国家全球排名第一<br>全球最具竞争力国家排名第一<br>最适应亚洲人士居住的地方全球排名第一<br>城市基础设施建设全球排名第一<br>全球化程度最高的城市排名第一</p><p>其他方面：<a href="http://www.visitsingapore.com.cn/travel-guide-tips/about-singapore/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/about-singapore/</a></p><h2 id="旅游出入境"><a href="#旅游出入境" class="headerlink" title="旅游出入境"></a>旅游出入境</h2><blockquote><p>签证</p></blockquote><p>中国公民去新加坡须提前申请有效签证，不可以落地签。</p><p>中国公民申请的新加坡旅游 / 商务签证为电子签证（e-Visa），在获得签证后，建议上网打印多份有效签证以防遗失。签证费为每人 SG$30。</p><p>新加坡签证可多次入境，有效期分别有 35 天 / 62 天 / 2 年，由签证官根据申请人资料而定。逗留时间则由入境官决定，通常为 14-30 天。从 2015 年 6 月 1 日起新加坡将给予符合条件的中国公民有效期长达 10 年的多次入境签证。</p><p><a href="http://www.visitsingapore.com.cn/travel-guide-tips/travelling-to-singapore/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/travelling-to-singapore/</a></p><blockquote><p>申请途径 How to Apply</p></blockquote><p>2014 年 12 月 8 日起大使馆及各领事馆停止接收签证申请，可登录新加坡外交部官网，查询中国国内官方指定的签证机构，办理新加坡签证。</p><blockquote><p>所需资料 Required Information</p></blockquote><ol><li>个人信息表（登录新加坡外交部官网下载表格，链接：<a href="http://www.mfa.gov.sg）" target="_blank" rel="noopener">www.mfa.gov.sg）</a></li><li>户口本（原件或扫描电子版，户主 + 个人页复印件）</li><li>身份证（原件或正反面扫描电子版，正反面复印件）</li><li>护照（原件或个人页扫描电子版，个人页复印件，有效期 6 个月以上）</li><li>2 张 2 寸白底免冠照片</li><li>在职证明原件或相关职业证书</li></ol><blockquote><p>出入境</p></blockquote><p>飞机上空姐会派发入境卡给需要的乘客，也可以在出入境大堂领取，入境卡为英文，入境后记得保留副联，离境时需再次出示并提交。</p><p>离境前别忘了退税，在附有 “退税” 标志的场所消费满 100 新币以上，即可退回 7% 的商品及服务税，退税时需出示购物发票或收据。具体的退税要求，可咨询工作人员。</p><blockquote><p>其它注意事项</p></blockquote><p>电源插座：新加坡使用的标准电流是 220-240 伏特交流电（50 赫兹），在这里，您可以使用三眼电源插座。</p><p><a href="http://www.visitsingapore.com.cn/travel-guide-tips/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/</a></p><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1wdtdd7j20vh12047o.jpg" alt=""></p><h2 id="新加坡入境卡模板-重要"><a href="#新加坡入境卡模板-重要" class="headerlink" title="新加坡入境卡模板(重要)"></a>新加坡入境卡模板(重要)</h2><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1vhyoaqj20fa0skq56.jpg" alt=""></p><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1w3vig9j20f60egq3m.jpg" alt=""></p><h2 id="新加坡工作准证"><a href="#新加坡工作准证" class="headerlink" title="新加坡工作准证"></a>新加坡工作准证</h2><blockquote><p>关于工作准证的最新信息请以新加坡人力部 (MOM) 发布的为准</p></blockquote><p><a href="https://www.mom.gov.sg/" target="_blank" rel="noopener">https://www.mom.gov.sg/</a></p><p>在新加坡工作，新加坡人力部 Ministry Of Manpower (MOM) 是最常打交道的政府部门，工作准证不仅是由人力部批准和颁发所有文件提交最终也是到达人力部</p><p>注意：所有提交给 MOM 的资料原件，都需要在入境的时候随身携带。以便在去人力部办卡的时候，让长官核实和查阅。</p><ol><li>新版卡片上将不再印刷准证的到期日期，新版卡片会印上二维码（QR Code），下载 SGWorkPass 的手机 APP 后，可以扫码查看持卡人的职务、证件是否有效等信息</li><li>如果过海关或签合约等需要核对卡片截止日期时，不再可以只看卡面信息，还需要扫码或在线上核对截止日期等，建议保存 SGWorkPass 截图至手机中以防万一</li></ol><p><img src="http://wx1.sinaimg.cn/large/7207510dgy1fv5lr2gqf4j21a40ek0xd.jpg" alt=""></p><p><a href="https://docs.qq.com/sheet/DeVh5ZEhKWnhCTldK" target="_blank" rel="noopener">如果发现表有错误请点击链接申请编辑更新，谢谢</a></p><h3 id="Work-Permit-WP"><a href="#Work-Permit-WP" class="headerlink" title="Work Permit (WP)"></a>Work Permit (WP)</h3><p>WP 是人力部设置的给外国低水准员工提供的工作准证。</p><p>对申请者的要求：薪水和学历：无要求<br>年龄：马来西亚人（18-58 周岁），非马来西亚人（18-50 周岁）；<br>对公司的要求：需要为其购买保额至少 15000 新币的保险；缴纳 5000 新币担保金<br>注意事项：<br>公司需要先为雇员申请好 WP 并办理保险，才可以持 WP 准证进入新加坡。在申请的状态中，本人不可以进入新加坡。</p><h3 id="S-PASS-SP"><a href="#S-PASS-SP" class="headerlink" title="S PASS (SP)"></a>S PASS (SP)</h3><p>SP 是人力部设置的给外国中级技术水准雇员提供的工作准证。</p><p>对申请者的要求：学历：大专，本科，或者技术资质认证（需要至少一年全职学习获得的技术认证）；<br>工作年限：虽然没有明文规定最少需要多少年的工作经验，但工作经验会作为一个审核标准；<br>对公司的要求：所付起薪 2200 新币；</p><p>注意事项：<br>也有公司人头配额限制：服务行业 SP 人数不可超过总员工的 15%，其它行业是 20%。<br>你在申请之前需要确保学历在 Dataflow，学信网及中国学位与研究生教育信息网上可以查到。另外，针对不同的行业，也有可能需要提交相关的专业证明。</p><h3 id="Employment-Pass（EP）"><a href="#Employment-Pass（EP）" class="headerlink" title="Employment Pass（EP）"></a>Employment Pass（EP）</h3><p>EP 是人力部设置的给外国专业人员（管理层，主管或专业职位）提供的工作准证. 是工作准证中级别最高的。</p><p>对申请者的要求：<br>年轻的申请者需拥有优秀院校的毕业证书，且达到 3600 的雇佣薪水以及拥有相关专业经验才可以申请。<br>至于年长的申请人，则必须拥有更高的薪水以及相应工作经验和工作质量。</p><p>对雇主的要求：<br>所付起薪 3600 新币</p><p>注意事项：<br>和申请 SP 一样，在申请之前需要确保学历在 Dataflow，学信网及中国学位与研究生教育信息网上可以查到。另外，针对不同的行业，也有可能需要提交相关的专业证明。<br>根据对应的准证类型，提交人力部 (MOM) 所要求的材料</p><ul><li>有效的护照信息</li><li>必要的技能证书</li><li>有效的毕业证</li></ul><p>2018 年 1 月 1 日起两件重要变化</p><ul><li>EP 准证持有人月薪至少 6000 新币以上可以给配偶和孩子申请相关准证(DP)</li><li>EP 准证持有人月薪至少 12000 新币以上可以申请父母长期探访准证（LTVP)</li></ul><h2 id="家庭成员准证"><a href="#家庭成员准证" class="headerlink" title="家庭成员准证"></a>家庭成员准证</h2><h3 id="Dependant‘s-Pass-家属准证（DP）"><a href="#Dependant‘s-Pass-家属准证（DP）" class="headerlink" title="Dependant‘s Pass 家属准证（DP）"></a>Dependant‘s Pass 家属准证（DP）</h3><p>家属准证，在新加坡工作或经商，并持有 EP SP 或 Enptrpass 的人士，可为自己的配偶及 21 岁以下小孩申请的一种准证。持家属准证的小孩，可直接入学新加坡政府中小学。</p><p>薪水：担保人固定月薪薪水需达到 5,000 新币以上。（2018 年 1 月 1 日起至少达到 6000 新币以上）。</p><p>工作：EP 或创业准证家属，可通过公司向人力部申请新加坡工作的凭证 LOC（Letter of consent），批准后，可直接工作（不占用公司配额）。SP 家属准证，需申请工作准证后才能工作。家属准证（DP）持有人申请到工作准证（EP 或 SP）后需取消 DP，SP 家属取得的工作准证有效期与 SP 持有人准证有效期相关。</p><h3 id="Long-Term-Visit-Pass-长期探访准证（LTVP）"><a href="#Long-Term-Visit-Pass-长期探访准证（LTVP）" class="headerlink" title="Long Term Visit Pass 长期探访准证（LTVP）"></a>Long Term Visit Pass 长期探访准证（LTVP）</h3><p>长期探访准证，是新加坡政府颁发的一种可以在新加坡长期居住的准证，期限从半年到十年不等。其中新加坡公民的配偶又可以申请获得 LTVP+。目前的审批部门有两个，一个是 ICA 移民厅，一个是 MOM 人力部。</p><p>需要去移民厅申请的：</p><ol><li>新加坡公民的配偶<br>2.PR 的配偶</li><li>新加坡公民 / PR 未满 21 周岁的小孩</li><li>新加坡公民 / 21 周岁以上 PR 的父母</li><li>寻求在新加坡工作的有关高校毕业生</li><li>小孩 / 孙辈在新加坡持学生准证读书的母亲或外祖母</li><li>寻求准许在新加坡分娩者</li></ol><p>新加坡移民局网址<br><a href="https://www.ica.gov.sg/" target="_blank" rel="noopener">https://www.ica.gov.sg/</a></p><p>需要去人力部申请的：</p><ol><li>EP/SP 准证持有者的配偶（2018 年 1 月 1 日起至少 6000 新币）</li><li>EP/SP 准证持有者未满 21 周岁的未婚残疾子女（2018 年 1 月 1 日起至少 6000 新币）</li><li>EP/SP 准证持有者未满 21 周岁的未婚继子女（2018 年 1 月 1 日起至少 6000 新币）</li><li>EP/SP 准证持有者的父母（2018 年 1 月 1 日起至少 12000 新币）</li><li>Entrepass（创业准证）的父母</li></ol><p>新加坡人力部网址：<br><a href="https://www.mom.gov.sg/" target="_blank" rel="noopener">https://www.mom.gov.sg/</a></p><h2 id="新加坡重要电话"><a href="#新加坡重要电话" class="headerlink" title="新加坡重要电话"></a>新加坡重要电话</h2><p>报警：999<br>火警和救护车：995<br>海关：6355 2000<br>中国驻新加坡大使馆：6471 2117（证件咨询）<br>中国银行：6439 8741（汇款业务）<br>中央医院：6222 3322<br>樟宜医院：6788 8833<br>德士电话：6552 1111 / 6363 6888 / 67780808<br>新加坡人力部：6438 5122<br>新加坡税务局（个人）：1800 356 8300<br>新加坡海关：6355 2000<br>新加坡建屋局：6490 1111<br>新加坡移民局：6391 6100</p><h2 id="新加坡公共假期"><a href="#新加坡公共假期" class="headerlink" title="新加坡公共假期"></a>新加坡公共假期</h2><p><a href="https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch/public_holidays.html" target="_blank" rel="noopener">https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch/public_holidays.html</a></p><h2 id="新加坡通讯指南"><a href="#新加坡通讯指南" class="headerlink" title="新加坡通讯指南"></a>新加坡通讯指南</h2><p>国内的手机大部分都可以在新加坡直接换卡使用，除非你的手机是中国移动 4G 定制版本，由于网络制式的区别，无法使用新加坡 4G 网络，新加坡目前 2G 网络停止服务。</p><blockquote><p>小贴士：建议使用全网通手机，去国外任何地方都可以直接换卡使用。</p></blockquote><p>运营商：新电信（Singtel）、星河（Starhub）和 M1（Mobile One）</p><p>在新加坡机场、邮局、7-11 便利店和代理商都可以购买和充值电话卡，记得一定要带上护照，新加坡的手机卡采用实名制。推荐大家下载所用运营商的 App，查询和购买话费、流量等。</p><ol><li>新电信（Singtel）: 新加坡最大电信公司，使用人数最多，信号强。</li></ol><p>流量：10 新币可以购买 1GB，30 天之内使用。20 新币可以购买 3GB，30 天之内使用。</p><p>查询话费：<em>139#  查询流量: </em>139<em>3#  订购流量：</em>363</p><p>拨打国内电话：如拨打国内电话，请在拨打国内手机号之前加拨 01986，可节省部分话费；若拨打国内固定电话，请先拨打 01986，再拨打区号（去掉前面第一个 0）和固话号码。</p><p>详情请参考官网：<a href="https://www.singtel.com/" target="_blank" rel="noopener">https://www.singtel.com/</a></p><ol start="2"><li>星河（Starhub）：电话费用经济实惠。流量的价格和新电信基本一致。</li></ol><p>查询话费：<em>131#  查询流量: </em>123<em>300#  订购流量：</em>123*</p><p>拨打国内电话：如拨打国内电话，请在拨打国内手机号之前加拨 01886，可节省部分话费；若拨打国内固定电话，请先拨打 01886，再拨打区号（去掉前面第一个 0）和固话号码。</p><p>详情请参考官网：<a href="http://www.starhub.com/" target="_blank" rel="noopener">http://www.starhub.com/</a></p><p>3.M1(Mobile One): 电话费用和流量价格与新电信基本一致。</p><p>查询话费：拨打 1267  订购流量：#100<em>7#  查询流量:#100</em>2#</p><p>如拨打国内长途电话，请在拨打国内手机号之前加拨 02186，可节省部分话费；若拨打国内固定电话，请先拨打 02186，再拨打区号（去掉前面第一个 0）和固话号码。</p><p>详情请参考官网：<a href="https://www.m1.com.sg" target="_blank" rel="noopener">https://www.m1.com.sg</a></p><p>4.Circles.Life: The Best No-Contract Mobile Plan</p><p>详情请参考官网：<a href="https://pages.circles.life/" target="_blank" rel="noopener">https://pages.circles.life/</a></p><p>5.Zero1: No data cap. No excess data charges ever! $29.99 Unlimited Data* mobile plan</p><p>详情请参考官网：<a href="https://zero1.sg/" target="_blank" rel="noopener">https://zero1.sg/</a></p><h2 id="新加坡交通指南"><a href="#新加坡交通指南" class="headerlink" title="新加坡交通指南"></a>新加坡交通指南</h2><p>新加坡主要交通出行方式：地铁（MRT）、轻轨（LRT）、巴士（Bus）和德士（Taxi）。</p><p>其中地铁（MRT）是新加坡最便捷的交通工具，也是日常最佳的出行方式。根据官方 2017 年 1 月份提供的最新信息显示，全岛共设有 142 个车站，目前主要的运营线中，南北运营线以 “NS” 红线标明，东西运营线以 “EW” 绿线标明，东北运营线以 “NE” 紫线标明，环线以 “CC” 黄线标明，市区运营线以 “DT” 蓝线。</p><p><img src="http://ws2.sinaimg.cn/large/7207510dgy1ftu6uc735wj215o0xp48v.jpg" alt="新加坡地铁图"></p><p>新加坡地铁图</p><p><a href="https://exploresg.com/ditie/" target="_blank" rel="noopener">https://exploresg.com/ditie/</a></p><p>新加坡地铁和巴士车 (站) 内规定</p><ol><li>不可吃喝、吸烟、携带榴莲、大声喧哗和带宠物 </li><li>Bus 不报站、上下车需要刷卡</li></ol><p>温馨提示</p><ol><li>地铁和巴士上冷气很足，建议携带薄外套</li><li>在 20 分钟内，地铁和巴士之间转换，车资有优惠</li><li>在地铁或者商场等使用扶梯时，左侧是站立侧，右侧是快速通道</li></ol><h2 id="新加坡房屋指南"><a href="#新加坡房屋指南" class="headerlink" title="新加坡房屋指南"></a>新加坡房屋指南</h2><blockquote><p>组屋(HDB)</p></blockquote><p>新加坡的“组屋”，全称为组合房屋。由新加坡建屋发展局（HDB）不以盈利为目的承担建筑的楼房，为大部分新加坡人（80%）的住所。</p><p>组屋一般分为三房式、四房式和五房式。三房式指一厅两房，使用面积约 60 平方米；四房式是一厅三房，使用面积约 90 平方米；五房式是两厅三房，使用面积大致在 110 平方米。</p><p>组屋的区分都是按照地区名 + 数字，例如：PasirRis Block 186（巴西立大牌 186）、YishunBlock 210（义顺大牌 210）等。</p><p>屋内客厅，厨房，卫生间都是公用设施，一般会配备冰箱，洗衣机，空调或者风扇。</p><p>租房费用（一般情况下）：</p><p>新型组屋 (近 10 年内建成的) 相对条件会好很多 (平均价格 S$1000-1200 / 间)<br>单人单间：500-1000 新币<br>二人间：350-550 新币 / 人<br>四人间：270-350 新币 / 人</p><p><strong> 小贴士 </strong></p><ol><li>新加坡政府规定租住的房子必须要能在建屋局上注册。正常情况下，注册要求至少住 6 个月。如果不能注册，就是不合法的房屋。</li><li>如果退租，一定要提前一月声明，以防押金不退。</li><li>仔细看合同，仔细看合同，仔细看合同。</li></ol><blockquote><p>私人公寓(Condo)</p></blockquote><p>公寓，常见两房式或三房式，相当于国内的高档成熟社区，内有免费游泳池、健身房，BBQ 等公共设施，住宿环境相对较好，价格也相对高一些；大部分的 condo 房间都有主人房与非主人房之分，主人房有自己独立的洗手间和相对宽敞的卧室，当然价格也比非主人房高 200-300 / 月(非主人房平均价格<br>S$1,000-1,500 / 间 / 月)</p><blockquote><p>排屋(Terrace)</p></blockquote><p>独门不独栋的联排别墅，此类出租房源相对较少，住宿环境、价格与房子位置、条件有相当大的关系。</p><blockquote><p>独栋别墅(Landedproperty)</p></blockquote><p>少见于房间出租。</p><h2 id="租房"><a href="#租房" class="headerlink" title="租房"></a>租房</h2><blockquote><p>如果英语不是太差，不推荐狮城 BBS 或者微博租房，如果你有认识的新加坡房产中介自然是最佳选择</p></blockquote><p>Property Guru - <a href="http://www.propertyguru.com.sg/" target="_blank" rel="noopener">http://www.propertyguru.com.sg/</a></p><p>新加坡本地发布平台，房源多。使用下来感觉 Property Guru 信息发布是最多的，信息筛选条件多，容易搜索到希望的房源。多为中介发布，有中介费。</p><p>Nestia - <a href="https://www.nestia.com/" target="_blank" rel="noopener">https://www.nestia.com/</a></p><p>新加坡本地发布平台，功能强。Nestia 上的房源也比较多，但感觉不如 Property Guru。不过 Nestia 可以以某一建筑（公司地址）为中心从远及近的搜索房源。找步行距离的房源就很合适了。另外自带的导航也不错。所以我是 Property Guru 和 Nestia 结合使用。</p><p>99.co - <a href="https://www.99.co/" target="_blank" rel="noopener">https://www.99.co/</a></p><p>新加坡本地发布平台，平台新。和上面两个相比算是一个比较新的平台，数据没有 Property Guru 多但是针对房屋本身的介绍更加详细，房源信息相对真实。</p><p>在新加坡租房，有哪些经验可以分享？<br><a href="https://www.zhihu.com/question/22430961" target="_blank" rel="noopener">https://www.zhihu.com/question/22430961</a></p><h2 id="在新加坡买房与中国有何不同？"><a href="#在新加坡买房与中国有何不同？" class="headerlink" title="在新加坡买房与中国有何不同？"></a>在新加坡买房与中国有何不同？</h2><blockquote><p>无论在中国还是新加坡买房前后都记得关注下政策上的变化</p></blockquote><p><img src="https://ws4.sinaimg.cn/large/7207510dgy1fuwkom9kljj20u00i30u7.jpg" alt=""></p><p>① 面积</p><p>说到面积，首先让中国买家摸不着头脑的，就是面积单位的换算。中国买家习惯用平方米（也称平方公尺）计算面积，来新加坡选购房子时听到的都是平方英尺，往往脑子得转一圈才知道个大概。1 平方米约等于 10.8 平方英尺。100 平方米就是 1080 平方英尺。</p><p>除了计算单位不同，“面积”一词在两地公寓市场上的定义也不一样。在中国，面积指的是建筑面积；新加坡算的是实用面积。建筑面积的算法比较繁琐。简单来讲，是根据各套房屋的套内建筑面积，求得各套房屋分摊所得的共有建筑分摊面积，比如门口的面积、楼梯等，都按比例算进每一个单位的建筑面积。</p><p>所以，同一个公寓单位，其建筑面积一定会大于实用面积，通常后者比前者少 20％左右。在中国买一个 “100 平方米” 的单位，和在新加坡买一个“1080 平方英尺”（相当于 100 平方米）相比，后者明显感觉宽敞一点，就是这个道理。</p><p>② 地契</p><p>中国的房产地契通常是 70 年左右，而新加坡的则有 99 年、999 年和永久地契之分。新加坡的房产因为地契年限长，颇受外籍人士青睐。其中，永久地契的房产一般要比 99 年地契的贵 20％。尽管如此，永久地契一直很抢手，也深受中国买家欢迎，因为买家看准这块市场的保值与增值。</p><p>这其中很大程度上因为新加坡的地皮比较少，想要建新楼必须拆掉现有的建筑。不像中国地皮比较多，还有可开发的地段。新加坡永久地契的地段价值比较高，所以如果进行集体出售、或是被政府征用的话，永久地契房地产的房主会可得到较高的补偿。</p><p>物以稀为贵，永久地契房产越是少见，也就越炙手可热。此外，永久地契对中国买家还有另一大吸引力，那就是永久地契满足了 “总觉得要给后代留下点什么” 的传统华人心愿。所以说，新加坡房产能如此吸引外国买家，与地契久脱不了关系。</p><p>③ 贷款</p><p>在新加坡首次购房的买家，可向金融机构贷款的房贷比率顶限为 80％，外籍人士一般则最高 70％。在中国，外国人一般不能向本土中国银行贷款，只能通过外资银行或中国银行境外支行。</p><p>原本新加坡和中国在房贷比率顶限方面有很大差别。不过两国都不断调整房贷比率顶限，因此两国的房贷比率顶限差别已缩小。</p><p>④ 税收</p><p>在新加坡，如果在一定期限里卖掉公寓，卖家需要上缴印花税。在 2011 年 1 月 14 日过后买房的购屋者，只要在四年内卖房屋都需要支付卖方印花税，第一、二、三和四年卖掉房产的税率分别是 16％、12％、8％和 4％。此后就不必上缴卖家印花税。</p><p>在中国，除了印花税外，还需要上缴增值税。为了给中国房地产市场降温，中国政府在 2013 年实施 20％的房地产买卖增值税。所谓增值税，就是对卖家卖房所得的利润征收的税。譬如，150 万人民币买的房子在几年后以 200 万人民币卖掉，卖家所赚得的 50 万就将需要以一定的比率交税。</p><p>⑤ 车位</p><p>在中国购买中高档住宅，需要另外购买车位。而在新加坡，买家不需要另付车位费，发展商一般会为每个新单位赠送一个车位。可不能小瞧这个车位费。近年来，车位费在中国节节攀升，动辄十几、二十万人民币，是一笔不小的开销。</p><p>新加坡私人公寓不收车位费，而是将停车场的修建和维护等费用，包括在每月的项目管理费之中。管理费除了车库，还包括游泳池、健身房等设施，每月一般是几百元新元。如果每月的管理费是 300 元新元（约 1400 元人民币），一年就是 1 万 7000 元人民币，15 年刚好是 25 万 5000 元人民币。总体来讲，这要比中国的车位 “划算” 得多。</p><h2 id="新加坡医疗指南"><a href="#新加坡医疗指南" class="headerlink" title="新加坡医疗指南"></a>新加坡医疗指南</h2><p>新加坡是一个热带国家，从国内刚过去有可能因水土不服引起的伤风、感冒、皮肤敏感或蚊虫叮咬等。出行之前可以带一些三九胃泰、牛黄解毒等日常药品之类的药品，防范于未然是最好的。</p><p>看医生：在新加坡持有工作签证，所在的公司会按照新加坡劳工部规定给每位员工会购买医疗保险或者费用报销。</p><p>医疗保险：一般是三种模式</p><ol><li>直接去合作门诊，提供公司信息，看病不用自己拿钱。</li><li>直接去合作门诊，提供公司信息，看病前给门诊 5 新币（每个公司不一样），其它的费用不用自己拿。</li><li>直接去合作门诊，自己先付产生的费用，然后去公司报销。意外伤害险等（视公司合同规定）。</li></ol><h2 id="公立和私立医疗服务"><a href="#公立和私立医疗服务" class="headerlink" title="公立和私立医疗服务"></a>公立和私立医疗服务</h2><blockquote><p>中国人在新加坡看病就好比外国人在中国看病一样不是很方便，价格不便宜，小病也有可能看成大病</p></blockquote><p>新加坡的医疗服务体系以优质高效著称，选择面广, 综合医院，专科医院，私人诊所遍布全国, 随处可见；不仅为全新加坡的公民，永久居民，外籍工作人士提供服务，同时周边国家的高端人群, 包括东南亚、亚洲、欧洲、中东阿拉伯等国家的病患都会将新加坡的国际医疗服务作为他们的首选。</p><p>新加坡的公立医疗机构和私立医疗机构在整个医疗系统中扮演着不同的角色。基础医疗门诊 80% 由私立医疗机构 / 家庭医生诊所提供，另外 20% 则是由政府综合诊疗所提供；而综合医疗，包括各类科室的住院，专科和 24 小时急诊主要由公立医疗机构提供，占 80% 的比例，剩下的 20% 由私立医疗机构提供。由于政府的有效规划和管控，公立医院和私立医院相辅相成, 缺一不可。</p><p>在公立医疗机构就诊一般都需要提前预约, 候诊时间较长, 也不能自由选择医生。由于那里的医生要面对更多的患者, 为每个患者服务的时间相对较短；而私立医疗机构由于患者相对较少, 不需要预约, 候诊时间较短，还可以自己选择医生，医生也能与患者作更多的交流, 提供更细致的服务，收费就相应高一些。</p><p>一些新加坡的公立医院也为自费病人提供高端医疗服务, 设有针对性的部门和项目, 如体检，会诊，专科治疗等。基础的检查和服务, 公立医院比私立医院收费较低；对于外籍人士和高端的服务项目, 公立和私立医院的收费差异不大。</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTQxODUxNw==&amp;mid=2650871863&amp;idx=3&amp;sn=b9536c73a1b6a0e0ed02019598d75c35&amp;chksm=8d1b8a4dba6c035b898a133fdf30ec613eb6826a0f4a66d5befe6364a04e24fb6bde9a981ce7&amp;scene=21" target="_blank" rel="noopener">8 家新加坡著名的公立和私立医院</a></p><h2 id="货币兑换和汇款"><a href="#货币兑换和汇款" class="headerlink" title="货币兑换和汇款"></a>货币兑换和汇款</h2><blockquote><p>如果时间宽裕，推荐走新加坡工商银行渠道</p></blockquote><p>新加坡实行货币开放政策，货币兑换中心随处可见，尤其是在牛车水 (China Town) 附近。如有汇款需求到国内，可以先去牛车水汇款 (珍珠坊二楼)，方便快捷。等周围熟悉后，推荐去淡宾尼(Tampines) 汇款到国内，汇率会比其它地方高一些。具体的地方，在地图搜索 Tampines Money Exchange Center。 </p><p>小贴士：汇款中心一般可以汇到中国邮政、中国农业、中国交通、中国招商和中国银行等。第一次汇钱到国内，当填写汇款单据的时候一定要知道对方银行卡是在 <strong> 省 </strong> 市 ** 银行支行开户的(很重要)。</p><h2 id="法律法规"><a href="#法律法规" class="headerlink" title="法律法规"></a>法律法规</h2><p>新加坡向来是给世人展示优美环境，井然秩序，舒适安全的名片，然而这些美好的展现离不开新加坡法律制度的约束和规范。Singaporeis a“fine”country 完整的诠释了这两方面。所以在新加坡生活，你需要注意以下细节：</p><ol><li>自动排队：公共场合最经常听到的一句话就是 please queue！</li><li>着装：不同场合穿不同衣服, 建议每天换衣服。</li><li>公共习惯：乘坐公共交通或者在公共场合用餐时, 切忌大声喧哗, 不然你一样会被当做异类奥! 而且记得再饿也要撑到下车再用餐。</li><li>言论：新加坡是多文化和宗教融合的国家, 公共场合不要发表敏感政治言论或者宗教话题, 这也体现互相尊重。</li><li>不当行为：竖中指可能会被当做种族歧视处理的</li><li>如厕：来也匆匆, 去也冲冲。如若不然请准备 500 新币吧。</li><li>口香糖：公共场所不允许嚼口香糖, 不可以随意买卖, 允许带少量入境, 正是这个奇葩的规定维护了公共环境的整洁。</li><li>吸烟：新加坡公共场所绝对禁烟。如若吸烟不幸被抓到, 恭喜你一个月的工资 (高达 2000 新币) 为国家做贡献了!</li><li>垃圾：乱丢垃圾初犯者将处高达 1000 新币罚款, 再犯者将罚款额提高至 2000 新币以及在劳改法令下受罚。</li><li>交通规则：闯红灯, 随便乱穿马路这些不多啰嗦。违反的是规则, 伤害的是人身安全, 因为小编也感觉马路上的车如同闪电般行驶。</li><li>不可非法聚会和使用暴力</li></ol><p>以上内容是提醒大家在生活细节方面应遵守的规则, 但有些行为未必就可以罚款结案的, 比如: 签证到期后逾期逗留、抢劫、公共场所涂鸦、纵火、携带毒品等这些可都是在鞭刑的定罪范围内的。</p><p><strong> 最后郑重的提醒各位：</strong> 在机场不要发扬助人为乐精神帮陌生人携带物品, 因为很有可能你同时把生命交给了别人(运输毒品和贩毒同罪)。</p><h2 id="工作准证遗失如何处理"><a href="#工作准证遗失如何处理" class="headerlink" title="工作准证遗失如何处理"></a>工作准证遗失如何处理</h2><ol><li>发现丢失后立即携带护照或者工作准证的复印件到任何一间警察局报案，记得保存报案记录原件。</li><li>通知雇主公司 HR, 让其在 7 天之内在新加坡人力部网上提交补办工作准证的申请。</li><li>费用: 首次补办 100 新币, 第二次是 300 新币(一般在提交申请补办 4 个工作日可去新卡)</li></ol><h2 id="银行卡遗失如何处理"><a href="#银行卡遗失如何处理" class="headerlink" title="银行卡遗失如何处理"></a>银行卡遗失如何处理</h2><ol><li>发现遗失后立即拨打银行客户服务中心热线挂失</li><li>银行客户专员会核对护照和工作准证信息, 然后等待新卡邮寄到住处或者去支行直接领取。</li></ol><p>POSB 用户请拨打 18003396963<br>DBS 用户请拨打 18001111111<br>UOB 用户请拨打 18002222121<br>OCBC 用户请拨打 18003633333</p><h2 id="护照遗失如何处理"><a href="#护照遗失如何处理" class="headerlink" title="护照遗失如何处理"></a>护照遗失如何处理</h2><p>如护照遗失或被盗, 请立即到中国驻新加坡大使馆如实填写《护照遗失陈述表》，提供关于护照遗失或被盗的情况说明, 以及提供报警记录原件及复印件。如护照损毁, 请提交损毁的护照, 以及护照损毁的原因说明。</p><p>具体的更换护照和网上预约等等详细流程请参考大使馆的官网：<a href="http://www.chinaembassy.org.sg/chn/" target="_blank" rel="noopener">http://www.chinaembassy.org.sg/chn/</a></p><p>中国驻新加坡大使馆信息:</p><p>地址: 150 TANGLIN ROAD,SINGAPORE 247969</p><p>领事部：64712117；92971517(仅限紧急领保求助, 不接受证件咨询)</p><p>Email: <a href="mailto:chinaemb_sg@mfa.gov.cn" target="_blank" rel="noopener">chinaemb_sg@mfa.gov.cn</a></p><p>办公时间：周一至周五(节假日除外)</p><p>上午 9:00-11:30</p><h2 id="新加坡日常-App-推荐"><a href="#新加坡日常-App-推荐" class="headerlink" title="新加坡日常 App 推荐"></a>新加坡日常 App 推荐</h2><blockquote><p>如果是 Android 记得安装 Google 框架，如果是 iOS 记得调整更改 Apple ID 国家或地区</p></blockquote><p>交通: Grab(类似国内滴滴)、Google Map(谷歌地图)、SG Buses(公交时刻表)、Mobike（摩拜单车国内账户通用）</p><p>社交: Facebook、WhatsApp、Twitter、Instagram</p><p>购物: Shopee、Lazada、eBay、Amazon、淘宝国际、京东国际、网易考拉、网易严选、小米有品</p><p>娱乐: Youtube(视频必备)、 Golden Village(电影院)、CATHAY (电影院)</p><p>快递: 小坡岛集运、淘宝直送 / 集运</p><p>特别推荐: Zero1(9.9 每月无限流量手机卡)、SG BusLeh(更好用的公交时刻表)、eatigo(开启新加坡美食 5 折之旅)</p><h2 id="新加坡父母签证"><a href="#新加坡父母签证" class="headerlink" title="新加坡父母签证"></a>新加坡父母签证</h2><blockquote><p>网上找到的，忘记出处了，如果有错误描述请及时指正</p></blockquote><p>本人 PR，老婆七月份预产期。打算让父母 6 月中旬来。计划步骤如下:<br>1, 先买往返机票（返程可更改的）。<br>=== 对的。<br>2,5 月份申请父母旅游签证。<br>=== 旅游签证可提前一个月内申请，有效期多数 63 天，也有一年，两年，非固定。有效期内入境即可。<br>3, 父母来新后申请延期至 89 天。<br>=== 对的。<br>4, 同时申请 LTVP。<br>=== 也没错。<br>5, 悲剧后申诉。<br>=== 步骤没错。<br>请指点一下按这样做有什么不拖吗？<br>=== 有什么不妥是吧？没什么不妥的，如果觉得自己条件还可以，就可以早点安排申请 LTVP，如果觉得条件比较牵强，可以晚一点入境，晚一点延期，晚一点申请 ltvp，争取在月子后多待一点时间帮你们带孩子。<br>可以现在就申请旅行签证吗?<br>=== 提前一个月内申请，一个月内，内。<br>旅行签证有效期多久? 一年多次吗？<br>=== 上面已经回答了。<br>申请 LTVP 必须人在新加坡吗？<br>=== 是的。必须入境后申请。</p><p><a href="https://www.ica.gov.sg/" target="_blank" rel="noopener">https://www.ica.gov.sg/</a></p><h2 id="新加坡公民-永久居民-外国人的区别"><a href="#新加坡公民-永久居民-外国人的区别" class="headerlink" title="新加坡公民 / 永久居民 / 外国人的区别"></a>新加坡公民 / 永久居民 / 外国人的区别</h2><blockquote><p>我们大多数人的起点是外国人，这点与国内的户口制度类似，无论是中国还是新加坡始终绕不开买房和教育这两座大山</p></blockquote><p><img src="http://wx1.sinaimg.cn/large/7207510dgy1fv25ybdomqj21su0qiwqe.jpg" alt=""></p><p><a href="https://docs.qq.com/sheet/B80RhZ2ZATLC0ge3Bi2bLYpr2iY5PC1nE3031LWRcK1rTcgj0Z2bvD00bDO63Ie3tz2ovOwW4" target="_blank" rel="noopener">如果发现表有错误请点击链接申请编辑更新，谢谢</a></p><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1536138012&amp;ver=1103&amp;signature=U5rEy0vZxyGNd99XCCQFreqj1TkqV2e5W-GuVcfIHz4b3klt7QCXNiwbCSHVa0QxM2Bc0pn5fXO44or4CGNAN4g2O56e5TeE0H4pocnQWpgNuw4uRR8KYQjMrhc5nQNe&amp;new=1" target="_blank" rel="noopener">吐血整理！如何在网上申请新加坡 PR 和公民最强攻略！收藏~</a></p><h2 id="个人经验"><a href="#个人经验" class="headerlink" title="个人经验"></a>个人经验</h2><blockquote><p>选择新加坡的理由：给自己多一种选择</p></blockquote><ul><li>MOM: Ministry of Manpower</li><li>IPA: In-Principle Approval</li><li>EP: Employment Pass 人才准证</li><li>DP: Dependant’s Pass 家属准证</li><li>PR: Singapore Permanent Resident 新加坡永久居民</li><li>SC: Singapore Citizen 新加坡公民</li><li>HDB: Housing &amp; Development 政府组屋</li><li>Condo: 私人公寓</li><li>Food Court: 食阁</li><li>CPF: 公积金</li><li>NUS: National University of Singapore 新加坡国立大学</li><li>NTU: Nanyang Technological University 新加坡南洋理工大学</li></ul><ol><li>原始坐标：上海，无留学经验也没有去过新加坡</li><li>猎头推荐新加坡的职位，想想自己那被遗忘的蹩脚英语抱着试一试的心态</li><li>一共 3 轮 Skype 远程视频面试，约 4 周时间到最后确认 offer</li><li>约 1 天时间思考，离职申请，签电子合同</li><li>检查护照有效期，下载学信网英文翻译认证，由 HR 帮助提交申请 EP，约 3 周内收到 IPA</li><li>在上海户口所在区公证处办理结婚证公证翻译，约 3 周时间完成，又慢又麻烦</li><li>完成 EP 后由 HR 帮助提交申请 DP，约 1 周内收到 IPA</li><li>购买机票，打印 IPA，带上护照，打包行李，兑换 4000 新币，确认人事档案存放地址，选择不缴纳每月养老保险和医疗保险约 1500 元人民币(可由父母代缴，中断非连续缴纳暂时不影响回国养老，以政策变化为准)</li><li>飞机上填写好新加坡入境卡，完成入境登记，无需录入指纹，开启华为天际通</li><li>抵达公司提前安排好的住址，熟悉新加坡环境</li><li>办理 EZ-Link 交通卡和 Singtel Prepaid 手机卡(如果没有强需求可以暂时不办理)</li><li>公司 HR 提交 EP 现场办理申请，收到邮件后预约 MOM 办理时间（我没有被要求体检，根据不同公司情况而定）</li><li>约 1 周后收到 EP 绿色实体卡，使用 SGWorkPass 扫描保存照片，注册 SingPass 后约 1 周左右收到密码信封</li><li>公司开具证明办理银行卡，新加坡本地我选择 UOB(保持 1000 新币存款)，另外强烈推荐再办理工商银行卡(持卡 0 门槛，转账回国 0 费用)</li><li>网上申请 Zero1 的无限流量手机卡，约 3 个工作日收到直接使用，弃用 Singtel Prepaid（浪费了 25 新币）</li><li>新加坡日常消费以现金为主，我本人习惯手机支付无奈降级至刷信用卡阶段(持有浦发 AE 白 / Visa/Master)，怀念下国内的支付宝和微信</li></ol><p>我刚来新加坡 1 个多月，不用担心语言不通，大部分人都会说华语。新加坡真的不算大，地铁和公交都很方便，空气质量很好至少我的鼻炎消失了，天气没有国内那么热，居然没有蚊子，没有蚊子，没有蚊子。在这段时间里我幸运了结识了交大和复旦的校友，跟随专业的中介实地考察了新加坡的租房和买房市场，走遍了几个重要的核心区域，顺便吃了几顿亲民的米其林一星。之后我应该还会继续更新自己在新加坡的经历，比如健身、快递、看病等日常生活，希望对大家有所帮助。</p><h3 id="新加坡-3-个月感想"><a href="#新加坡-3-个月感想" class="headerlink" title="新加坡 3 个月感想"></a>新加坡 3 个月感想</h3><blockquote><p>咋们就从最传统的衣食住行说起吧</p></blockquote><p><strong> 衣 </strong></p><p>因为新加坡全年都是夏季，平时的正常温度基本在 30° 上下，对于我来说已经把家里的夏装的家底全部带过来了，所以也没有什么特别需要单独购买，作为男生如果以后缺衣服的话在新加坡线下就是优衣库，线上还是优衣库。</p><p>女生的选择实在太多了，乌节路和 VivoCity 等都可以逛好久，这里就跳过吧</p><p>新加坡本地的 Outlet(奥特莱斯)是 IMM，如果你喜欢跑步运动，那么只卖 105 新币的 Asics GEL-Kayano 24 会有一定吸引力</p><p>在新加坡网购买衣服，和国内激烈竞争的胜出者相比，还有很长一段路要走，当然也证明东南亚市场是一块巨大的蛋糕等待挖掘</p><p>新加坡室内空调冷气普遍开得比较足，建议怕冷的同学多备件长袖外套在公司，长时间逛商场时注意冷热交替避免生病</p><p><strong> 食 </strong></p><p>新加坡最有特点的饮食文化莫过于食阁(Food Court)，其实有点类似于上海的大食代，但价格亲民而且还有米其林一星的神奇存在，平均一顿的价格区间在 3-7 新币，整体口味偏重。每个食阁上方都会标注 A/B/C 卫生评级，新加坡本地的习惯一般不在家做饭，大家都出去吃所以种类也还算多，不知道吃什么可以认准 Singapore Best Foods 红色标志，和国内相比关键是放心。</p><p>如果平时想吃顿大餐类似国内海底捞、小龙坎那种，平均每人大概 30-50 新币左右，评级更高的餐厅价格自然也水涨船高</p><p>自己在家做饭的成本其实和外面吃也差不了多少，如果居住的房子允许大炒和大煮当然可以选择自己动手丰衣足食</p><p>新加坡的菜市场比较少见可能是我没有刻意去寻找或者需求的缘故吧，买蔬菜和肉类基本都在 Sheng Siong(昇菘)，FairPrice(NTUC)，Cold Storage，喜欢日本食物还可以选择 DON DON DONKI，我个人很喜欢这只萌企鹅的魔性主题曲</p><p><a href="https://www.bilibili.com/video/av32078102" target="_blank" rel="noopener">https://www.bilibili.com/video/av32078102</a></p><p>新加坡的便利店清一色 7-Eleven，部分大一点的屈臣氏 (Watsons) 支持支付宝(Alipay)，上面提到的 Sheng Siong 已经全部支持 Alipay</p><p>外卖大家就不要指望 Foodpanda 有饿了么和美团外卖的速度了，老老实实去附近的食阁按时吃饭才是正道</p><p><strong> 住 </strong></p><p>(1) 租房</p><p>我在租房这个环节基本上算是跳过了，刚来时建议找好房源，这边的酒店居住成本很高的。因为目前是长租在公司提供的组屋 (HDB) 内，毕竟室友都是公司自己人很放心，合同限制不多每月会安排阿姨定期打扫和保养空调等，手机银行转账支付租金也方便。回想当时刚来的 1 个月每周都跟随专业的中介校友出去找房子都十分辛苦，更不要说自己联系中介一家一家看了，说多了都是泪。这边的房产中介需要考证，据说通过率只有 10-15%，每个中介都会展示唯一的证书编号，所以不用太担心被骗，不过每个中介的态度千差万别，找到靠谱的中介能够加快找房的速度。</p><p>由于地理位置和房屋面积质量差异，下面的租房价格仅仅是一个参考区间，数字单位为新币 / 月<br>组屋(HBD)，普通房 600-800，主人房 1000-1200，整租 1000+<br>公寓(Condo)，普通房 800-1500，主人房 1200-2000，整租 1500+</p><p>房源信息可以来自于同事，也可以自己在线挑选，方法我都写在前面了，和同事咨询过新加坡租房的大致流程</p><ol><li>看准自己喜欢的房子</li><li>看清楚合同，看清楚合同，看清楚合同，签约</li><li>签 1 年一般押一付一，签 2 年押二付一</li><li>中介费是根据实际情况由房东或者租客来承担，一般根据合约长短支付 0.5 或 1 个月的房租作为中介费</li></ol><p>(2) 买房</p><p>虽然是否决定买房的话题为时尚早，但经历了魔都十几年房地产的上涨自然也不会错过对新加坡房地产的研究，如果你是冲着 30w 新币的组屋 (HDB) 那么找新加坡本地人结婚是最快的途径。新加坡在 2018 年 07 月 06 日 0 点开始调整了印花税，对于我们普通人来说 2-3 年内拿到永久居民 (PR) 已然不易。新加坡私人公寓 (Condo) 的价格和质量相对国内来说是有优势的，但是 1 室 80w，2 室 100w，3 室 120w 这样的价格加上印花税还是会让我们感到一丢丢肉疼，好在房地产市场涨幅长期平稳且退出机制清晰，租房市场也足够活跃，而且银行可以贷款 7 成 + 2% 左右的低利率还是足以让我们拥有奋力一搏的勇气，不用牺牲 6 个钱包。</p><p><strong> 行 </strong></p><p>现在无论在哪里手机的使用比重都是极高的，我自己来新加坡前把小米 6 替换为华为 P20 Pro，妻子还是用的小米 MIX2，在国内早已习惯电信乐享家 199 元全国无限流量，我们的老卡 1 个是移动，1 个是联通，来到新加坡之后选择了无合约限制价格为 29.99 新币无限流量的虚拟运营商 Zero1.sg，因为背后是 Singtel 所以质量有保障。在新加坡接收国内短信验证码之类不要钱，双卡双待都是没有问题的，不过我妻子还是很期待 iPhone 即将推出的双卡功能，毕竟她在美国时的 iPhone5s 也用了 4 年多，被我硬生生拖入 Android 阵营实属不易。 </p><p>新加坡公共交通发达，Google Map 在手说走就走。我的选择和国内类似，能坐地铁尽量就不会选择公交车，因为坐公交车有几点不爽，如果你不熟悉新加坡或者不会熟练使用 Google Map 建议不要轻易乘坐公交车。</p><blockquote><p>乘坐地铁切记不可吃喝、吸烟、携带榴莲、大声喧哗和带宠物，乘坐公交车的规定与地铁类似但有以下额外注意事项</p></blockquote><ol><li>公交车来之前一定要招手才会停</li><li>在到达下一站前一定要按 Stop 红色停车按钮，不然不会停</li><li>下车时还要再刷一次交通卡确认付款</li></ol><p>除了公交车和国内差异较大以外，平时过马路记得按一下身边的指示灯，你不按或者对面也没人按，那你就不用想着过去了</p><p>这边的公交卡称为 EZ-Link，想刷 NFC 不好意思没有小米和华为，请购买 NFC SIM card。虽然充值很方便支持国内双币信用卡，但我还是很想念上海二维码扫码进闸机。另外新加坡地铁站没有安检，没有安检，没有安检。</p><p>我丢过一次地铁卡，为了挽回里面 25 新币我第一次主动走进新加坡警察局开具丢失证明，他们做事确实负责而高效，不过我因为操作失误导致旧卡数据没有正常转移到新卡，超过 7 天申报时间我也没有办法无力回天，所以再一次怀念下国内的手机刷卡。</p><p>新加坡已经遍布 Mobike 和 ofo，摩拜的国内账户可以在这里直接使用，ofo 需要重新注册。</p><p>新加坡打车市场已经被 Grab 一统江湖，Uber 和滴滴出行都入股 Grab，另外 Grab 打车很安全而且支持支付宝(Alipay)，普通出租车都支持微信和支付宝</p><p>关于机票从上海往返新加坡的航班很多，价格和飞行时间比较透明就不多说了，我这里还是推荐大家体验下新加坡航空 (Singapore Airlines) 的服务，今年航空公司评选又站回全球第一，即使乘坐经济舱也不要忘记品尝一下新加坡司令哈。</p><p>今年国庆节期间我和老婆买了新加坡至四川成都的 5 日往返机票，新加坡航空旗下的胜安航空(SilkAir)，令我感到惊喜的是 2 人机票往返价格总共才 1600 人民币。</p><p>新加坡拥车成本比较高，虽然公共交通发达，但是开车的梦想还是要有的，万一实现了呢？</p><p>新加坡和国内的体位不一样，行走避让和司机开车位置与国内正好相反</p><blockquote><p>传统的四大金刚扯完了，我们再聊一些逆转未来的话题</p></blockquote><p><strong> 安全 </strong></p><p>新加坡的安全本质上是基于严格的法律加上遍布各地的摄像头，你如果想挑战下不如先了解下鞭刑的酸爽和罚款罚到你肉疼的数字。</p><p>吸烟，喝酒，乱扔垃圾在法律中都有明确要求，虽然不能百分百杜绝抽烟现象，但你走在马路上不会遇到随意吐痰也不需要提防狗屎。穿过十字路口车辆都会早早的自觉停下来等你先过去，新加坡随处可见的就是无障碍设施，地铁沿线基本都设置了棚顶，既可以防晒又可以躲雨，即便每天都能遇到短时暴雨由于出色的排水系统也从来不会看到有积水。</p><p>在国内随时会收到的垃圾短信和房产金融中介等骚扰电话，在新加坡基本是看不到的，不过 Email 和 WhatsApp 这种网络骚扰还是无法消灭的。这边的违法成本比较高只要被投诉就会收到法律的严格制裁，当然注意保护自己的隐私安全始终不能掉以轻心，毕竟再文明的社会偶尔也会遇上小人。</p><p>在新加坡你基本不用担心丢失物品，因为大概率都能找回来，包包也不用刻意放在前面，拉链忘记拉上也没关系，不用担心人口贩子和小孩走丢，更不用担心一个人走夜路会不会不安全，犯罪成本高促成的低犯罪率给你带来的不仅仅是安全感更是幸福感。</p><p>由于新加坡的地理位置极好，无论是过去还是未来基本是不会受到任何灾难气候影响，台风、海啸或者地震是不存在的</p><p>新加坡的人际关系相对简单，与人为善的过程中也不要忘记多留个心眼谨慎一些，在这边和他人发生误会大多数都会听到 Sorry 和 I am fine 而不是争吵，规规矩矩排队而很少有人随意插队，政府办事效率高以廉洁著称也是难能可贵，在新加坡未必有国内这么亲切有人情味，但你能感受到的是相对的公平和简单。</p><p><strong> 健康 </strong></p><p>我在上海的时候就饱受着变态反应性鼻炎的痛苦，每次体检医生都开玩笑要不住到外环去吧，没想到现在离家这么远。至少来新加坡后我的鼻子就彻底舒畅了，我原来对空气质量也不以为然，买个小米净化器放在家里，直到离开上海前看见基因检测报告提醒风险最高的是鼻咽癌，我才明白空气对于每个人的未来都是如此重要。</p><p>新加坡的温度常年保持在 30° 上下，不会像上海夏季烈日炎炎，但新加坡比较像“蓝天白云 晴空万里 突然暴风雨”，有云有风有遮雨棚，身体其实会觉得很舒服.</p><p>之前已经说过新加坡的饮食文化以食阁 (Food Court) 为主，这些小店很多都有几十年的历史，食物未必都符合你的胃口但至少足够安全，不用担心地沟油。合理的饮食搭配以及规律的生活节奏才是根本。</p><p>新加坡本地人都注重健身，如果不想花太多钱在健身房可以考虑在小区附近的体育馆免费跑步或者花费 1.3 新币游泳。私人公寓 (Condo) 一般自带小型游泳池和健身房，虽然小但有总比没有好。如果公司有补贴健身房的价格 (一般 150-200 新币每月) 其实也不算太贵，每月 99 新币可以选择像 Fitness First or Pure Fitness(Pure Yoga)等专业健身房。</p><p>关于看病，因为前段时间工作比较忙抵抗力突然下降导致出现额头皮肤红肿，在国内经历过不注意小病而酿成大病的惨痛教训，<a href="https://wsgzao.github.io/post/wisdom-tooth/">我是如何做到花 8000 元拔智齿的</a>，所以这次特地请 1 天病假去公司合作的 Raffles Medical 私人诊所看病，事后看诊断结果比较准确且看病过程十分高科技 + 高效率，病因是 <code>带状疱疹</code>，总共 99 新币，30 是问诊费其余都是买药钱。只不过第二天我发现未有起色且眼皮红肿都快睁不开了就先让昨天的医生开具的急症介绍信，然后直奔 Raffles Hospital，在了解基本无大碍和每位专科医生复查至少 300 新币起步的情况下果断申请放弃继续治疗赶紧溜回去休养生息，这一趟花了 199 新币，其中 130 为问诊费(节假日看病费用翻翻)。命固然重要，但人只要一生病真的可能失去一切甚至连累家人。</p><p>和同事回顾了他们看病的流程，作为外国人一般也是建议直接去附近的私人医院，价格其实差不多但不用排队。如果选择去政府医院比如 NUH 等可能存在排队现象，这个体验对于国内看病来说大家心里应该很明白有多痛苦，如果各位有足额的医疗保险在国内其实可以选择特需医疗(免排队 + 专家门诊)。关于新加坡医院的更多信息可以参考最上面的介绍。</p><p>印尼 “烧芭” 引发空气污染和马来西亚动不动就拿断水挑事也是新加坡需要持续努力解决的问题之一。</p><p>新加坡的蔬菜和水果算不上贵但也不会像国内一样便宜，除了猫山王榴莲和部分进口水果质量和价格有优势，也没有太多的种类可供选择，我自己会从网易考拉购买 Swisse 作为补充，话说新加坡的营养品真心贵，同样的 Swisse 一小瓶卖 56 新币，其它品牌价格也是高居不下。</p><p><strong> 娱乐消费 </strong></p><p>新加坡本身就很小，加上我和我妻子都倾向于工作，学习和健身。平时的娱乐活动也就停留在节假日出去寻找下亲民美食，慢慢游览新加坡仅有的几个景点，新加坡环球影城，S.E.A. 海洋馆，新加坡动物园，新加坡夜间动物园，滨海湾花园，金沙酒店附近的鱼尾狮和摩天轮，圣淘沙和赌场，其它像植物园，大学校园很多都是免费的，旅游一般 2 天可以快速结束，如果需要细细品味也就再多增加 1-2 天足够了。</p><p>新加坡娱乐设施真的不算很多，看电影还得去现场买票，网上购买需要多花钱。吃喝玩乐想看看附近的活动和评价都没有像美团点评类似的产品，毕竟需求不像国内这么大，但我觉得让国内的美团猫眼或者阿里淘票票来进攻新加坡市场，相信分分钟钟可以拿下。</p><p>新加坡本地目前小额仍然以现金为主，商场一般支持刷卡，而主要的景点和购物中心区域全部覆盖支付宝(Alipay)</p><p><strong> 教育培训 </strong></p><p>虽然现在谈教育太早但是新加坡本地的教育资源始终都是偏向本国公民的，对我们来说永久居民 (PR) 只是万里长征的第一步，要不要买学区房，要不要做义工，也是留给自己的问题。感觉这又有上海户口，学区房，拼父母，何其相似？</p><p>新加坡和中国一样都很注重基础教育，对子女的教育支出都很高，新加坡第三方教育机构或者成人专业类培训机构的市场也很大。最近在微信朋友圈看到英国 BBC 邀请 3 名威尔士的优等生体验韩国鸡血教育的文章，除了深刻感受到教育的重要性，更加理解韩国快速崛起的因素，成熟而完整的教育产业链对孩子很重要，对国家来说更重要。</p><p><strong> 工作生活 </strong></p><p>我目前在一家新加坡互联网公司上班，工作制度是弹性的，没有严格的打卡要求，正常时间为 09:30-19:00，周围以中国同事居多，大部分是在这边读书毕业工作，学校几乎清一色新加坡国立大学 (NUS) 和新加坡南洋理工大学(NTU)，工作语言为英文，核心生产力工具包括 Google Suite，顶配 MacBook Pro，Herman Miller，Dell 2417H，还有无限制的饮料，水果和零食。原以为只能在国内的创业公司和少数尊重技术的优质公司才能看到的办公环境，可能在国外是很常见的事情吧。新加坡互联网公司在 IT 方面的人才非常短缺，也许是因为本地人大都投身于金融行业，所以很多技术人才也是会考虑从中国引进，甚至直接在国内开设分公司。</p><p>因为我以 EP 身份把我老婆也带了过来，目前还是 DP。对她来说在新加坡找一份金融行业的工作真的非常不容易，花了 2 个多月时间扫光了 LinkedIn 在新加坡几乎所有公开招聘，遗憾的是很少有金融行业愿意招聘非新加坡公民 (SZ) 和永久居民 (PR) 以外的人群，得到的回复大多数都是 Sorry，毕竟新加坡政府在很多地方都会优先照顾本国人的利益，这个道理放在中国也很好理解。不过目前经历了 6 轮面试最终拿到了一个还不错的 offer，后续 DP 也要转成 EP，这是一件值得庆幸的事情。</p><p>在没有压缩新加坡生活成本，按 1 人每月估算为 1w 人民币，如果是 2 个人差不多是 1.5w 人民币，新加坡月薪中位数是 4500 新币左右</p><p>1100(HDB 合租主人房)+50(水电网)+29.99(通信)+20✖️30(饭费)+2✖️30(交通)+99(健身房)+100(其它)≈2038.99 新币≈10000 人民币</p><p>推荐下 Grammarly for Chrome，在写邮件和文档时可以快速发现并纠正语法错误，对提升英文书写能力非常有帮助。我自己也是第一次开始深度使用 MacBook，记录一些简单的入门过程在 Blog 中，也可以做下参考。</p><p>MacBook 使用指北 - <a href="https://wsgzao.github.io/post/macbook/">https://wsgzao.github.io/post/macbook/</a></p><p><strong> 养老政策 </strong></p><p>新加坡不养闲人，你在新加坡的食阁 (Food Court) 仔细观察过就会发现几乎所有打扫卫生的都是老年人，和中国相比新加坡的养老金 CPF 是交多少退多少，不会被平均，所以更多的本地人会提前了解基金股票保险和投资房地产等方式来为自己养老。新加坡、日本、韩国等国家的老龄化问题已经凸显，我们都可以看到未来国内严重的老龄化趋势，谁又能独善其身呢？</p><p>新加坡政府因为楼市过热而提高印花税的闪电行动，中国也吹响了全球征税的集结号，无论身在哪里我们始终躲不开政治不是吗？</p><h2 id="日用品推荐"><a href="#日用品推荐" class="headerlink" title="日用品推荐"></a>日用品推荐</h2><blockquote><p>回顾来新加坡前后的经历，我希望自己分享的一部分实用建议和商品可以帮助大家更好的适应新加坡生活。如果你不喜欢网易严选和网易考拉可以选择性跳过。</p></blockquote><p>只能通过简单描述分享的建议：</p><ol><li>随身携带好护照和相关入境材料，非常重要，非常重要，非常重要</li><li>证件，学历和结婚证公正翻译等材料可以通过扫描全能王 (CamScanner) 录入为电子版，水印是可以很方便去除的，这里就不多说了。如果觉得好用请购买正版服务支持下总部位于上海的合合信息，名片全能王 (CamCard) 也是他们家的产品</li><li>提前规划好到达新加坡后的住宿，交通出行，手机应用，SIM 卡，入职流程</li><li>准备好足够的新币现金建议 4k+，因为银行卡和租房都是大头，有条件至少准备一张以上的 Visa/Mastercard 信用卡</li><li>出国前检查下国内的银行，手机，社保，人事档案是否安排妥当，身份证和护照离过期更换时间是否可控</li><li>如果有条件出国前做下全面的体检至少对自己身体有一个清晰的认识，把牙齿之类的小毛小病尽可能提前扫除隐患</li><li>现在的网络通信都很发达，记得和家人保持联系，减少他们的担心，自己照顾好自己</li></ol><p>我自己携带并且大家都能买到的产品分享：</p><ol><li>药品：我带的是泰诺和夫西地酸乳膏，这边初期看病成本还是比较高，建议最好带一些板蓝根、急用的抗生素、抗过敏药及自己习惯的常用药，如胃药、哮喘喷剂等等。</li><li>其他综合的日用品，我是分 3 批带过来的，这里按照重要性分成 2 部分来推荐，大部分来自网易严选和网易考拉工厂店，关于原因我也记录了自己的观点。如果你不喜欢网易严选和网易考拉可以选择性跳过。</li></ol><p>我的线上线下购物变迁史 - <a href="https://wsgzao.github.io/post/buy/">https://wsgzao.github.io/post/buy/</a></p><h3 id="必备推荐"><a href="#必备推荐" class="headerlink" title="必备推荐"></a>必备推荐</h3><blockquote><p>我就只推荐适用于男同胞的产品了，虽然我妻子也是在严选和工厂店买，如果各位有需求我日后可以再补充，她的东西实在是多</p></blockquote><p>[手机 / 耳机 / 智能穿戴无推荐]<br>Follow Your Heart</p><p><a href="http://163.lu/I8OGX1" target="_blank" rel="noopener">28 寸 纯 PC“铝框”（非全铝）拉杆箱</a><br>新秀丽制造商，但是怎么看怎么觉得更像是日默瓦(RIMOWA)，虽然有小米 90 分旅行箱但 20 寸太小，为了追求更大容量就买了这款，使用感受非常可靠，五星推荐</p><p>[双肩包无推荐]<br>我自己背的是一加(OnePlus)1 代和 2 代，她带的是 Longchamp 和 Doughnut，都是多年的老包了</p><p><a href="http://wx.uniir.com/" target="_blank" rel="noopener">独美</a><br>眼镜我和妻子每人配了 2 副做主备, 我们买的都是来自京东众筹的独美，3.3g 镜架加镜片只要 398。小米有品太阳镜带了 1 副，不过来新加坡后我从来没佩戴过</p><p>[晴雨伞没有推荐]<br>新加坡经常短时暴雨，平日基本阳光明媚，建议携带一把晴雨伞，既能遮阳、又能挡雨。我自己带了 1 把天堂和 1 把小米晴雨两用，因为比较懒所以买的都是自动伞。只是可惜了 RealBrella 锐乐 不对称设计长柄伞留在家里吃灰，我好喜欢这款大红色啊。</p><p>[跑鞋无推荐]<br>自己带了 2 双旧鞋过来，严选上买过一双类似 Adidas UltraBoost 的鞋子还不错。我妻子带了 Asics GEL-Kayano 24，无论在网易考拉买还是在新加坡本地买 Asics 都很便宜，而且新加坡 NIKE EPIC REACT 新款居然只要 130 + 新币，这也是让我觉得很神奇</p><p><a href="http://163.lu/050tb0" target="_blank" rel="noopener">两带式男女款软木拖鞋 2.0</a><br><a href="http://163.lu/SpQlo1" target="_blank" rel="noopener">两带式男 / 女款拖鞋</a><br>Birkenstock 集团制造商，我特地在国内和新加坡的专卖店对比过，自己穿了 1 代非常舒服然后又买了 2 代，因为在新加坡基本是拖鞋 + 短裤的夏装，如果你的工作要求正装注意带好皮鞋和衣服套装</p><p><a href="http://163.lu/v4KrM2" target="_blank" rel="noopener">软弹速干男 / 女沐浴拖鞋</a><br>Crocs 制造商，浴室必备。本来想分享严选的人字拖，但不知道为什么严选把它下架了，反正我基本是放在室内穿，大家买自己觉得舒服的就好</p><p><a href="http://163.lu/CKQh21" target="_blank" rel="noopener">考拉工厂店 5 双 男士精梳棉防臭休闲袜</a><br>我在新加坡穿袜子的次数就和穿运动鞋的次数保持一致，除了健身和户外活动，几乎都是大拖鞋走起，上次登顶新加坡最高峰武吉知马山也是拖鞋，不过大家还是必要学我穿拖鞋爬山，以免自己给自己挖坑</p><p><a href="http://163.lu/uE5Uz3" target="_blank" rel="noopener">网易严选 男式丝滑莫代尔平角内裤</a><br><a href="http://163.lu/7ZOLU2" target="_blank" rel="noopener">考拉工厂店 男士莫代尔零束缚感内裤</a><br>我买过 CK 也买过网易严选和小米有品的纯棉内裤，但真正可以打动我的材质还是莫代尔，网易严选和网易考拉工厂店的两款我都买了，质感各有特色。严选上还有一款空气内裤，勇于尝鲜的同学要不试试？</p><p><a href="http://163.lu/aXBps0" target="_blank" rel="noopener">考拉工厂店 男式无缝插肩短袖 T 恤</a><br>我买了 3 件来自于严选和考拉工厂店的运动速干衣，但是从品质和舒适度上还是感觉不如自己再 Nike 实体店中购买的 Dri-FIT，考拉工厂店这款已经无限逼近了。小米有品也有很多运动衣，都是可以考虑的。我个人推荐备上 3 套运动衣，因为新加坡常年夏季，出汗是难免的，速干面料可以保持身体的舒适</p><p><a href="http://163.lu/Qxhpq2" target="_blank" rel="noopener">考拉工厂店 男式运动短裤</a><br>这款运动短裤我五星推荐，不仅做工精湛，口袋拉链等细节也非常到位，我自己直接买了 2 条，如果不是因为只有 2 种颜色，我还会继续买。另外还带了一条 Nike Dri-FIT 短裤，不过因为没有拉链所以来新加坡后基本没穿过，在上海的时候也仅仅是健身时穿的，现在因为设计问题算是彻底废了。</p><p><a href="http://163.lu/FPubq0" target="_blank" rel="noopener">考拉工厂店 男式针织轻薄运动裤</a><br>这款运动长裤我五星推荐，空气面料在夏天也依旧舒爽，内口袋拉链细节设计极赞，我索性买了 2 条一模一样的黑色款。新加坡平时上班我基本是穿这款长裤，原因和上面说过的新加坡室内空调温度较低有关，注意保暖。</p><p>[睡衣没有推荐]<br>我就直接把以前优衣库的全棉联名 T 恤全部带过来当睡衣穿了，有时候出门也可以穿哈</p><p>[外套没有推荐]<br>我自己带了 Under Armour 防风防雨衣，小米有品夜跑皮肤衣，小米有品防雨皮肤衣，除了 Under Armour 放在公司偶尔冷的时候会披一下，其它皮肤衣还没穿过。</p><p>[衬衫没有推荐]<br>我把原来公司定制的各种正装带过来了，可惜就入职时穿过一次，后来就是拖鞋加运动套装上班了</p><p><a href="http://163.lu/N7voR2" target="_blank" rel="noopener">成人款 高清时尚电镀泳镜</a><br><a href="http://163.lu/tDJJb2" target="_blank" rel="noopener">黑闪系列 硅胶防水泳帽 （男女通用）</a><br><a href="http://163.lu/Egc5c1" target="_blank" rel="noopener">男式基础泳裤</a><br>严选做了游泳装备也出乎我的意料，关键是和我之前买的 Speedo 相比那叫一个便宜啊，我本身是退休多年的游泳二级运动员，看似很简单的游泳装备严选的质量和价格都把控的不错，希望未来增加带度数的游泳镜。新加坡开放的普通游泳馆使用 EZ-link 刷卡，1.3 新币一次非常便宜，关键还多是训练使用的标准泳池人也少，定时清洁的规范让人放心。</p><p><a href="http://163.lu/rDAkF3" target="_blank" rel="noopener">全球通用转换插座</a><br>全球通用转换插座出国的人都应该明白是必备的，严选居然也做出来了，感觉又要干死一片坑爹厂商</p><p>[移动电源必须小米啊]<br>互联网上一直流传着这样的传说，小米什么产品都可以黑但是谁要是敢黑小米移动电源就被其他人反过来喷死。如果不是小米移动电源的出现干掉一众无良商家，现在市场上还不知道有多少人会受到低劣电池爆炸的影响，小米移动电源是真正用产品说话赢得用户口碑的最佳案例之一。我自己买的是紫米新款，我妻子买了一个超薄款就为了好看，哎</p><p><a href="http://163.lu/4ehYt4" target="_blank" rel="noopener">3 头浮动式电动剃须刀</a><br>科技类产品其实很想支持小米，可惜小米生态链不给力，就先用着严选高性价比的剃须刀好了</p><p><a href="http://163.lu/5cpvU0" target="_blank" rel="noopener">THREE SEVEN/777 进口指甲刀便携 4 件套 指甲剪小套装 三色可选</a><br>被淘宝坑过电动指甲刀和匠技指甲刀，也被严选坑过过于简约的指甲刀，没想到最后还是要选择韩国原装进口的 777 牌 4 件套，我以前不了解斜口指甲刀，后来才发现这货是剪脚指甲的神器啊，我以前剪脚指甲是有多痛苦哇</p><p><a href="http://163.lu/RNu3A1" target="_blank" rel="noopener">8 件装 折叠多功能衣架</a><br><a href="http://163.lu/dtCu31" target="_blank" rel="noopener">18 头多功能晾衣架</a><br>必备推荐，折叠携带很方便，18 头多功能晾衣架晾衣服的时候一个顶百，我都差点可以不用普通衣架了</p><p><a href="http://163.lu/pAmCc4" target="_blank" rel="noopener">旅行分装瓶套装</a><br>洗护用品我建议用分装瓶或者带最小包装的出国，因为这些日常用品本身价值不高但分量重，在当地超市购买就好了，除非你非常在意使用某些品牌</p><p><a href="http://163.lu/uFs190" target="_blank" rel="noopener">考拉工厂店 祛痘舒缓澳洲黑蜂胶香皂</a><br>我在上海的时候就经常使用，这次来新加坡一口气带了 6 块</p><p><a href="http://163.lu/84sNk4" target="_blank" rel="noopener">日式和风声波式电动牙刷（可单买刷头）</a><br>我给父母买的也是同款，建议再带上 2 个以上刷头。如果你之前从来没有使用过电动牙刷，非常建议你尝试，清洁牙齿更加彻底和方便，爱上之后就无法回到过去手动刷牙啦</p><p><a href="http://163.lu/H03jR2" target="_blank" rel="noopener">电动式硅胶洁面仪</a><br>我还记得我给妻子送的第一个礼物就是 FOREO LUNA MINI2 Plus，这个也是我在网易考拉上买的第一个商品，当时这款网红洁面仪被招商银行垄断，没办法直接购买，逼着自己了解到网易考拉在国内海淘市场的领先地位，也算是缘分吧。现在严选自己也推出类似洁面仪才十分之一的价格，买个给自己吧</p><p><a href="http://163.lu/ZKkRz3" target="_blank" rel="noopener">韩国制造 硅胶洁面刷</a><br><a href="http://163.lu/RJS3r0" target="_blank" rel="noopener">韩国制造 硅胶沐浴按摩手套</a><br><a href="http://163.lu/Rv9KI2" target="_blank" rel="noopener">韩国制造 多功能硅胶清洁刷</a><br>严选从韩国引进来相当专业的硅胶产品制造商，其中这 3 件小东西在洗脸，沐浴，洗碗上极大的提升了我的幸福感，强烈推荐人手一件</p><p><a href="http://163.lu/womXA3" target="_blank" rel="noopener">皇室御用超柔毛巾</a><br>内野制造商，这是网易严选当年备受争议的产品之一，我不知道内野是什么，但我只知道这款毛巾确实舒服</p><p>[床单 / 床笠 / 被套 / 毯子]<br>我从家里带了 2 套旧的，然后又从考拉工厂店买了外国人比较喜欢的床笠，因为晚上睡觉都是关闭空调，没有被子就一层薄薄的毯子，一般租房子房东都会提供床板和床上用品，如果你不习惯或者运气不好，在新加坡本地宜家采购也很方便的</p><p><a href="http://163.lu/VY4v73" target="_blank" rel="noopener">考拉工厂店 100% 桑蚕丝双面美肤枕套</a><br>我和妻子一人一个，带过去非常方便，水洗之后也没有出现质量问题，面料实在丝滑</p><p><a href="http://163.lu/pBhg61" target="_blank" rel="noopener">AQR 创口贴</a><br>在新加坡常年夏装，像脚和皮肤很容易受伤，带上一盒以备不时之需</p><h3 id="可选推荐"><a href="#可选推荐" class="headerlink" title="可选推荐"></a>可选推荐</h3><blockquote><p>分享自己购买过的东西真的好累，没想到不知不觉买了这么多，但是能够对自己派上用场没有浪费也值了</p></blockquote><p><a href="http://163.lu/23D8k4" target="_blank" rel="noopener">泰国制造 天然乳胶枕 护颈优眠 升级抗菌</a><br>我买过记忆枕，空气枕，乳胶枕还有各种酒店的枕头体验。小米 8H 的乳胶枕和网易严选的相比我更推荐严选的升级款，这也属于严选的爆款商品了</p><p><a href="http://163.lu/6iWZ74" target="_blank" rel="noopener">日式多功能颈枕 舒滑款</a><br>第一次看到 MUJI 的微粒子 U 型枕就被深深吸引，现在小米和网易严选都有同样类型的，我自己购买的是光滑面料，毕竟新加坡非常热，原来在国内我还买过一个经典款</p><p><a href="http://163.lu/9iYPC2" target="_blank" rel="noopener">舒眠真丝眼罩</a><br>折叠床是带不过去了，很早之前买过零听眼罩，用过真丝眼罩后才明白丝的舒服，就和上面买真丝枕套的理由一样。如果你对声音也很敏感，除了戴耳机以外，再购置几副耳塞也是不错的选择</p><p>[鼻毛修剪器]<br>没有看到小米和严选有，看了张大妈的评测最后淘宝购入松下 ER-BN50，虽然不知道和国产的飞科相比有多大优势，至少用下来还行吧</p><p>[洗护 / 牙膏 / 洗面奶 / 防晒霜]<br>我推荐带上便携装，其实选择什么不重要，重要的是理解背后的成分，我唯一推荐的就是自己在上海和新加坡都长期使用的<a href="http://163.lu/lWFct2" target="_blank" rel="noopener"> 熊野油脂 无硅弱酸性马油洗发水</a></p><p><a href="http://163.lu/M8IW72" target="_blank" rel="noopener">Swisse 男士复合维生素 120 片 / 瓶</a><br>加上我在上海之前吃的半瓶，一共带了 2.5 瓶过去，现在回头看这个决定是非常明智的，因为新加坡本地蔬菜和水果不算便宜，关键是营养品价格奇高，一小瓶都要五六十新币。营养品不能代替药物，更不能代替你规律的饮食作息和身体锻炼，请记住这只是用来辅助身体营养平衡。我妻子还会购买 Swisse 的女士复合维生素片 + 葡萄籽和 Unichi 玫瑰果 + 葡萄籽</p><p><a href="http://163.lu/PsXds0" target="_blank" rel="noopener">考拉工厂店 便携式手持蒸汽挂烫机</a><br>我妻子要买的，方便小巧，出席正式场合会排上用场</p><p><a href="http://163.lu/WXcRz2" target="_blank" rel="noopener">考拉工厂店 强力除螨吸尘器</a><br>我没同意我妻子买养生壶和破壁料理机，原本这么大个头的除螨仪其实也是拒绝的，但是在阅读过网易浪潮工作室的一篇《中国人为什么爱晒被子》后我认为在美国或者韩国流行的洗衣烘干一体机可能不适合现在的我们，但是我不希望自己身边的人因为痘痘或者皮肤细菌感染而受到伤害，既然网易工厂店降低了除螨仪的购买门槛，为什么不尝试改变下自己的习惯呢？</p><p><a href="http://163.lu/oCJS84" target="_blank" rel="noopener">春风 TryFun 超润滑避孕套</a><br>好孩子就不要点击了，尤其是不要淘气切换到春风 TryFun 系列</p><h2 id="工作招聘"><a href="#工作招聘" class="headerlink" title="工作招聘"></a>工作招聘</h2><p><img src="http://wx1.sinaimg.cn/large/7207510dgy1fv3qi3vd5jj20by0bymyh.jpg" alt=""></p><p>这是我第一次创建微信个人公众号，不会向大家推送文章，只是作为信息分享的渠道。我和上家公司以及现在公司的人力关系都还不错，在征得允许的前提下给大家分享上海和新加坡这两家公司目前的内部招聘动态，上海的职位真的的是进去的多出来的少，如果你希望相对稳定那这是很不错的机会。新加坡这边我会跟随公司内部招聘邮件每半个月左右更新，工作语言以英文为主，周围的中国同事还比较多，不用太担心在新加坡的语言关。这两家公司的介绍都可以在互联网上轻松获取，如果你相信自己的能力可以直接投递简历至文章内的联系方式。努力奋斗未必都能达到预想的结果，但至少你做出了自己的选择。</p>]]></content>
    
    <summary type="html">
    
      为帮助大家玩转新加坡、快速适应当地生活
    
    </summary>
    
      <category term="生活 | Life" scheme="https://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
    
  </entry>
  
  <entry>
    <title>英文标点符号中英文翻译和用法整理</title>
    <link href="https://wsgzao.github.io/post/punctuation/"/>
    <id>https://wsgzao.github.io/post/punctuation/</id>
    <published>2018-09-07T02:59:49.000Z</published>
    <updated>2018-09-07T06:27:15.130Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近突然发现自己学了那么久英语，但连最基本的标点符号用法都不清楚，比如我在新加坡刚开始听别人说到 slash 和 hash 的时候脑子短路了 3 秒钟才反应过来。于是花时间根据网上的资料，整理了一份常见标点符号的英语名称中英对照翻译。</p><blockquote><p>相同符号对于英式和美式来说表达上可能存在差异，请注意区分</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018 年 09 月 07 日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/punctuation/">https://wsgzao.github.io/post/punctuation/</a></p><p><strong> 扩展阅读 </strong></p><p>中文文案排版指北 - <a href="https://github.com/sparanoid/chinese-copywriting-guidelines" target="_blank" rel="noopener">https://github.com/sparanoid/chinese-copywriting-guidelines</a></p><hr><h2 id="标点符号中英文对照翻译"><a href="#标点符号中英文对照翻译" class="headerlink" title="标点符号中英文对照翻译"></a>标点符号中英文对照翻译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">． period or full stop 句号 </span><br><span class="line">， comma 逗号 </span><br><span class="line">： colon 冒号 </span><br><span class="line">； semicolon 分号 </span><br><span class="line">！ exclamation mark 惊叹号 </span><br><span class="line">？ question mark 问号 </span><br><span class="line">- hyphen 连字符 </span><br><span class="line">* asterisk 星号 </span><br><span class="line"><span class="string">'apostrophe 撇号、所有格符号 </span></span><br><span class="line"><span class="string">—— dash 破折号 </span></span><br><span class="line"><span class="string">_ underscore or understrike 下划线 </span></span><br><span class="line"><span class="string">'</span> <span class="string">'single quotation marks 单引号 </span></span><br><span class="line"><span class="string">" "double quotation marks 双引号 </span></span><br><span class="line"><span class="string">( ) parenthesis or round brackets 圆括号 </span></span><br><span class="line"><span class="string">[ ] square brackets 方括号 </span></span><br><span class="line"><span class="string">&lt;&gt; Angle brackets 尖括号 </span></span><br><span class="line"><span class="string">&#123;&#125; curly brackets or braces 大括号 </span></span><br><span class="line"><span class="string">《 》French quotes 法文引号、书名号 </span></span><br><span class="line"><span class="string">… ellipsis 省略号 </span></span><br><span class="line"><span class="string">¨ tandem colon 双点号 </span></span><br><span class="line"><span class="string">” ditto 同上 </span></span><br><span class="line"><span class="string">‖ parallel 双线号 </span></span><br><span class="line"><span class="string">／ slash or virgule or diagonal mark 斜线号 </span></span><br><span class="line"><span class="string">＆ ampersand or and or reference or ref 和、引用 </span></span><br><span class="line"><span class="string">～ tilde or swung dash 代字号 </span></span><br><span class="line"><span class="string">§ section or division 分节号 </span></span><br><span class="line"><span class="string">→ arrow 箭号、参见号 </span></span><br><span class="line"><span class="string">| vertical bar 竖线 </span></span><br><span class="line"><span class="string">\ backslash 反斜线转义符 </span></span><br><span class="line"><span class="string"># number sign or pound sign or hash 井号 </span></span><br></pre></td></tr></table></figure><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="单边符号"><a href="#单边符号" class="headerlink" title="单边符号"></a>单边符号</h3><ol><li>大多数符号其后需要空出一格。</li><li>标点用于表示缩写词、数位、金额（1,000,000）、时间（5:30）、比例（1:3:4）其后不用加空格。撇号（‘）、连字号（–）前后均不加空格。</li><li>表示称呼缩略词（Mr. Hui）、时间（12′ 13” 14” ）其后需加一个空格。</li></ol><h3 id="成对符号"><a href="#成对符号" class="headerlink" title="成对符号"></a>成对符号</h3><ol><li>需要在符号的两边各空一格，符号内不用空格。符号内的其他符号也不需空格。</li></ol><p>He said, “I may forget your name, but I never forget a face.”</p><h2 id="常见误用"><a href="#常见误用" class="headerlink" title="常见误用"></a>常见误用</h2><ol><li>书名号问题</li></ol><p>英文中没有书名号，引用的标题通常用斜体或加下划线表示。</p><p>2.hyphen (-)、en dash (–) 和 em dash (—)</p><p>hyphen (-) 长度最短的是连字号，用于单词换行，连接前后缀，复合词，分割数字。<br>en dash (–) 是连接号，用法类似中文下的～，常用于表示起止范围。<br>em dash (—) 用法类似中文下的破折号。<br>三者使用时前后均不加空格。</p><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p><a href="http://www.nationalpunctuationday.com/" target="_blank" rel="noopener">NationalPunctuationDay（标点用法）</a><br><a href="https://owl.english.purdue.edu/owl/resource/607/01/" target="_blank" rel="noopener">Purdue Oline Writing Lab（英文文法规范）</a><br><a href="https://faculty.washington.edu/heagerty/Courses/b572/public/StrunkWhite.pdf" target="_blank" rel="noopener">The Elements of Style（《文体要素》）</a><br><a href="http://www.ruanyifeng.com/blog/2007/07/english_punctuation.html" target="_blank" rel="noopener">标点符号的英语名称——阮一峰的网络日志</a><br><a href="https://github.com/sparanoid/chinese-copywriting-guidelines" target="_blank" rel="noopener">中文文案排版指北</a></p>]]></content>
    
    <summary type="html">
    
      相同符号对于英式和美式来说表达上可能存在差异，请注意区分
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
</feed>
